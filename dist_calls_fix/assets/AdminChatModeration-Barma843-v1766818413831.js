import{r as e,o as t,h as s,l as a,m as r,F as d,i as o,t as l,y as i,k as n,n as c}from"./vendor-mW7CftnD-v1766818413831.js";const u={class:"min-h-screen bg-gray-100"},x={class:"bg-white shadow-lg"},m={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},v={class:"flex justify-between h-16"},h={class:"flex items-center space-x-4"},p={class:"max-w-7xl mx-auto py-6 px-4"},g={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},b={class:"lg:col-span-1 bg-white rounded-lg shadow p-4"},y={class:"space-y-2 max-h-[600px] overflow-y-auto"},f=["onClick"],w={class:"font-medium text-sm"},_={class:"text-xs text-gray-700 mt-1"},k={key:0,class:"text-xs text-red-600 mt-1"},$={key:0,class:"text-gray-700 text-center py-8"},C={class:"lg:col-span-2 bg-white rounded-lg shadow p-4"},E={key:0,class:"text-gray-700 text-center py-12"},j={key:1},D={class:"flex items-center justify-between mb-4 pb-4 border-b"},L={class:"font-bold"},A={class:"text-xs text-gray-700"},B={class:"space-y-3 max-h-[500px] overflow-y-auto mb-4"},R={class:"flex items-start justify-between"},T={class:"flex-1"},U={class:"text-sm font-medium"},z={class:"text-xs text-gray-700 mt-1"},F={class:"flex gap-1"},S=["onClick"],q=["onClick"],M={class:"mt-6 bg-white rounded-lg shadow p-6"},I={class:"grid grid-cols-4 gap-4"},O={class:"bg-red-50 p-4 rounded"},P={class:"text-2xl font-bold text-red-600"},G={class:"bg-yellow-50 p-4 rounded"},H={class:"text-2xl font-bold text-yellow-600"},J={class:"bg-blue-50 p-4 rounded"},K={class:"text-2xl font-bold text-blue-600"},N={class:"bg-purple-50 p-4 rounded"},Q={class:"text-2xl font-bold text-purple-600"},V={__name:"AdminChatModeration",setup(V){const W=i(),X=e([]),Y=e(null),Z=e([]),ee=e({totalReports:0,pendingReports:0,deletedMessages:0,bannedUsers:0}),te=()=>localStorage.getItem("adminToken"),se=async()=>{try{const e=te();if(!e)return void W.push("/admin/login");const t=await fetch("/api/v1/admin/chats",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){if(404===t.status)return console.log("Chats endpoint not implemented yet"),void(X.value=[{id:"1",request_description:"–ü–æ–º–æ—â—å —Å –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–æ–º",messages_count:15,has_reports:!0},{id:"2",request_description:"–ù—É–∂–µ–Ω –±–µ–Ω–∑–∏–Ω",messages_count:8,has_reports:!1}]);throw new Error("Failed to load chats")}const s=await t.json();X.value=s.chats||[]}catch(e){console.error("Load chats error:",e)}},ae=async()=>{if(confirm("–£–¥–∞–ª–∏—Ç—å –≤–µ—Å—å —á–∞—Ç?"))try{const e=te(),t=await fetch(`/api/v1/admin/chats/${Y.value.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}});if(!t.ok&&404!==t.status)throw new Error("Failed");alert("‚úÖ –ß–∞—Ç —É–¥–∞–ª—ë–Ω"),Y.value=null,await se()}catch(e){alert("–û—à–∏–±–∫–∞: "+e.message)}},re=async()=>{if(confirm("–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ?"))try{const e=te(),t=await fetch(`/api/v1/admin/chats/${Y.value.id}/clear`,{method:"POST",headers:{Authorization:`Bearer ${e}`}});if(!t.ok&&404!==t.status)throw new Error("Failed");Z.value=[],alert("‚úÖ –ß–∞—Ç –æ—á–∏—â–µ–Ω")}catch(e){alert("–û—à–∏–±–∫–∞: "+e.message)}},de=()=>{let e=`–ß–∞—Ç: ${Y.value.request_description}\n\n`;Z.value.forEach(t=>{e+=`[${new Date(t.created_at).toLocaleString()}] ${t.sender_name}: ${t.content}\n`});const t=new Blob([e],{type:"text/plain"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=`chat_${Y.value.id}_${(new Date).toISOString().split("T")[0]}.txt`,s.click(),alert("‚úÖ –ß–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω")};return t(()=>{se()}),(e,t)=>(n(),s("div",u,[a("nav",x,[a("div",m,[a("div",v,[a("div",h,[a("button",{class:"text-blue-600 hover:text-blue-800 font-medium",onClick:t[0]||(t[0]=t=>e.$router.push("/admin/dashboard"))}," ‚Üê –î–∞—à–±–æ—Ä–¥ "),t[1]||(t[1]=a("h1",{class:"text-xl font-bold text-gray-900"}," üí¨ –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ß–∞—Ç–æ–≤ ",-1))])])])]),a("div",p,[a("div",g,[a("div",b,[t[2]||(t[2]=a("h3",{class:"font-bold mb-4"}," –ê–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã ",-1)),a("div",y,[(n(!0),s(d,null,o(X.value,e=>{var t;return n(),s("div",{key:e.id,class:c([(null==(t=Y.value)?void 0:t.id)===e.id?"bg-blue-100 border-blue-500":"hover:bg-gray-50","p-3 border rounded cursor-pointer"]),onClick:t=>(async e=>{Y.value=e;try{const t=te(),s=await fetch(`/api/v1/admin/chats/${e.id}/messages`,{headers:{Authorization:`Bearer ${t}`}});if(!s.ok)return void(Z.value=[{id:"1",sender_name:"–ò–≤–∞–Ω",sender_id:"u1",content:"–ü—Ä–∏–≤–µ—Ç, –º–æ–∂–µ—Ç–µ –ø–æ–º–æ—á—å?",created_at:new Date,is_deleted:!1},{id:"2",sender_name:"–ú–∞—Ä–∏—è",sender_id:"u2",content:"–î–∞, –∫–æ–Ω–µ—á–Ω–æ! –ì–¥–µ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å?",created_at:new Date,is_deleted:!1}]);const a=await s.json();Z.value=a.messages||[]}catch(t){console.error("Load messages error:",t)}})(e)},[a("div",w,l(e.request_description),1),a("div",_,l(e.messages_count||0)+" —Å–æ–æ–±—â–µ–Ω–∏–π ",1),e.has_reports?(n(),s("div",k," ‚ö†Ô∏è –ï—Å—Ç—å –∂–∞–ª–æ–±—ã! ")):r("",!0)],10,f)}),128)),X.value.length?r("",!0):(n(),s("div",$," –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤ "))])]),a("div",C,[Y.value?(n(),s("div",j,[a("div",D,[a("div",null,[a("h3",L,l(Y.value.request_description),1),a("p",A," Chat ID: "+l(Y.value.id),1)]),a("button",{class:"bg-red-600 text-white px-3 py-1 rounded text-sm",onClick:ae}," üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —á–∞—Ç ")]),a("div",B,[(n(!0),s(d,null,o(Z.value,e=>(n(),s("div",{key:e.id,class:c(["p-3 border rounded",e.is_deleted?"bg-red-50 border-red-300":""])},[a("div",R,[a("div",T,[a("div",U,l(e.sender_name),1),a("div",{class:c(["text-sm mt-1",e.is_deleted?"line-through text-gray-700":""])},l(e.content),3),a("div",z,l(new Date(e.created_at).toLocaleString("ru-RU")),1)]),a("div",F,[e.is_deleted?r("",!0):(n(),s("button",{key:0,class:"text-red-600 hover:text-red-800 text-xs px-2 py-1",onClick:t=>(async e=>{if(confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ?"))try{const t=te(),s=await fetch(`/api/v1/admin/messages/${e.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!s.ok&&404!==s.status)throw new Error("Failed");e.is_deleted=!0,ee.value.deletedMessages++,alert("‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ")}catch(t){alert("–û—à–∏–±–∫–∞: "+t.message)}})(e)}," üóëÔ∏è ",8,S)),a("button",{class:"text-red-600 hover:text-red-800 text-xs px-2 py-1",onClick:t=>(async e=>{if(confirm("–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?"))try{const t=te();if(!(await fetch(`/api/v1/admin/users/${e}/status`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).ok)throw new Error("Failed");ee.value.bannedUsers++,alert("‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω")}catch(t){alert("–û—à–∏–±–∫–∞: "+t.message)}})(e.sender_id)}," üö´ ",8,q)])])],2))),128))]),a("div",{class:"flex gap-2"},[a("button",{class:"bg-yellow-600 text-white px-4 py-2 rounded text-sm",onClick:re}," üßπ –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç "),a("button",{class:"bg-blue-600 text-white px-4 py-2 rounded text-sm",onClick:de}," üì• –≠–∫—Å–ø–æ—Ä—Ç ")])])):(n(),s("div",E," –í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ "))])]),a("div",M,[t[7]||(t[7]=a("h3",{class:"font-bold mb-4"}," üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∂–∞–ª–æ–± –∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ ",-1)),a("div",I,[a("div",O,[a("div",P,l(ee.value.totalReports),1),t[3]||(t[3]=a("div",{class:"text-sm text-gray-800 font-medium"}," –í—Å–µ–≥–æ –∂–∞–ª–æ–± ",-1))]),a("div",G,[a("div",H,l(ee.value.pendingReports),1),t[4]||(t[4]=a("div",{class:"text-sm text-gray-800 font-medium"}," –û–∂–∏–¥–∞—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ ",-1))]),a("div",J,[a("div",K,l(ee.value.deletedMessages),1),t[5]||(t[5]=a("div",{class:"text-sm text-gray-800 font-medium"}," –£–¥–∞–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π ",-1))]),a("div",N,[a("div",Q,l(ee.value.bannedUsers),1),t[6]||(t[6]=a("div",{class:"text-sm text-gray-800 font-medium"}," –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ ",-1))])])])])]))}};export{V as default};
