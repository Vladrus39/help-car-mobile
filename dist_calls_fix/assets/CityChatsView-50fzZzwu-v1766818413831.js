import{r as e,c as t,o as a,a as l,H as r,h as s,f as o,l as n,m as i,g as d,x as u,n as c,F as v,i as g,I as y,J as b,G as x,v as p,t as h,p as m,y as f,k,e as w}from"./vendor-mW7CftnD-v1766818413831.js";import{_,u as C,l as j,a as I}from"./index-05yRke8F-v1766818413831.js";import{_ as M}from"./NavigationHeader-iqVP4xtF-v1766818413831.js";import{P as E}from"./PremiumBadge-2YlFf32N-v1766818413831.js";import"./utils-3YOAKp3O-v1766818413831.js";import"./maps-CCq-KL9W-v1766818413831.js";const S={class:"min-h-screen bg-gray-50 dark:bg-gray-900 transition-colors duration-200"},T={class:"max-w-7xl mx-auto py-6 px-4"},$={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4"},A={class:"flex items-center gap-2 text-xs sm:text-sm mb-1"},L={class:"flex flex-wrap gap-2"},z={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},B={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 transition-colors duration-200"},U={key:0,class:"text-center py-8"},V={key:1,class:"space-y-2"},H=["onClick"],N={class:"flex items-center justify-between"},R={class:"font-bold"},W={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 transition-colors duration-200"},O={key:0,class:"mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/30 border-2 border-yellow-200 dark:border-yellow-700 rounded-xl"},P={class:"space-y-2 max-h-96 overflow-y-auto"},D=["disabled","onClick"],G={class:"flex items-center justify-between"},J={class:"font-bold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400"},F={class:"text-xs text-gray-500 dark:text-gray-400"},q={key:0,class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-12 text-center h-[600px] flex items-center justify-center transition-colors duration-200"},K={key:1,class:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl overflow-hidden h-[600px] flex flex-col transition-colors duration-200"},Q={class:"p-4 sm:p-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white"},X={class:"flex items-center justify-between"},Y={class:"text-2xl font-black"},Z={class:"text-blue-100 font-semibold"},ee={key:0,class:"space-y-3"},te={key:1,class:"text-center py-12"},ae={key:1,class:"mb-2"},le=["src","alt","onClick"],re={key:2,class:"mb-2"},se=["onClick"],oe={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},ne={key:1,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},ie={class:"flex-1"},de={class:"flex items-center gap-2"},ue=["id"],ce=["src","onEnded","onTimeupdate"],ve={key:3,class:"text-base"},ge={key:3,class:"flex justify-start"},ye={key:0,class:"p-4 border-t-2 border-gray-200 dark:border-gray-700 bg-yellow-50 dark:bg-yellow-900/30"},be={class:"text-center"},xe={class:"flex space-x-2"},pe={key:1,class:"p-4 border-t-2 border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"},he={key:0,class:"mb-3 flex items-center gap-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg"},me={class:"text-red-600 dark:text-red-400 font-medium"},fe={key:1,class:"mb-3 relative inline-block"},ke=["src"],we={key:0,class:"absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center"},_e=["disabled"],Ce={class:"relative"},je={key:0,class:"absolute bottom-12 right-0 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 p-3 z-50 w-72"},Ie={class:"grid grid-cols-8 gap-1 max-h-48 overflow-y-auto"},Me=["onClick"],Ee=["disabled"],Se=["src"],Te=_({__name:"CityChatsView",setup(_){const Te=f(),$e=C(),Ae=e(null),Le=e([]),ze=e(null),Be=e([]),Ue=e(""),Ve=e(""),He=e(!1),Ne=e(!1),Re=e(!1),We=e(!1),Oe=e(null),Pe=e(null),De=e(null),Ge=e(null),Je=e(!1),Fe=e(null),qe=e(!1),Ke=e(!1),Qe=e(0),Xe=e(null),Ye=e([]),Ze=e(null),et={};let tt=null;const at=["üòÄ","üòÉ","üòÑ","üòÅ","üòÜ","üòÖ","ü§£","üòÇ","üôÇ","üòâ","üòä","üòá","ü•∞","üòç","ü§©","üòò","üòó","üòö","üòô","ü•≤","ü§ó","ü§î","ü§≠","ü§´","ü§¨","üò¢","üò≠","üò§","üò†","üò°","ü§Ø","üò≥","ü•µ","ü•∂","üò±","üò®","üëç","üëé","üëå","‚úåÔ∏è","ü§û","ü§ô","üëä","‚ù§Ô∏è","üß°","üíõ","üíö","üíô","üíú","üñ§","üî•","‚≠ê","üéâ","üöó","üöï","üöô","üöå","üõ†Ô∏è","üîß","‚õΩ","üì±","üíª","üè†","üìç","‚úÖ","‚ùå"];let lt=null;const rt=e(!1);let st=null;function ot(e){var t,a;const l=String((null==(t=Ae.value)?void 0:t.id)||""),r=String((null==(a=e.sender)?void 0:a.id)||e.sender_id||"");return l&&r&&l===r}const nt=t(()=>"undefined"!=typeof window&&window.innerWidth<1024);function it(){ze.value=null,Be.value=[]}const dt=e([]),ut=t(()=>{if(!Ve.value)return dt.value;const e=Ve.value.toLowerCase();return dt.value.filter(t=>t.name.toLowerCase().includes(e)||(t.region||"").toLowerCase().includes(e))});async function ct(e){ze.value=e,Be.value=[],await async function(){var e,t,a,l;if(!ze.value)return;try{He.value=!0;const e=await I.getCityChatMessages(ze.value.id,{limit:100,offset:0});let t=[];e&&e.messages?t=e.messages||[]:e.data&&e.data.messages?t=e.data.messages||[]:Array.isArray(e)&&(t=e),Be.value=t.map(e=>({...e,created_at:e.created_at||e.createdAt})),await r(),ht(!0)}catch(s){console.error("Error loading messages:",s),console.error("Error details:",(null==(e=s.response)?void 0:e.data)||s.message),403===(null==(t=s.response)?void 0:t.status)?alert("–í—ã –Ω–µ —è–≤–ª—è–µ—Ç–µ—Å—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–º —ç—Ç–æ–≥–æ —á–∞—Ç–∞"):404===(null==(a=s.response)?void 0:a.status)?alert("–ß–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"):401===(null==(l=s.response)?void 0:l.status)&&(alert("–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ."),Te.push("/login")),Be.value=[]}finally{He.value=!1}}(),st&&st.emit("city_chat:join",{cityChatId:e.id})}function vt(){var e;null==(e=Pe.value)||e.click()}function gt(e){var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(a.type)?a.size>10485760?alert("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: 10 –ú–ë"):(De.value=a,Ge.value=URL.createObjectURL(a)):alert("–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: JPEG, PNG, WebP, GIF")}function yt(){Ge.value&&URL.revokeObjectURL(Ge.value),De.value=null,Ge.value=null,Pe.value&&(Pe.value.value="")}async function bt(){if(!Ue.value.trim()&&!De.value||!ze.value||Ne.value)return;const e=Ue.value.trim(),t=De.value;Ue.value="",yt();const a="temp-"+Date.now(),l={id:a,content:e,sender:Ae.value,city_chat_id:ze.value.id,created_at:(new Date).toISOString(),is_sending:!0,image_url:t?Ge.value:null};Be.value.push(l),await r(),ht();try{Ne.value=!0;let l=null,r=null;if(t){Je.value=!0;try{const e=await I.uploadChatImage(t);e.success&&(l=e.image_url,r=e.thumbnail_url)}finally{Je.value=!1}}const s=await I.client.post(`/city-chats/${ze.value.id}/messages`,{content:e||"",image_url:l,thumbnail_url:r}),o=Be.value.findIndex(e=>e.id===a);if(-1!==o){const e=(null==s?void 0:s.data)||s;Be.value[o]={...e,is_sending:!1}}}catch(s){console.error("Error sending message:",s);const e=Be.value.findIndex(e=>e.id===a);-1!==e&&(Be.value[e].is_failed=!0,Be.value[e].is_sending=!1)}finally{Ne.value=!1}}async function xt(){if(ze.value&&confirm(`–ü–æ–∫–∏–Ω—É—Ç—å —á–∞—Ç "${ze.value.city_name}"?`))try{await I.leaveCityChat(ze.value.id),Le.value=Le.value.filter(e=>e.id!==ze.value.id),st&&st.emit("city_chat:leave",{cityChatId:ze.value.id}),ze.value=null,Be.value=[]}catch(e){console.error("Error leaving chat:",e),alert("–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞ –∏–∑ —á–∞—Ç–∞")}}function pt(){ze.value&&st&&st.emit("city_chat:typing",{cityChatId:ze.value.id})}function ht(e=!1){Oe.value&&setTimeout(()=>{Oe.value&&(Oe.value.scrollTop=Oe.value.scrollHeight)},e?100:50)}function mt(e){if(!e)return"";const t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}function ft(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("blob:"))return e;return"https://help-car.online/api/v1".replace("/api/v1","")+e}function kt(e){console.warn("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:",e.target.src),e.target.style.display="none"}async function wt(){try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});Xe.value=new MediaRecorder(e,{mimeType:"audio/webm"}),Ye.value=[],Xe.value.ondataavailable=e=>{Ye.value.push(e.data)},Xe.value.onstop=async()=>{const t=new Blob(Ye.value,{type:"audio/webm"});await async function(e){var t;if(!(null==(t=ze.value)?void 0:t.id)||0===Ye.value.length)return;try{Ne.value=!0;const t=await I.uploadVoiceMessage(e,Qe.value);if(t.success){const e=await I.client.post(`/chats/${ze.value.id}/messages`,{content:"",voice_url:t.voice_url,voice_duration:t.duration});(null==e?void 0:e.success)&&(null==e?void 0:e.data)&&(Be.value.push({...e.data,sender:Ae.value,created_at:e.data.createdAt||e.data.created_at}),await r(),ht())}}catch(a){console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ:",a)}finally{Ne.value=!1,Qe.value=0}}(t),e.getTracks().forEach(e=>e.stop())},Xe.value.start(),Ke.value=!0,Qe.value=0,tt=setInterval(()=>{Qe.value++},1e3)}catch(e){console.error("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:",e),alert("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É")}}function _t(){Xe.value&&Ke.value&&(Xe.value.stop(),Ke.value=!1,clearInterval(tt))}function Ct(){Xe.value&&Ke.value&&(Xe.value.stop(),Ke.value=!1,clearInterval(tt),Ye.value=[])}function jt(e){console.warn("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ:",e.target.src);const t=e.target.parentElement;t&&(t.innerHTML='<span class="text-xs text-red-500">‚úñ –ê—É–¥–∏–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>')}return a(async()=>{$e.user||await $e.checkAuth(),Ae.value=$e.user||JSON.parse(localStorage.getItem("user")||"null"),await async function(){var e;try{rt.value=!0;const e=await I.getCities({limit:100});e.data&&Array.isArray(e.data)?dt.value=e.data:Array.isArray(e)?dt.value=e:dt.value=[]}catch(t){console.error("Error loading cities:",t),console.error("Error details:",(null==(e=t.response)?void 0:e.data)||t.message),dt.value=[]}finally{rt.value=!1}}(),await async function(){var e;try{const e=await I.getMyCityChats();e.data&&Array.isArray(e.data)?Le.value=e.data:Array.isArray(e)?Le.value=e:Le.value=[]}catch(t){console.error("Error loading my chats:",t),console.error("Error details:",(null==(e=t.response)?void 0:e.data)||t.message),Le.value=[]}}();const e=localStorage.getItem("token");if(e){const t="https:"===window.location.protocol?`wss://${window.location.host}`:`ws://${window.location.host}`;st=j(t.replace(/^ws/,"http"),{auth:{token:e}}),st.on("connect",()=>{var e;(null==(e=ze.value)?void 0:e.id)&&st.emit("city_chat:join",{cityChatId:ze.value.id})}),st.on("city_chat:newMessage",async e=>{var t,a;if((null==(t=null==e?void 0:e.message)?void 0:t.city_chat_id)===(null==(a=ze.value)?void 0:a.id)){if(ot(e.message)){const t=Be.value.findIndex(t=>{var a,l;return(null==(l=null==(a=t.id)?void 0:a.startsWith)?void 0:l.call(a,"temp-"))&&t.content===e.message.content});return void(-1!==t&&(Be.value[t]={...e.message,is_sending:!1}))}Be.value.some(t=>t.id===e.message.id)||(Be.value.push(e.message),await r(),ht())}}),st.on("city_chat:userTyping",e=>{var t,a;e.cityChatId===(null==(t=ze.value)?void 0:t.id)&&String(e.userId)!==String((null==(a=Ae.value)?void 0:a.id)||"")&&(We.value=!0,lt&&clearTimeout(lt),lt=setTimeout(()=>{We.value=!1},2e3))})}}),l(()=>{var e;st&&((null==(e=ze.value)?void 0:e.id)&&st.emit("city_chat:leave",{cityChatId:ze.value.id}),st.disconnect(),st=null)}),(e,t)=>{const a=u("router-link");return k(),s("div",S,[o(M),n("div",T,[n("div",$,[n("div",null,[n("div",A,[o(a,{to:"/",class:"text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-semibold"},{default:d(()=>[...t[6]||(t[6]=[p(" üè† –ì–ª–∞–≤–Ω–∞—è ",-1)])]),_:1}),t[7]||(t[7]=n("span",{class:"text-gray-400 dark:text-gray-500"},"/",-1)),t[8]||(t[8]=n("span",{class:"text-gray-600 dark:text-gray-300 font-semibold"},"–ì–æ—Ä–æ–¥—Å–∫–∏–µ —á–∞—Ç—ã",-1))]),t[9]||(t[9]=n("h1",{class:"text-2xl sm:text-3xl md:text-4xl font-black text-gray-900 dark:text-white"}," üí¨ –ì–æ—Ä–æ–¥—Å–∫–∏–µ —á–∞—Ç—ã ",-1))]),n("div",L,[o(a,{to:"/map",class:"px-3 py-2 text-xs sm:text-sm bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl font-semibold text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"},{default:d(()=>[...t[10]||(t[10]=[p(" üó∫ –ù–∞ –∫–∞—Ä—Ç—É ",-1)])]),_:1}),o(a,{to:"/my-chats",class:"px-3 py-2 text-xs sm:text-sm bg-blue-600 text-white rounded-xl font-semibold hover:bg-blue-700 transition-colors"},{default:d(()=>[...t[11]||(t[11]=[p(" üí¨ –ú–æ–∏ —á–∞—Ç—ã ",-1)])]),_:1})])]),n("div",z,[n("div",{class:c(["lg:col-span-1 space-y-6",ze.value&&nt.value?"hidden":"block"])},[n("div",B,[t[14]||(t[14]=n("h3",{class:"text-xl font-black text-gray-900 dark:text-white mb-4"}," –ú–æ–∏ —á–∞—Ç—ã ",-1)),0===Le.value.length?(k(),s("div",U,[...t[12]||(t[12]=[n("p",{class:"text-gray-400 dark:text-gray-500 mb-3"}," –í—ã –µ—â–µ –Ω–µ –≤ —á–∞—Ç–∞—Ö ",-1),n("p",{class:"text-sm text-gray-500 dark:text-gray-400"}," –í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥ –Ω–∏–∂–µ ",-1)])])):(k(),s("div",V,[(k(!0),s(v,null,g(Le.value,e=>{var a,l;return k(),s("button",{key:e.id,class:c(["w-full text-left p-4 rounded-xl transition-all",(null==(a=ze.value)?void 0:a.id)===e.id?"bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg":"bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 text-gray-900 dark:text-white"]),onClick:t=>function(e){ct(e)}(e)},[n("div",N,[n("div",null,[n("h4",R,h(e.city_name),1),n("p",{class:c([(null==(l=ze.value)?void 0:l.id)===e.id?"text-blue-100":"text-gray-500 dark:text-gray-400","text-sm"])}," üë• "+h(e.participants_count)+" —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ",3)]),t[13]||(t[13]=n("div",{class:"text-2xl"}," üèôÔ∏è ",-1))])],10,H)}),128))]))]),n("div",W,[t[18]||(t[18]=n("h3",{class:"text-xl font-black text-gray-900 dark:text-white mb-4"}," –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è ",-1)),Ae.value?i("",!0):(k(),s("div",O,[...t[15]||(t[15]=[n("p",{class:"text-sm text-yellow-700 dark:text-yellow-300 font-semibold"}," üîí –î–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ —á–∞—Ç–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É ",-1)])])),y(n("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>Ve.value=e),type:"text",placeholder:"üîç –ü–æ–∏—Å–∫ –≥–æ—Ä–æ–¥–∞...",class:"w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-4 transition-colors"},null,512),[[b,Ve.value]]),n("div",P,[rt.value?(k(),s(v,{key:0},g(8,e=>n("div",{key:"s"+e,class:"p-3 bg-gray-100 dark:bg-gray-700 rounded-xl"},[...t[16]||(t[16]=[n("div",{class:"h-4 w-40 bg-gray-200 dark:bg-gray-600 rounded skeleton mb-2"},null,-1),n("div",{class:"h-3 w-24 bg-gray-200 dark:bg-gray-600 rounded skeleton"},null,-1)])])),64)):(k(!0),s(v,{key:1},g(ut.value,e=>(k(),s("button",{key:e.id,disabled:Re.value||!Ae.value,class:"w-full text-left p-3 bg-gray-50 dark:bg-gray-700 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-xl transition-all group disabled:opacity-50",onClick:t=>async function(e){var t,a,l,r;if(!Re.value)try{Re.value=!0;const t=await I.joinCityChat({cityId:e.id,cityName:e.name,region:e.region}),a=(null==t?void 0:t.data)||t;Le.value.find(e=>e.id===a.id)||Le.value.push(a),ct(a)}catch(s){console.error("Error joining chat:",s),console.error("Error details:",(null==(t=s.response)?void 0:t.data)||s.message),401===(null==(a=s.response)?void 0:a.status)?(alert("–ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ."),Te.push("/login")):alert("–û—à–∏–±–∫–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ —á–∞—Ç—É: "+((null==(r=null==(l=s.response)?void 0:l.data)?void 0:r.error)||s.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}finally{Re.value=!1}}(e)},[n("div",G,[n("div",null,[n("h4",J,h(e.name),1),n("p",F,h(e.region),1)]),t[17]||(t[17]=n("div",{class:"text-xl"}," üèôÔ∏è ",-1))])],8,D))),128))])])],2),n("div",{class:c(["lg:col-span-2",ze.value&&nt.value?"col-span-1":""])},[ze.value?(k(),s("div",K,[n("div",Q,[nt.value?(k(),s("button",{key:0,class:"flex items-center gap-2 text-white/80 hover:text-white mb-3 text-sm font-semibold",onClick:it},[...t[20]||(t[20]=[n("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),p(" –ö —Å–ø–∏—Å–∫—É —á–∞—Ç–æ–≤ ",-1)])])):i("",!0),n("div",X,[n("div",null,[n("h3",Y,h(ze.value.city_name),1),n("p",Z," üë• "+h(ze.value.participants_count)+" —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ ‚Ä¢ üí¨ "+h(ze.value.messages_count)+" —Å–æ–æ–±—â–µ–Ω–∏–π ",1)]),n("button",{class:"px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition text-sm font-bold",onClick:xt}," –ü–æ–∫–∏–Ω—É—Ç—å ")])]),n("div",{ref_key:"messagesContainer",ref:Oe,class:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 bg-gray-50 dark:bg-gray-900"},[He.value?(k(),s("div",ee,[(k(),s(v,null,g(10,e=>n("div",{key:"m"+e,class:"max-w-md px-4 py-3 rounded-2xl bg-white dark:bg-gray-700"},[...t[21]||(t[21]=[n("div",{class:"h-3 w-24 bg-gray-200 dark:bg-gray-600 rounded skeleton mb-2"},null,-1),n("div",{class:"h-4 w-64 bg-gray-200 dark:bg-gray-600 rounded skeleton mb-2"},null,-1),n("div",{class:"h-4 w-52 bg-gray-200 dark:bg-gray-600 rounded skeleton"},null,-1)])])),64))])):0===Be.value.length?(k(),s("div",te,[...t[22]||(t[22]=[n("p",{class:"text-gray-400 dark:text-gray-500 font-semibold"}," –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –Ω–∞–ø–∏—à–µ—Ç! ",-1)])])):(k(!0),s(v,{key:2},g(Be.value,e=>{return k(),s("div",{key:e.id,class:c(["flex",ot(e)?"justify-end":"justify-start"])},[n("div",{class:c(["max-w-md px-4 py-3 rounded-2xl",ot(e)?"bg-gradient-to-r from-blue-500 to-purple-600 text-white":"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-md"])},[ot(e)?i("",!0):(k(),w(a,{key:0,to:`/user/${e.sender.id}`,class:c(["text-xs font-bold mb-1 hover:underline block",ot(e)?"text-blue-100":"text-blue-600 dark:text-blue-400"])},{default:d(()=>[p(h(e.sender.full_name)+" ",1),o(E,{status:e.sender.premium_status,size:"xs",class:"inline-block ml-1"},null,8,["status"]),p(" ‚Ä¢ ‚≠ê "+h(e.sender.rating||"0.00"),1)]),_:2},1032,["to","class"])),e.image_url?(k(),s("div",ae,[n("img",{src:ft(e.thumbnail_url||e.image_url),alt:e.content||"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",class:"max-w-full rounded-xl cursor-pointer hover:opacity-90 transition",style:{"max-height":"300px","object-fit":"contain"},onClick:t=>{return a=e.image_url,void(Fe.value=a);var a},onError:kt},null,40,le)])):i("",!0),e.voice_url?(k(),s("div",re,[n("div",{class:c(["flex items-center gap-3 p-2 rounded-xl",ot(e)?"bg-white/20":"bg-gray-100 dark:bg-gray-600"])},[n("button",{type:"button",onClick:t=>function(e){const t=et[e];t&&(Object.entries(et).forEach(([t,a])=>{t===e||a.paused||(a.pause(),a.currentTime=0)}),Ze.value===e?(t.pause(),Ze.value=null):(t.play().catch(e=>{console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ:",e)}),Ze.value=e))}(e.id),class:c(["w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 transition",ot(e)?"bg-white/30 hover:bg-white/40 text-white":"bg-blue-500 hover:bg-blue-600 text-white"])},[Ze.value!==e.id?(k(),s("svg",oe,[...t[23]||(t[23]=[n("path",{d:"M8 5v14l11-7z"},null,-1)])])):(k(),s("svg",ne,[...t[24]||(t[24]=[n("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])]))],10,se),n("div",ie,[n("div",de,[n("div",{class:c(["flex-1 h-1 rounded-full",ot(e)?"bg-white/30":"bg-gray-300 dark:bg-gray-500"])},[n("div",{class:"h-full rounded-full bg-current w-0",id:`voice-progress-${e.id}`},null,8,ue)],2),n("span",{class:c(["text-xs",ot(e)?"text-white/70":"text-gray-500 dark:text-gray-400"])},h((l=e.voice_duration,l?`${Math.floor(l/60)}:${Math.floor(l%60).toString().padStart(2,"0")}`:"0:00")),3)])]),n("audio",{ref_for:!0,ref:t=>{t&&(et[e.id]=t)},src:ft(e.voice_url),onEnded:t=>function(e){Ze.value=null;const t=document.getElementById(`voice-progress-${e}`);t&&(t.style.width="0%")}(e.id),onTimeupdate:t=>function(e,t){const a=t.target,l=a.currentTime/a.duration*100,r=document.getElementById(`voice-progress-${e}`);r&&(r.style.width=`${l}%`)}(e.id,t),onError:jt,class:"hidden"},null,40,ce)],2)])):i("",!0),e.content?(k(),s("p",ve,h(e.content),1)):i("",!0),n("div",{class:c(["flex items-center gap-1.5 text-xs mt-1",ot(e)?"text-blue-100 justify-end":"text-gray-400 dark:text-gray-500"])},[n("span",null,h(mt(e.created_at)),1),ot(e)?(k(),s("span",{key:0,class:c(e.is_read?"text-blue-300":"opacity-70")},h(e.is_read?"‚úì‚úì":"‚úì"),3)):i("",!0)],2)],2)],2);var l}),128)),We.value?(k(),s("div",ge,[...t[25]||(t[25]=[x('<div class="bg-gray-200 dark:bg-gray-700 rounded-2xl px-4 py-3" data-v-42dcbac7><div class="flex space-x-2" data-v-42dcbac7><div class="w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce" style="animation-delay:0s;" data-v-42dcbac7></div><div class="w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce" style="animation-delay:0.2s;" data-v-42dcbac7></div><div class="w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce" style="animation-delay:0.4s;" data-v-42dcbac7></div></div></div>',1)])])):i("",!0)],512),Ae.value?i("",!0):(k(),s("div",ye,[n("div",be,[t[28]||(t[28]=n("h3",{class:"text-lg font-bold text-yellow-800 dark:text-yellow-200 mb-2"}," üîí –¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ",-1)),t[29]||(t[29]=n("p",{class:"text-sm text-yellow-700 dark:text-yellow-300 mb-3"}," –î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É ",-1)),n("div",xe,[o(a,{to:"/login",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold text-sm hover:bg-blue-700 transition"},{default:d(()=>[...t[26]||(t[26]=[p(" –í–æ–π—Ç–∏ ",-1)])]),_:1}),o(a,{to:"/register",class:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg font-bold text-sm hover:bg-green-700 transition"},{default:d(()=>[...t[27]||(t[27]=[p(" –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ",-1)])]),_:1})])])])),Ae.value?(k(),s("div",pe,[Ke.value?(k(),s("div",he,[t[30]||(t[30]=n("div",{class:"w-3 h-3 bg-red-500 rounded-full animate-pulse"},null,-1)),n("span",me,"–ó–∞–ø–∏—Å—å "+h((l=Qe.value,`${Math.floor(l/60)}:${(l%60).toString().padStart(2,"0")}`)),1),t[31]||(t[31]=n("div",{class:"flex-1"},null,-1)),n("button",{type:"button",onClick:Ct,class:"p-2 text-gray-500 hover:text-gray-700"},"‚úï"),n("button",{type:"button",onClick:_t,class:"px-4 py-1.5 bg-red-600 text-white rounded-full text-sm font-medium hover:bg-red-700"},"–û—Ç–ø—Ä–∞–≤–∏—Ç—å")])):i("",!0),De.value?(k(),s("div",fe,[n("img",{src:Ge.value,class:"h-20 rounded-lg object-cover"},null,8,ke),n("button",{type:"button",class:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-sm hover:bg-red-600 transition",onClick:yt}," ‚úï "),Je.value?(k(),s("div",we,[...t[32]||(t[32]=[n("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)])])):i("",!0)])):i("",!0),n("form",{class:"flex gap-3",onSubmit:m(bt,["prevent"])},[n("button",{type:"button",class:"px-3 py-3 bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition",disabled:Je.value,onClick:vt},[...t[33]||(t[33]=[n("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,_e),n("input",{ref_key:"imageInputRef",ref:Pe,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",class:"hidden",onChange:gt},null,544),y(n("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>Ue.value=e),type:"text",placeholder:"–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...",class:"flex-1 px-4 py-3 border-2 border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",onInput:pt},null,544),[[b,Ue.value]]),n("div",Ce,[n("button",{type:"button",class:"px-3 py-3 bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 rounded-xl hover:bg-gray-200 dark:hover:bg-gray-600 transition text-xl",onClick:t[2]||(t[2]=e=>qe.value=!qe.value)}," üòä "),qe.value?(k(),s("div",je,[n("div",Ie,[(k(),s(v,null,g(at,e=>n("button",{key:e,type:"button",class:"w-8 h-8 flex items-center justify-center text-xl hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition",onClick:t=>function(e){Ue.value+=e,qe.value=!1}(e)},h(e),9,Me)),64))])])):i("",!0)]),Ue.value.trim()||De.value||Ke.value?(k(),s("button",{key:1,type:"submit",disabled:!Ue.value.trim()&&!De.value||Ne.value||Je.value,class:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-bold hover:from-blue-600 hover:to-purple-700 transition disabled:opacity-50 disabled:cursor-not-allowed"},h(Ne.value?"‚è≥":"üì§"),9,Ee)):(k(),s("button",{key:0,type:"button",class:"px-3 py-3 bg-gray-100 dark:bg-gray-700 text-gray-500 rounded-xl hover:bg-red-100 hover:text-red-500 transition",onClick:wt},[...t[34]||(t[34]=[n("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})],-1)])]))],32)])):i("",!0)])):(k(),s("div",q,[...t[19]||(t[19]=[x('<div data-v-42dcbac7><div class="w-32 h-32 bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900/50 dark:to-purple-900/50 rounded-full flex items-center justify-center mx-auto mb-6" data-v-42dcbac7><svg class="w-16 h-16 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-42dcbac7><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" data-v-42dcbac7></path></svg></div><h3 class="text-2xl font-black text-gray-900 dark:text-white mb-2" data-v-42dcbac7> –í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç </h3><p class="text-gray-500 dark:text-gray-400" data-v-42dcbac7> –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç–µ—Å—å –∫ —á–∞—Ç—É —Å–≤–æ–µ–≥–æ –≥–æ—Ä–æ–¥–∞ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ </p></div>',1)])]))],2)])]),Fe.value?(k(),s("div",{key:0,class:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:t[5]||(t[5]=e=>Fe.value=null)},[n("button",{class:"absolute top-4 right-4 w-10 h-10 bg-white/10 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition",onClick:t[3]||(t[3]=e=>Fe.value=null)}," ‚úï "),n("img",{src:ft(Fe.value),class:"max-w-full max-h-full object-contain",onClick:t[4]||(t[4]=m(()=>{},["stop"]))},null,8,Se)])):i("",!0)]);var l}}},[["__scopeId","data-v-42dcbac7"]]);export{Te as default};
