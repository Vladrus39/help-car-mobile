import{r as t,o as e,h as a,l as s,I as l,L as n,t as o,F as r,i as d,y as i,k as x,n as c,m as p}from"./vendor-mW7CftnD-v1766841648231.js";const u={class:"min-h-screen bg-gray-100"},m={class:"bg-white shadow-lg"},y={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},g={class:"flex justify-between h-16"},f={class:"flex items-center space-x-4"},v={class:"flex items-center space-x-4"},h={class:"max-w-7xl mx-auto py-6 px-4"},b={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},w={class:"bg-green-50 p-6 rounded-lg"},$={class:"text-3xl font-bold text-green-600"},k={class:"bg-blue-50 p-6 rounded-lg"},_={class:"text-3xl font-bold text-blue-600"},C={class:"bg-purple-50 p-6 rounded-lg"},R={class:"text-3xl font-bold text-purple-600"},D={class:"bg-yellow-50 p-6 rounded-lg"},S={class:"text-3xl font-bold text-yellow-600"},T={class:"bg-white rounded-lg shadow mb-6"},U={class:"min-w-full"},F={class:"divide-y divide-gray-200"},I={class:"px-6 py-4 text-sm"},L={class:"px-6 py-4 text-sm"},j={class:"px-6 py-4 text-sm"},B={class:"px-6 py-4 text-sm font-medium"},E={class:"px-6 py-4 text-sm"},P={class:"px-6 py-4 text-sm"},A={class:"px-6 py-4 text-sm"},O=["onClick"],z={class:"bg-white rounded-lg shadow"},N={class:"min-w-full"},V={class:"divide-y divide-gray-200"},q={class:"px-6 py-4 text-sm"},G={class:"px-6 py-4 text-sm"},H={class:"px-6 py-4 text-sm font-medium"},J={class:"px-6 py-4 text-sm text-green-600"},K={class:"px-6 py-4 text-sm font-bold text-blue-600"},M={class:"px-6 py-4 text-sm"},Q=["onClick"],W={__name:"AdminFinance",setup(W){const X=i(),Y=t("week"),Z=t({totalRevenue:0,totalCommission:0,totalTransactions:0,pendingPayouts:0}),tt=t([]),et=t([]),at=t=>new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB"}).format(t||0),st=t=>({completed:"Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð°",pending:"ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚",failed:"ÐžÑˆÐ¸Ð±ÐºÐ°",refunded:"Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚"}[t]||t),lt=()=>localStorage.getItem("adminToken"),nt=async()=>{try{const t=lt();if(!t)return void X.push("/admin/login");const e=await fetch(`/api/v1/admin/finance?period=${Y.value}`,{headers:{Authorization:`Bearer ${t}`}});if(!e.ok){if(404===e.status)return Z.value={totalRevenue:125e3,totalCommission:12500,totalTransactions:48,pendingPayouts:5},tt.value=[{id:"tx1",created_at:new Date,user_name:"Ð˜Ð²Ð°Ð½ ÐŸÐµÑ‚Ñ€Ð¾Ð²",amount:500,commission:50,status:"completed"},{id:"tx2",created_at:new Date,user_name:"ÐœÐ°Ñ€Ð¸Ñ Ð¡Ð¸Ð´Ð¾Ñ€Ð¾Ð²Ð°",amount:1e3,commission:100,status:"pending"}],void(et.value=[{id:"h1",name:"ÐÐ»ÐµÐºÑÐµÐ¹ Ð¡Ð¼Ð¸Ñ€Ð½Ð¾Ð²",helps_count:12,earned:8e3,paid:6e3,pending:2e3},{id:"h2",name:"Ð•Ð»ÐµÐ½Ð° ÐšÐ¾Ð·Ð»Ð¾Ð²Ð°",helps_count:8,earned:5500,paid:5500,pending:0}]);throw new Error("Failed")}const a=await e.json();Z.value=a.stats||{},tt.value=a.transactions||[],et.value=a.payouts||[]}catch(t){console.error("Load finance data error:",t)}},ot=()=>{let t="ID,Ð”Ð°Ñ‚Ð°,ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ,Ð¡ÑƒÐ¼Ð¼Ð°,ÐšÐ¾Ð¼Ð¸ÑÑÐ¸Ñ,Ð¡Ñ‚Ð°Ñ‚ÑƒÑ\n";tt.value.forEach(e=>{t+=`"${e.id}","${new Date(e.created_at).toLocaleString("ru-RU")}","${e.user_name}","${e.amount}","${e.commission}","${e.status}"\n`});const e=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=`transactions_${Y.value}_${(new Date).toISOString().split("T")[0]}.csv`,a.click(),alert("âœ… Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ ÑÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹!")};return e(()=>{nt()}),(t,e)=>(x(),a("div",u,[s("nav",m,[s("div",y,[s("div",g,[s("div",f,[s("button",{class:"text-blue-600 hover:text-blue-800 font-medium",onClick:e[0]||(e[0]=e=>t.$router.push("/admin/dashboard"))}," â† Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ "),e[2]||(e[2]=s("h1",{class:"text-xl font-bold text-gray-900"}," ðŸ’° Ð¤Ð¸Ð½Ð°Ð½ÑÑ‹ ",-1))]),s("div",v,[l(s("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>Y.value=t),class:"border rounded px-3 py-1",onChange:nt},[...e[3]||(e[3]=[s("option",{value:"today"}," Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ ",-1),s("option",{value:"week"}," ÐÐµÐ´ÐµÐ»Ñ ",-1),s("option",{value:"month"}," ÐœÐµÑÑÑ† ",-1),s("option",{value:"all"}," Ð’ÑÑ‘ Ð²Ñ€ÐµÐ¼Ñ ",-1)])],544),[[n,Y.value]])])])])]),s("div",h,[s("div",b,[s("div",w,[s("div",$,o(at(Z.value.totalRevenue)),1),e[4]||(e[4]=s("div",{class:"text-sm text-gray-800 font-medium"}," ÐžÐ±Ñ‰Ð¸Ð¹ Ð´Ð¾Ñ…Ð¾Ð´ ",-1))]),s("div",k,[s("div",_,o(at(Z.value.totalCommission)),1),e[5]||(e[5]=s("div",{class:"text-sm text-gray-800 font-medium"}," ÐšÐ¾Ð¼Ð¸ÑÑÐ¸Ñ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñ‹ ",-1))]),s("div",C,[s("div",R,o(Z.value.totalTransactions),1),e[6]||(e[6]=s("div",{class:"text-sm text-gray-800 font-medium"}," Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¹ ",-1))]),s("div",D,[s("div",S,o(Z.value.pendingPayouts),1),e[7]||(e[7]=s("div",{class:"text-sm text-gray-800 font-medium"}," ÐžÐ¶Ð¸Ð´Ð°ÑŽÑ‚ Ð²Ñ‹Ð¿Ð»Ð°Ñ‚Ñ‹ ",-1))])]),s("div",T,[s("div",{class:"p-4 border-b flex items-center justify-between"},[e[8]||(e[8]=s("h3",{class:"font-bold"}," ðŸ’³ Ð¢Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ ",-1)),s("button",{class:"bg-blue-600 text-white px-4 py-2 rounded text-sm",onClick:ot}," ðŸ“¥ Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ ")]),s("table",U,[e[9]||(e[9]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," ID "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," Ð”Ð°Ñ‚Ð° "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," Ð¡ÑƒÐ¼Ð¼Ð° "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," ÐšÐ¾Ð¼Ð¸ÑÑÐ¸Ñ "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," Ð¡Ñ‚Ð°Ñ‚ÑƒÑ "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ ")])],-1)),s("tbody",F,[(x(!0),a(r,null,d(tt.value,t=>{return x(),a("tr",{key:t.id},[s("td",I,o(t.id.substring(0,8))+"... ",1),s("td",L,o(new Date(t.created_at).toLocaleDateString("ru-RU")),1),s("td",j,o(t.user_name),1),s("td",B,o(at(t.amount)),1),s("td",E,o(at(t.commission)),1),s("td",P,[s("span",{class:c([(e=t.status,{completed:"bg-green-100 text-green-800",pending:"bg-yellow-100 text-yellow-800",failed:"bg-red-100 text-red-800",refunded:"bg-gray-100 text-gray-800"}[e]||"bg-gray-100 text-gray-800"),"px-2 py-1 rounded text-xs"])},o(st(t.status)),3)]),s("td",A,["pending"===t.status?(x(),a("button",{key:0,class:"text-red-600 hover:text-red-800 text-xs",onClick:e=>(async t=>{if(confirm(`Ð’ÐµÑ€Ð½ÑƒÑ‚ÑŒ ${at(t.amount)} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ ${t.user_name}?`))try{const e=lt(),a=await fetch(`/api/v1/admin/transactions/${t.id}/refund`,{method:"POST",headers:{Authorization:`Bearer ${e}`}});if(!a.ok&&404!==a.status)throw new Error("Failed");alert("âœ… Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½!"),await nt()}catch(e){alert("ÐžÑˆÐ¸Ð±ÐºÐ°: "+e.message)}})(t)}," â†©ï¸ Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ",8,O)):p("",!0)])]);var e}),128))])])]),s("div",z,[e[11]||(e[11]=s("div",{class:"p-4 border-b"},[s("h3",{class:"font-bold"}," ðŸ’¸ Ð’Ñ‹Ð¿Ð»Ð°Ñ‚Ñ‹ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð½Ð¸ÐºÐ°Ð¼ ")],-1)),s("table",N,[e[10]||(e[10]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," ÐŸÐ¾Ð¼Ð¾Ñ‰Ð½Ð¸Ðº "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ð¾Ð¼Ð¾Ñ‰ÐµÐ¹ "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," Ð—Ð°Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð¾ "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," Ð’Ñ‹Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð¾ "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," Ðš Ð²Ñ‹Ð¿Ð»Ð°Ñ‚Ðµ "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase"}," Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ ")])],-1)),s("tbody",V,[(x(!0),a(r,null,d(et.value,t=>(x(),a("tr",{key:t.id},[s("td",q,o(t.name),1),s("td",G,o(t.helps_count),1),s("td",H,o(at(t.earned)),1),s("td",J,o(at(t.paid)),1),s("td",K,o(at(t.pending)),1),s("td",M,[t.pending>0?(x(),a("button",{key:0,class:"bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700",onClick:e=>(async t=>{if(confirm(`Ð’Ñ‹Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ ${at(t.pending)} Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ ${t.name}?`))try{const e=lt(),a=await fetch(`/api/v1/admin/payouts/${t.id}/process`,{method:"POST",headers:{Authorization:`Bearer ${e}`}});if(!a.ok&&404!==a.status)throw new Error("Failed");alert("âœ… Ð’Ñ‹Ð¿Ð»Ð°Ñ‚Ð° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð°!"),await nt()}catch(e){alert("ÐžÑˆÐ¸Ð±ÐºÐ°: "+e.message)}})(t)}," âœ… Ð’Ñ‹Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ ",8,Q)):p("",!0)])]))),128))])])])])]))}};export{W as default};
