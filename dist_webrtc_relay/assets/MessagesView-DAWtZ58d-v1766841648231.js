import{r as e,c as t,o as a,h as s,f as r,l,m as n,v as i,n as o,t as d,u,F as c,i as g,g as x,x as p,y,k as v,G as f,e as b}from"./vendor-mW7CftnD-v1766841648231.js";import{_ as m}from"./NavigationHeader-D1-yZAwQ-v1766841648231.js";import{P as h}from"./PremiumBadge-BKcrm2Br-v1766841648231.js";import{f as k,a as w}from"./index-BT06tprM-v1766841648231.js";import"./utils-BM9RleeF-v1766841648231.js";import"./maps-CCq-KL9W-v1766841648231.js";const j={class:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 dark:from-gray-900 dark:to-gray-800"},_={class:"max-w-2xl mx-auto py-8 px-4"},C={class:"flex gap-2 mb-6 bg-white dark:bg-gray-800 rounded-xl p-1 shadow-md"},U={key:0,class:"bg-red-500 text-white text-xs px-2 py-0.5 rounded-full"},M={key:0,class:"bg-orange-500 text-white text-xs px-2 py-0.5 rounded-full"},$={key:0},I={key:0,class:"space-y-4"},q={key:1,class:"text-center py-16"},D={key:2,class:"space-y-3"},R={class:"flex items-center gap-4"},F={key:0,class:"w-14 h-14 rounded-full overflow-hidden flex-shrink-0"},N=["src","alt"],P={key:1,class:"w-14 h-14 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-xl font-bold flex-shrink-0"},z={class:"flex-1 min-w-0"},A={class:"flex items-center justify-between mb-1"},B={class:"flex items-center gap-2 min-w-0"},G={class:"font-bold text-gray-900 dark:text-white truncate"},H={class:"text-xs text-gray-400"},L={class:"text-sm text-gray-500 dark:text-gray-400 truncate"},S={key:2,class:"w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs font-bold flex-shrink-0"},T={key:1},V={key:0,class:"text-center py-16"},W={key:1,class:"space-y-4"},E={class:"flex items-start gap-4"},J={class:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full flex items-center justify-center text-white text-lg font-bold flex-shrink-0"},K={class:"flex-1 min-w-0"},O={class:"flex items-center justify-between mb-1"},Q={class:"font-bold text-gray-900 dark:text-white"},X={class:"text-xs text-gray-400"},Y={class:"text-sm text-purple-600 dark:text-purple-400 font-medium mb-1"},Z={class:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3 mb-3"},ee={class:"text-sm text-gray-800 dark:text-gray-200 font-medium"},te={key:0,class:"text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2"},ae={key:0,class:"mb-3"},se={key:1,class:"flex gap-2"},re=["onClick"],le=["onClick"],ne=["onClick"],ie={key:2,class:"mt-6 text-center"},oe={__name:"MessagesView",setup(oe){const de=y(),ue=k(),ce=e([]),ge=e(!0),xe=e("chats"),pe=t(()=>ce.value.reduce((e,t)=>e+(t.unread_count||0),0)),ye=e=>e?e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?",ve=e=>{if(!e&&"number"!=typeof e)return"";const t=new Date(e),a=new Date-t,s=Math.floor(a/6e4),r=Math.floor(a/36e5),l=Math.floor(a/864e5);return s<1?"—Å–µ–π—á–∞—Å":s<60?`${s} –º–∏–Ω`:r<24?`${r} —á`:l<7?`${l} –¥–Ω`:t.toLocaleDateString("ru-RU",{day:"numeric",month:"short"})},fe={flat_tire:"üö® –ü—Ä–æ–±–∏—Ç–æ –∫–æ–ª–µ—Å–æ",battery:"üîã –°–µ–ª –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä",fuel:"‚õΩ –ö–æ–Ω—á–∏–ª–æ—Å—å —Ç–æ–ø–ª–∏–≤–æ",tow:"üöó –ù—É–∂–Ω–∞ –±—É–∫—Å–∏—Ä–æ–≤–∫–∞",engine:"üîß –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–≤–∏–≥–∞—Ç–µ–ª–µ–º",keys:"üîë –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –∫–ª—é—á–∏",accident:"üö® –î–¢–ü",other:"‚ùì –î—Ä—É–≥–æ–µ"},be=()=>{confirm("–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è?")&&ue.clearAll()};function me(e){if(!e)return null;if(e.startsWith("http"))return e;return"https://help-car.online/api/v1".replace("/api/v1","")+e}return a(()=>{(async()=>{try{ge.value=!0;const e=await w.client.get("/chats/direct");ce.value=(null==e?void 0:e.data)||e||[]}catch(e){console.error("Failed to load direct chats:",e)}finally{ge.value=!1}})(),ue.pendingCount>0&&(xe.value="invitations")}),(e,t)=>{const a=p("router-link");return v(),s("div",j,[r(m),l("div",_,[t[12]||(t[12]=l("h1",{class:"text-2xl font-black text-gray-900 dark:text-white mb-6 flex items-center gap-3"},[l("span",{class:"text-3xl"},"‚úâÔ∏è"),i(" –°–æ–æ–±—â–µ–Ω–∏—è ")],-1)),l("div",C,[l("button",{class:o(["flex-1 py-3 px-4 rounded-lg font-bold transition flex items-center justify-center gap-2","chats"===xe.value?"bg-blue-600 text-white":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"]),onClick:t[0]||(t[0]=e=>xe.value="chats")},[t[2]||(t[2]=i(" üí¨ –ß–∞—Ç—ã ",-1)),pe.value>0?(v(),s("span",U,d(pe.value>9?"9+":pe.value),1)):n("",!0)],2),l("button",{class:o(["flex-1 py-3 px-4 rounded-lg font-bold transition flex items-center justify-center gap-2","invitations"===xe.value?"bg-purple-600 text-white":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"]),onClick:t[1]||(t[1]=e=>xe.value="invitations")},[t[3]||(t[3]=i(" üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è ",-1)),u(ue).pendingCount>0?(v(),s("span",M,d(u(ue).pendingCount),1)):n("",!0)],2)]),"chats"===xe.value?(v(),s("div",$,[ge.value?(v(),s("div",I,[(v(),s(c,null,g(3,e=>l("div",{key:e,class:"bg-white dark:bg-gray-800 rounded-xl p-4 animate-pulse"},[...t[4]||(t[4]=[f('<div class="flex items-center gap-4"><div class="w-14 h-14 bg-gray-200 dark:bg-gray-700 rounded-full"></div><div class="flex-1"><div class="h-5 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-2"></div><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"></div></div></div>',1)])])),64))])):0===ce.value.length?(v(),s("div",q,[t[6]||(t[6]=l("div",{class:"w-24 h-24 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mx-auto mb-4"},[l("span",{class:"text-4xl"},"üí¨")],-1)),t[7]||(t[7]=l("h2",{class:"text-xl font-bold text-gray-700 dark:text-gray-200 mb-2"}," –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π ",-1)),t[8]||(t[8]=l("p",{class:"text-gray-500 dark:text-gray-400 mb-6"}," –ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ, –Ω–∞–∂–∞–≤ –Ω–∞ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ",-1)),r(a,{to:"/map",class:"px-6 py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 transition"},{default:x(()=>[...t[5]||(t[5]=[i(" üó∫ –ù–∞ –∫–∞—Ä—Ç—É ",-1)])]),_:1})])):(v(),s("div",D,[(v(!0),s(c,null,g(ce.value,e=>(v(),b(a,{key:e.id,to:`/direct-chat/${e.id}`,class:"block bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md hover:shadow-lg transition"},{default:x(()=>{var t,a,i,o,u;return[l("div",R,[(null==(t=e.otherUser)?void 0:t.avatar_url)?(v(),s("div",F,[l("img",{src:me(e.otherUser.avatar_url),alt:e.otherUser.full_name,class:"w-full h-full object-cover"},null,8,N)])):(v(),s("div",P,d(ye(null==(a=e.otherUser)?void 0:a.full_name)),1)),l("div",z,[l("div",A,[l("div",B,[l("h3",G,d((null==(i=e.otherUser)?void 0:i.full_name)||"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å"),1),r(h,{status:null==(o=e.otherUser)?void 0:o.premium_status,size:"xs"},null,8,["status"])]),l("span",H,d(ve(e.last_message_at)),1)]),l("p",L,d((null==(u=e.lastMessage)?void 0:u.content)||"–ù–∞—á–Ω–∏—Ç–µ –æ–±—â–µ–Ω–∏–µ..."),1)]),e.unread_count>0?(v(),s("div",S,d(e.unread_count>9?"9+":e.unread_count),1)):n("",!0)])]}),_:2},1032,["to"]))),128))]))])):n("",!0),"invitations"===xe.value?(v(),s("div",T,[0===u(ue).invitations.length?(v(),s("div",V,[...t[9]||(t[9]=[l("div",{class:"w-24 h-24 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center mx-auto mb-4"},[l("span",{class:"text-4xl"},"üë•")],-1),l("h2",{class:"text-xl font-bold text-gray-700 dark:text-gray-200 mb-2"}," –ù–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π ",-1),l("p",{class:"text-gray-500 dark:text-gray-400"}," –ö–æ–≥–¥–∞ –¥—Ä—É–∑—å—è –ø—Ä–∏–≥–ª–∞—Å—è—Ç –≤–∞—Å –ø–æ–º–æ—á—å, –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å ",-1)])])):(v(),s("div",W,[(v(!0),s(c,null,g(u(ue).invitations,e=>{var r,c,g;return v(),s("div",{key:e.id,class:o(["bg-white dark:bg-gray-800 rounded-xl p-4 shadow-md transition","pending"===e.status?"ring-2 ring-purple-400":"opacity-75"])},[l("div",E,[l("div",J,d(ye(null==(r=e.sender)?void 0:r.name)),1),l("div",K,[l("div",O,[l("h3",Q,d((null==(c=e.sender)?void 0:c.name)||"–î—Ä—É–≥"),1),l("span",X,d(ve(e.timestamp)),1)]),l("p",Y,d(e.message||"–ü—Ä–∏–≥–ª–∞—à–∞–µ—Ç –ø–æ–º–æ—á—å –≤–º–µ—Å—Ç–µ!"),1),l("div",Z,[t[10]||(t[10]=l("p",{class:"text-xs text-gray-500 dark:text-gray-400 mb-1"}," –ó–∞—è–≤–∫–∞: ",-1)),l("p",ee,d((g=e.problemType,fe[g]||g||"–ü–æ–º–æ—â—å")),1),e.description?(v(),s("p",te,d(e.description),1)):n("",!0)]),"pending"!==e.status?(v(),s("div",ae,[l("span",{class:o(["px-3 py-1 rounded-full text-xs font-bold","accepted"===e.status?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"])},d("accepted"===e.status?"‚úì –ü—Ä–∏–Ω—è—Ç–æ":"‚úó –û—Ç–∫–ª–æ–Ω–µ–Ω–æ"),3)])):n("",!0),"pending"===e.status?(v(),s("div",se,[l("button",{class:"flex-1 py-2 px-4 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold transition flex items-center justify-center gap-2",onClick:t=>(async e=>{ue.acceptInvitation(e.id),de.push(`/request/${e.helpRequestId}`)})(e)}," ‚úì –ü—Ä–∏–Ω—è—Ç—å ",8,re),l("button",{class:"flex-1 py-2 px-4 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-lg font-bold transition flex items-center justify-center gap-2",onClick:t=>{return a=e,void ue.declineInvitation(a.id);var a}}," ‚úó –û—Ç–∫–ª–æ–Ω–∏—Ç—å ",8,le)])):n("",!0),"accepted"===e.status?(v(),b(a,{key:2,to:`/request/${e.helpRequestId}`,class:"block w-full py-2 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold transition text-center"},{default:x(()=>[...t[11]||(t[11]=[i(" üîó –ü–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞—è–≤–∫–µ ",-1)])]),_:1},8,["to"])):n("",!0)]),"pending"!==e.status?(v(),s("button",{key:0,class:"p-2 text-gray-400 hover:text-red-500 transition",title:"–£–¥–∞–ª–∏—Ç—å",onClick:t=>u(ue).removeInvitation(e.id)}," ‚úï ",8,ne)):n("",!0)])],2)}),128))])),u(ue).invitations.length>0?(v(),s("div",ie,[l("button",{class:"text-sm text-gray-500 hover:text-red-500 transition",onClick:be}," üóë –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è ")])):n("",!0)])):n("",!0)])])}}};export{oe as default};
