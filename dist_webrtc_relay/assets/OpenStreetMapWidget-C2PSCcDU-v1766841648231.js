import{L as e}from"./maps-CCq-KL9W-v1766841648231.js";import{u as n,a as o,w as t}from"./index-BT06tprM-v1766841648231.js";import{r as a,o as r,a as i,w as l,h as s,k as d,l as c,m as p,u,t as g}from"./vendor-mW7CftnD-v1766841648231.js";const f={class:"relative w-full h-full rounded-2xl overflow-hidden shadow-2xl"},m={key:0,class:"absolute bottom-4 right-4 bg-white/95 backdrop-blur-sm rounded-2xl shadow-2xl p-4 flex items-center gap-4 pointer-events-none",style:{"z-index":"500"}},h={class:"text-center"},b={class:"text-xl font-black text-green-600"},x={class:"text-center"},v={class:"text-xl font-black text-blue-600"},y={__name:"OpenStreetMapWidget",props:{requests:{type:Array,default:()=>[]},isAuthenticated:{type:Boolean,default:!1},showHelpers:{type:Boolean,default:!0}},emits:["ready","request-clicked","helper-clicked","share-request"],setup(y,{expose:w,emit:_}){const k=y,$=_,z=n(),L=e=>{if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;return`${"https://help-car.online/api/v1".replace("/api/v1","")}${e}`};let N=null;const q=[],I=[];let j=null,P=null,M=null,A=null,T=null;const O=a(null),R=a("bg-gray-400"),S=a("text-gray-700");function C(){var n;if(!N)return void console.warn("‚ö†Ô∏è –ö–∞—Ä—Ç–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∞—Ä–∫–µ—Ä—ã");if(!N._container||!N._panes||!N._panes.markerPane)return console.warn("‚ö†Ô∏è –ö–∞—Ä—Ç–∞ –µ—â–µ –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞, –∂–¥–µ–º..."),void(N.whenReady?N.whenReady(()=>{setTimeout(()=>{N&&N._panes&&N._panes.markerPane&&C()},50)}):setTimeout(()=>{N&&N._panes&&N._panes.markerPane&&C()},100));q.forEach(e=>{try{e.remove()}catch(n){console.warn("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–∞—Ä–∫–µ—Ä–∞:",n)}}),q.length=0;const o=k.requests&&k.requests.length>0?k.requests:[];if(console.log(`üó∫Ô∏è OpenStreetMap: –ø–æ–ª—É—á–µ–Ω–æ –∑–∞—è–≤–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${o.length}`),0===o.length)return void console.log("üìã –ù–µ—Ç –∑–∞—è–≤–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ");const t={battery:"üîã",fuel:"‚õΩ",tire:"üõû",towing:"üöó",sober_driver:"üöï",road_conflict:"üö®",other:"üîß"};if(o.forEach((n,a)=>{console.log(`üîç –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞—è–≤–∫–∏ ${a+1}/${o.length}:`,{id:n.id,lat:n.lat,latitude:n.latitude,lon:n.lon,longitude:n.longitude,status:n.status});const r=n.lat??n.latitude??(n.coordinates&&Array.isArray(n.coordinates)?n.coordinates[0]:null),i=n.lon??n.longitude??(n.coordinates&&Array.isArray(n.coordinates)?n.coordinates[1]:null),l="string"==typeof r?parseFloat(r):"number"==typeof r?r:NaN,s="string"==typeof i?parseFloat(i):"number"==typeof i?i:NaN,d=n.type||n.problem_type||"other";if(console.log(`üìç –ó–∞—è–≤–∫–∞ ${n.id}: raw lat=${r}, raw lon=${i}, parsed lat=${l}, parsed lon=${s}`),"number"!=typeof l||"number"!=typeof s||isNaN(l)||isNaN(s)||l<-90||l>90||s<-180||s>180)return void console.warn("‚ö†Ô∏è –ü—Ä–æ–ø—É—Å–∫–∞—é –∑–∞—è–≤–∫—É —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏:",{id:n.id,latRaw:r,lonRaw:i,lat:l,lon:s,request:n});const c=e.divIcon({className:"custom-marker",html:`\n        <div class="marker-badge">\n          ${t[d]||"üîß"} ${n.amount||0}‚ÇΩ\n        </div>\n      `,iconSize:[100,44],iconAnchor:[50,44],popupAnchor:[0,-48]}),p={battery:"–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä",fuel:"–¢–æ–ø–ª–∏–≤–æ",tire:"–ö–æ–ª–µ—Å–æ",towing:"–ë—É–∫—Å–∏—Ä–æ–≤–∫–∞",sober_driver:"–¢—Ä–µ–∑–≤—ã–π –≤–æ–¥–∏—Ç–µ–ª—å",road_conflict:"–î–æ—Ä–æ–∂–Ω—ã–π –∫–æ–Ω—Ñ–ª–∏–∫—Ç",other:"–ü–æ–º–æ—â—å"}[d]||"–ü–æ–º–æ—â—å";const u=n.title||n.problem_type_name||t[d]+" "+p,g=n.description||"–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞",f=n.amount||0,m=n.distance||"‚Äî",h=n.created_at||n.createdAt;let b="";if(h)try{const e=new Date(h);if(!isNaN(e.getTime())){const n=new Date-e,o=Math.floor(n/6e4),t=Math.floor(n/36e5);b=o<1?"–¢–æ–ª—å–∫–æ —á—Ç–æ":o<60?`${o} –º–∏–Ω. –Ω–∞–∑–∞–¥`:t<24?`${t} —á. –Ω–∞–∑–∞–¥`:e.toLocaleString("ru-RU",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})}}catch(w){console.warn("–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:",w)}const x=n.images||n.Images||[],v=Array.isArray(x)&&x.length>0;console.log(`‚úÖ –°–æ–∑–¥–∞—é –º–∞—Ä–∫–µ—Ä –¥–ª—è –∑–∞—è–≤–∫–∏ ${n.id} –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞—Ö [${l}, ${s}]`,{imagesCount:x.length,hasImages:v}),v&&x.map(e=>{const n=e.url||e.thumbnail_url||"",o=e.url||n,t=L(n);return`\n                <a href="${L(o)}" target="_blank" style="display: block; border-radius: 8px; overflow: hidden; aspect-ratio: 1; background: #f3f4f6;">\n                  <img \n                    src="${t}" \n                    alt="–§–æ—Ç–æ –∑–∞—è–≤–∫–∏"\n                    style="width: 100%; height: 100%; object-fit: cover; cursor: pointer;"\n                    onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\\'width:100%;height:100%;display:flex;align-items:center;justify-content:center;background:#f3f4f6;color:#9ca3af;font-size:12px;\\'>–ù–µ—Ç —Ñ–æ—Ç–æ</div>'"\n                  />\n                </a>\n              `}).join("");const y=e.marker([l,s],{icon:c,requestId:n.id}).bindPopup(`\n        <div style="font-family: system-ui; padding: 8px; min-width: 200px; max-width: min(85vw, 280px);">\n          <div style="font-size: 24px; margin-bottom: 6px; text-align: center;">${t[d]||"üîß"}</div>\n          <h3 style="font-weight: 800; font-size: 14px; color: #1f2937; margin-bottom: 3px; line-height: 1.2; text-align: center;">\n            ${u}\n          </h3>\n          ${b?`<div style="font-size: 10px; color: #6b7280; margin-bottom: 6px; text-align: center;">üïí ${b}</div>`:""}\n          <p style="font-size: 12px; color: #4b5563; margin-bottom: 8px; line-height: 1.4; background: #f9fafb; padding: 6px; border-radius: 6px; max-height: 60px; overflow: hidden;">\n            ${g}\n          </p>\n          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-bottom: 8px; padding: 6px; background: #f0fdf4; border-radius: 6px;">\n            <div style="text-align: center;">\n              <div style="font-size: 9px; color: #6b7280; font-weight: 600;">–ù–ê–ì–†–ê–î–ê</div>\n              <div style="font-weight: 900; font-size: 16px; color: #16a34a;">${f}‚ÇΩ</div>\n            </div>\n            <div style="text-align: center;">\n              <div style="font-size: 9px; color: #6b7280; font-weight: 600;">–†–ê–°–°–¢.</div>\n              <div style="font-weight: 900; font-size: 16px; color: #3b82f6;">${m}</div>\n            </div>\n          </div>\n          \n          <div style="display: grid; gap: 4px;">\n            ${k.isAuthenticated?`\n            <button \n              onclick="window.location.href='/responses/${n.id}'"\n              style="width: 100%; padding: 8px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 13px; cursor: pointer;"\n            >\n              üëã –û—Ç–∫–ª–∏–∫–Ω—É—Ç—å—Å—è\n            </button>\n            `:`\n            <a \n              href="/login?redirect=/responses/${n.id}"\n              style="width: 100%; padding: 8px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; border: none; border-radius: 8px; font-weight: bold; font-size: 13px; cursor: pointer; text-decoration: none; display: block; text-align: center;"\n            >\n              üîê –í–æ–π—Ç–∏\n            </a>\n            `}\n            \n            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px;">\n              <a \n                href="https://yandex.ru/maps/?text=${l},${s}"\n                target="_blank"\n                style="padding: 6px; background: #ffc700; color: #000; border-radius: 6px; font-weight: bold; font-size: 11px; text-decoration: none; text-align: center;"\n              >\n                üó∫Ô∏è –ö–∞—Ä—Ç–∞\n              </a>\n              <button \n                class="share-request-btn"\n                data-request-id="${n.id}"\n                style="padding: 6px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: bold; font-size: 11px; cursor: pointer;"\n              >\n                üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å\n              </button>\n            </div>\n          </div>\n        </div>\n      `,{maxWidth:280,className:"custom-popup animated-popup",autoPan:!0,autoPanPadding:[60,60],closeButton:!0,offset:[0,-10]}).on("click",()=>{$("request-clicked",n.id)});q.push(y),console.log(`‚úÖ –ú–∞—Ä–∫–µ—Ä ${a+1} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –º–∞—Å—Å–∏–≤ –¥–ª—è –∑–∞—è–≤–∫–∏ ${n.id}`)}),console.log(`üìä –í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ –º–∞—Ä–∫–µ—Ä–æ–≤: ${q.length}`),q.length>0){console.log(`üó∫Ô∏è –ù–∞—á–∏–Ω–∞—é –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ ${q.length} –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç—É...`),console.log("üó∫Ô∏è –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞—Ä—Ç—ã:",{loaded:N._loaded,container:!!N._container,panes:!!N._panes,markerPane:!!(null==(n=N._panes)?void 0:n.markerPane)});let e=0,o=0;q.forEach((n,t)=>{var a,r;try{n.addTo(N),e++,console.log(`‚úÖ –ú–∞—Ä–∫–µ—Ä ${t+1}/${q.length} –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ –∫–∞—Ä—Ç—É:`,{id:(null==(a=n.options)?void 0:a.id)||"unknown",latlng:n.getLatLng()})}catch(i){o++,console.error(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–∞—Ä–∫–µ—Ä–∞ ${t+1}:`,i),console.error("–î–µ—Ç–∞–ª–∏ –º–∞—Ä–∫–µ—Ä–∞:",{marker:n,latlng:n.getLatLng(),icon:null==(r=n.options)?void 0:r.icon})}}),console.log(`üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤: –¥–æ–±–∞–≤–ª–µ–Ω–æ ${e}, –æ—à–∏–±–æ–∫ ${o}`);const t=N._layers?Object.keys(N._layers).length:0;console.log(`üó∫Ô∏è –í—Å–µ–≥–æ —Å–ª–æ–µ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ: ${t}`),console.log(`‚úÖ –í—Å–µ ${e} –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞–ø—Ä—è–º—É—é –Ω–∞ –∫–∞—Ä—Ç—É (–±–µ–∑ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏)`),console.log("üó∫Ô∏è –ú–∞—Ä–∫–µ—Ä—ã –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –Ω–∞ –≤—Å–µ—Ö –º–∞—Å—à—Ç–∞–±–∞—Ö –∫–∞—Ä—Ç—ã")}else console.warn("‚ö†Ô∏è –ù–µ—Ç –º–∞—Ä–∫–µ—Ä–æ–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç—É");if(!document.getElementById("marker-pulse-animation")){const e=document.createElement("style");e.id="marker-pulse-animation",e.innerHTML="\n      @keyframes pulse-marker {\n        0%, 100% {\n          transform: scale(1);\n          box-shadow: 0 6px 12px rgba(239, 68, 68, 0.4);\n        }\n        50% {\n          transform: scale(1.05);\n          box-shadow: 0 8px 20px rgba(239, 68, 68, 0.6);\n        }\n      }\n      .marker-badge{\n        position: relative;\n        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);\n        color: #fff;\n        padding: 10px 14px;\n        border-radius: 24px;\n        font-size: 18px;\n        font-weight: 900;\n        text-align: center;\n        white-space: nowrap;\n        animation: pulse-marker 2s ease-in-out infinite, marker-fade-in .35s ease-out;\n        z-index: 1000 !important;\n        pointer-events: auto !important;\n      }\n      \n      .custom-marker {\n        z-index: 1000 !important;\n        pointer-events: auto !important;\n      }\n      \n      .leaflet-marker-icon {\n        z-index: 1000 !important;\n        pointer-events: auto !important;\n      }\n      @keyframes marker-fade-in { from { opacity: 0; } to { opacity: 1; } }\n      /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è Leaflet popup - —Ç–æ–ª—å–∫–æ opacity, –±–µ–∑ transform (–∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å Leaflet) */\n      .leaflet-popup.animated-popup {\n        animation: popup-fade-in .2s ease-out forwards;\n      }\n      .leaflet-popup.animated-popup .leaflet-popup-content-wrapper {\n        animation: popup-scale-in .2s ease-out forwards;\n      }\n      @keyframes popup-fade-in {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      @keyframes popup-scale-in {\n        from { transform: scale(0.95); opacity: 0; }\n        to { transform: scale(1); opacity: 1; }\n      }\n      /* –§–∏–∫—Å –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è popup */\n      .leaflet-popup {\n        position: absolute !important;\n      }\n      .leaflet-popup-content-wrapper {\n        border-radius: 16px;\n        box-shadow: 0 10px 40px rgba(0,0,0,0.15);\n      }\n      .leaflet-popup-tip {\n        display: none; /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–µ–ª–∫—É –¥–ª—è —á–∏—Å—Ç–æ–≥–æ –≤–∏–¥–∞ */\n      }\n    ",document.head.appendChild(e)}}async function B(){if(!navigator.geolocation)return O.value="‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è",R.value="bg-red-500",S.value="text-red-700",void console.warn("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è");if("denied"===await async function(){if(!navigator.permissions)return null;try{return(await navigator.permissions.query({name:"geolocation"})).state}catch(e){return console.warn("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π:",e),null}}())return O.value="‚ùå –î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â—ë–Ω",R.value="bg-red-500",S.value="text-red-700",void console.warn("–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â—ë–Ω");O.value="‚è≥ –û–ø—Ä–µ–¥–µ–ª—è—é –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...",R.value="bg-blue-500 animate-pulse",S.value="text-blue-700",navigator.geolocation.getCurrentPosition(n=>{const o=n.coords.latitude,t=n.coords.longitude;console.log("‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ:",o,t),console.log("üìç –¢–æ—á–Ω–æ—Å—Ç—å:",n.coords.accuracy,"–º–µ—Ç—Ä–æ–≤");const a=parseFloat(o),r=parseFloat(t);if("number"!=typeof a||"number"!=typeof r||isNaN(a)||isNaN(r)||a<-90||a>90||r<-180||r>180)return console.error("‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",{lat:o,lon:t,parsed:{userLat:a,userLon:r}}),O.value="‚ùå –ù–µ–≤–µ—Ä–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã",R.value="bg-red-500",void(S.value="text-red-700");if(O.value="‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ",R.value="bg-green-500",S.value="text-green-700",setTimeout(()=>{"‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ"===O.value&&(O.value=null)},3e3),N&&N._loaded&&N._container){if(j)try{N.removeLayer(j)}catch(i){console.warn("–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ä–æ–≥–æ –º–∞—Ä–∫–µ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:",i)}const n=e.divIcon({className:"user-location-marker",html:'\n            <div style="\n              width: 40px;\n              height: 40px;\n              background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n              border-radius: 50%;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              box-shadow: 0 4px 12px rgba(59, 130, 246, 0.5);\n              border: 4px solid white;\n              animation: pulse-user 2s ease-in-out infinite;\n            ">\n              <span style="font-size: 20px;">üìç</span>\n            </div>\n            <div style="\n              position: absolute;\n              top: 50%;\n              left: 50%;\n              transform: translate(-50%, -50%);\n              width: 60px;\n              height: 60px;\n              border: 2px solid #3b82f6;\n              border-radius: 50%;\n              opacity: 0.3;\n              animation: pulse-ring 2s ease-in-out infinite;\n            "></div>\n          ',iconSize:[40,40],iconAnchor:[20,40]});j=e.marker([a,r],{icon:n}).addTo(N).bindPopup("<b>üë§ –í—ã –∑–¥–µ—Å—å</b>"),N.setView([a,r],13),console.log("‚úÖ –ö–∞—Ä—Ç–∞ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –º–∞—Ä–∫–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω")}},e=>{const n={1:"‚ùå –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.",2:"‚ùå –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GPS –∏–ª–∏ Wi-Fi.",3:"‚è±Ô∏è –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."}[e.code]||`‚ùå –û—à–∏–±–∫–∞: ${e.message}`;O.value=n,R.value=3===e.code?"bg-yellow-500":"bg-red-500",S.value=3===e.code?"text-yellow-700":"text-red-700",console.error("‚ùå –û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:",{"–∫–æ–¥":e.code,"—Å–æ–æ–±—â–µ–Ω–∏–µ":e.message,"–ø–æ–ª–Ω–æ–µ–°–æ–æ–±—â–µ–Ω–∏–µ":n}),1===e.code&&console.log("üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞")},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})}async function F(n,o){if(!N)return;const t=parseFloat(null==n?void 0:n[0]),a=parseFloat(null==n?void 0:n[1]),r=parseFloat(null==o?void 0:o[0]),i=parseFloat(null==o?void 0:o[1]);if(isNaN(t)||isNaN(a)||isNaN(r)||isNaN(i)||t<-90||t>90||a<-180||a>180||r<-90||r>90||i<-180||i>180)console.error("‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–∞—Ä—à—Ä—É—Ç–∞:",{from:n,to:o,parsed:{fromLat:t,fromLon:a,toLat:r,toLon:i}});else try{console.log(`üó∫Ô∏è –°—Ç—Ä–æ—é –º–∞—Ä—à—Ä—É—Ç –æ—Ç [${t}, ${a}] –∫ [${r}, ${i}]`);const n=await fetch(`https://router.project-osrm.org/route/v1/driving/${a},${t};${i},${r}?overview=full&geometries=geojson`);if(!n.ok)throw new Error("–û—à–∏–±–∫–∞ OSRM API");const o=await n.json();if(o.routes&&o.routes.length>0){const n=o.routes[0],t=n.geometry.coordinates.map(e=>[e[1],e[0]]);P&&P.remove(),P=e.polyline(t,{color:"#22c55e",weight:5,opacity:.8,lineJoin:"round"}).addTo(N),N._container&&N._container._leaflet_id&&N._panes&&N._panes.mapPane&&N.fitBounds(P.getBounds(),{padding:[50,50]});const a=(n.distance/1e3).toFixed(1),l=Math.ceil(n.duration/60);return console.log(`‚úÖ –ú–∞—Ä—à—Ä—É—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω: ${a} –∫–º, ~${l} –º–∏–Ω`),M={distance:a,duration:l},"number"==typeof r&&"number"==typeof i&&!isNaN(r)&&!isNaN(i)&&r>=-90&&r<=90&&i>=-180&&i<=180&&e.popup().setLatLng([r,i]).setContent(`\n            <div style="font-family: system-ui; text-align: center;">\n              <div style="font-weight: bold; font-size: 16px; margin-bottom: 8px;">üöó –ú–∞—Ä—à—Ä—É—Ç</div>\n              <div style="color: #16a34a; font-weight: bold;">${a} –∫–º</div>\n              <div style="color: #6b7280;">~${l} –º–∏–Ω—É—Ç</div>\n            </div>\n          `).openOn(N),{distance:a,duration:l}}}catch(l){return console.error("‚ùå –û—à–∏–±–∫–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞:",l),null}}function E(e){if(!N)return void console.warn("‚ö†Ô∏è –ö–∞—Ä—Ç–∞ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞");console.log("üéØ focusOnRequest –≤—ã–∑–≤–∞–Ω —Å –∑–∞—è–≤–∫–æ–π:",{id:e.id,request:e,lat:e.lat,latitude:e.latitude,lon:e.lon,longitude:e.longitude});let n=e.lat||e.latitude,o=e.lon||e.longitude;const t="string"==typeof n?parseFloat(n):"number"==typeof n?n:NaN,a="string"==typeof o?parseFloat(o):"number"==typeof o?o:NaN;console.log(`üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∑–∞—è–≤–∫–∏: raw lat=${n}, raw lon=${o}, parsed lat=${t}, parsed lon=${a}`),"number"!=typeof t||"number"!=typeof a||isNaN(t)||isNaN(a)||t<-90||t>90||a<-180||a>180?console.error("‚ö†Ô∏è –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è focusOnRequest:",{request:e,latRaw:n,lonRaw:o,lat:t,lon:a}):(console.log(`üéØ –ü—Ä–∏–±–ª–∏–∂–∞–µ–º—Å—è –∫ –∑–∞–ø—Ä–æ—Å—É ${e.id||e.title||"unknown"}: [${t}, ${a}]`),N._container&&N._container._leaflet_id&&N._panes&&N._panes.mapPane?(console.log(`‚úÖ –í—ã–ø–æ–ª–Ω—è—é flyTo([${t}, ${a}], 17)`),N.flyTo([t,a],17,{animate:!0,duration:1.5,easeLinearity:.25})):console.warn("‚ö†Ô∏è –ö–∞—Ä—Ç–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –¥–ª—è flyTo"),setTimeout(()=>{var n,o;console.log("üîç –ü–æ–∏—Å–∫ –º–∞—Ä–∫–µ—Ä–∞ –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:",[t,a]),console.log("üìã –í—Å–µ–≥–æ –º–∞—Ä–∫–µ—Ä–æ–≤ –≤ –º–∞—Å—Å–∏–≤–µ:",q.length);let r=q.find(n=>{var o,t;return((null==(o=n.options)?void 0:o.requestId)||(null==(t=n.options)?void 0:t.id))===e.id});r||(r=q.find(e=>{const n=e.getLatLng();return Math.sqrt(Math.pow(n.lat-t,2)+Math.pow(n.lng-a,2))<.001})),r?(console.log("‚úÖ –ú–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω!",{position:r.getLatLng(),id:(null==(n=r.options)?void 0:n.requestId)||(null==(o=r.options)?void 0:o.id)}),r.openPopup(),console.log("‚úÖ Popup –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –º–∞—Ä–∫–µ—Ä–∞"),setTimeout(()=>{const e=r.getPopup();if(e&&e.isOpen()){const n=e.getLatLng(),o=r.getLatLng();console.log("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∑–∏—Ü–∏–∏ popup:",{popupCoords:n,markerCoords:o,match:n.lat===o.lat&&n.lng===o.lng})}},100)):(console.warn("‚ö†Ô∏è –ú–∞—Ä–∫–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:",[t,a]),console.log("üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã:",q.map(e=>{var n,o;const r=e.getLatLng();return{id:(null==(n=e.options)?void 0:n.requestId)||(null==(o=e.options)?void 0:o.id),coords:[r.lat,r.lng],distance:Math.sqrt(Math.pow(r.lat-t,2)+Math.pow(r.lng-a,2))}})))},1600))}function H(){if(P){try{P.remove()}catch(e){console.warn("Remove route:",e)}P=null}M=null}function W(){N&&N._container&&N._container._leaflet_id&&N._panes&&N._panes.mapPane&&N.zoomIn()}function D(){N&&N._container&&N._container._leaflet_id&&N._panes&&N._panes.mapPane&&N.zoomOut()}async function U(){if(k.showHelpers){console.log("üöó Starting to load available helpers...");try{let n=null,t=null;if(j){const e=j.getLatLng();n=e.lat,t=e.lng,console.log("üìç User location:",n,t)}else console.log("üìç No user marker, loading all helpers");const a={radius:500};n&&t&&(a.latitude=n,a.longitude=t),console.log("üì° Requesting helpers with params:",a);const r=await o.client.get("/users/available-helpers",{params:a});console.log("üì• API response:",r),r.success&&r.helpers?(console.log(`üöó Loaded ${r.helpers.length} available helpers`),function(n){if(!N)return;if(I.forEach(e=>{try{e.remove()}catch(n){console.warn("Error removing helper marker:",n)}}),I.length=0,!n||0===n.length)return void console.log("üìã No helpers to display on map");if(n.forEach(n=>{const o=parseFloat(n.last_location_lat),t=parseFloat(n.last_location_lon);if(isNaN(o)||isNaN(t)||o<-90||o>90||t<-180||t>180)return void console.warn("‚ö†Ô∏è Invalid coordinates for helper:",n.id);const a={sedan:{emoji:"üöó",color:"#3b82f6",gradient:"#2563eb"},suv:{emoji:"üöô",color:"#10b981",gradient:"#059669"},truck:{emoji:"üöö",color:"#f59e0b",gradient:"#d97706"},van:{emoji:"üöê",color:"#8b5cf6",gradient:"#7c3aed"},motorcycle:{emoji:"üèçÔ∏è",color:"#ef4444",gradient:"#dc2626"},other:{emoji:"üöå",color:"#6b7280",gradient:"#4b5563"}},r=n.car_type&&a[n.car_type]?a[n.car_type]:{emoji:"üöó",color:"#ec4899",gradient:"#db2777"},i=r.emoji,l=r.color,s={gold:{border:"3px solid #fbbf24",shadow:"0 0 20px rgba(251, 191, 36, 0.8)",badge:"ü•á",badgeBg:"linear-gradient(135deg, #fbbf24, #f59e0b)",animation:"gold-glow 1.5s ease-in-out infinite"},silver:{border:"3px solid #9ca3af",shadow:"0 0 15px rgba(156, 163, 175, 0.6)",badge:"ü•à",badgeBg:"linear-gradient(135deg, #9ca3af, #6b7280)",animation:"none"},bronze:{border:"3px solid #f97316",shadow:"0 0 15px rgba(249, 115, 22, 0.6)",badge:"ü•â",badgeBg:"linear-gradient(135deg, #f97316, #ea580c)",animation:"none"}},d=n.premium_status?s[n.premium_status]:null,c=[];n.has_jumper_cables&&c.push("‚ö°"),n.has_tow_rope&&c.push("üßµ"),n.has_fuel_canister&&c.push("‚õΩ"),n.has_compressor&&c.push("üí®"),n.can_change_tire&&c.push("üõû"),n.has_tools&&c.push("üß∞"),n.is_mechanic&&c.push("üë®‚Äçüîß");const p=c.length>0?c.join(""):"üöó";console.log("Helper skills:",p);const u=d?`border: ${d.border}; box-shadow: ${d.shadow}; animation: ${d.animation};`:"",g=d?`<div style="position: absolute; top: -5px; right: -5px; font-size: 20px;">${d.badge}</div>`:"",f=e.divIcon({className:"helper-car-marker",html:`\n        <div style="\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n          filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));\n          position: relative;\n        ">\n          ${g}\n          <div style="\n            font-size: 48px;\n            line-height: 1;\n            animation: helper-bounce 2s ease-in-out infinite;\n            ${d?"background: rgba(255,255,255,0.9); border-radius: 50%; padding: 5px;"+u:""}\n          ">${i}</div>\n          <div style="\n            background: ${d?d.badgeBg:`linear-gradient(135deg, ${l}, ${r.gradient})`};\n            color: white;\n            padding: 4px 10px;\n            border-radius: 12px;\n            font-size: 12px;\n            font-weight: bold;\n            margin-top: -8px;\n            border: 2px solid white;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.2);\n          ">\n            ${n.rating?"‚≠ê"+parseFloat(n.rating).toFixed(1):"–ì–æ—Ç–æ–≤"}\n          </div>\n        </div>\n      `,iconSize:[60,70],iconAnchor:[30,70],popupAnchor:[0,-70]}),m=d?`<span style="display: inline-flex; align-items: center; gap: 4px; background: ${d.badgeBg}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">${d.badge} ${"gold"===n.premium_status?"–ó–æ–ª–æ—Ç–æ–π":"silver"===n.premium_status?"–°–µ—Ä–µ–±—Ä—è–Ω—ã–π":"–ë—Ä–æ–Ω–∑–æ–≤—ã–π"}</span>`:"",h=n.car_brand?`<div style="font-size: 13px; color: #6b7280; margin-bottom: 8px;">üöó ${n.car_brand} ${n.car_model||""} ${n.car_color?"("+n.car_color+")":""}</div>`:"",b=void 0!==n.distance_km?`<div style="font-size: 14px; color: #3b82f6; font-weight: bold; margin-bottom: 8px;">üìç ${n.distance_km} –∫–º –æ—Ç –≤–∞—Å</div>`:"",x=e.marker([o,t],{icon:f,helperId:n.id}).bindPopup(`\n        <div style="font-family: system-ui; padding: 14px; min-width: 280px;">\n          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">\n            ${n.avatar_url?`<img src="${L(n.avatar_url)}" alt="" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">`:`<div style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, ${l}, #8b5cf6); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px;">${(n.full_name||"?")[0]}</div>`}\n            <div>\n              <h3 style="font-weight: 900; font-size: 18px; color: #1f2937; margin: 0;">\n                ${n.full_name||"–ü–æ–º–æ—â–Ω–∏–∫"} ${m}\n              </h3>\n              ${n.rating?`<div style="color: #f59e0b;">‚≠ê ${parseFloat(n.rating).toFixed(1)}</div>`:""}\n            </div>\n          </div>\n          ${b}\n          ${h}\n          <div style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px;">\n            ${c.map(e=>`<span style="background: #f3f4f6; padding: 4px 8px; border-radius: 8px; font-size: 16px;">${e}</span>`).join("")}\n          </div>\n          <div style="text-align: center; color: #16a34a; font-weight: 600; margin-bottom: 12px;">\n            üü¢ –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤ —Ä–∞–¥–∏—É—Å–µ ${n.help_radius_km||10} –∫–º\n          </div>\n          <div style="display: grid; gap: 8px;">\n            <a \n              href="/user/${n.id}"\n              style="\n                display: block;\n                padding: 12px 16px;\n                background: linear-gradient(135deg, #3b82f6, #8b5cf6);\n                color: white;\n                border-radius: 12px;\n                font-weight: bold;\n                text-align: center;\n                text-decoration: none;\n              "\n            >\n              üë§ –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å\n            </a>\n            ${k.isAuthenticated?'\n            <a \n              href="/messages"\n              style="\n                display: block;\n                padding: 12px 16px;\n                background: linear-gradient(135deg, #10b981, #059669);\n                color: white;\n                border-radius: 12px;\n                font-weight: bold;\n                text-align: center;\n                text-decoration: none;\n              "\n            >\n              üí¨ –ù–∞–ø–∏—Å–∞—Ç—å\n            </a>\n            ':`\n            <a \n              href="/login?redirect=/user/${n.id}"\n              style="\n                display: block;\n                padding: 12px 16px;\n                background: #f3f4f6;\n                color: #374151;\n                border-radius: 12px;\n                font-weight: bold;\n                text-align: center;\n                text-decoration: none;\n              "\n            >\n              üîê –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –Ω–∞–ø–∏—Å–∞—Ç—å\n            </a>\n            `}\n          </div>\n        </div>\n      `,{maxWidth:350,className:"helper-popup animated-popup"}).on("click",()=>{$("helper-clicked",n.id)});x.addTo(N),I.push(x)}),console.log(`‚úÖ Added ${I.length} helper markers to map`),!document.getElementById("helper-pulse-animation")){const e=document.createElement("style");e.id="helper-pulse-animation",e.innerHTML="\n      @keyframes helper-pulse {\n        0%, 100% {\n          transform: scale(1);\n          box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n        }\n        50% {\n          transform: scale(1.05);\n          box-shadow: 0 6px 16px rgba(59, 130, 246, 0.5);\n        }\n      }\n      @keyframes helper-bounce {\n        0%, 100% {\n          transform: translateY(0);\n        }\n        50% {\n          transform: translateY(-6px);\n        }\n      }\n      @keyframes gold-glow {\n        0%, 100% {\n          box-shadow: 0 0 10px rgba(251, 191, 36, 0.6);\n        }\n        50% {\n          box-shadow: 0 0 25px rgba(251, 191, 36, 1);\n        }\n      }\n      .helper-car-marker {\n        z-index: 900 !important;\n        pointer-events: auto !important;\n      }\n    ",document.head.appendChild(e)}}(r.helpers)):console.warn("‚ö†Ô∏è API returned no helpers or success=false")}catch(n){console.error("‚ùå Error loading helpers:",n)}}else console.log("üöß showHelpers is false, skipping helper load")}function J(){navigator.geolocation&&(T=setInterval(()=>{navigator.geolocation.getCurrentPosition(async e=>{const{latitude:n,longitude:a}=e.coords;try{await o.client.put("/users/update-location",{latitude:n,longitude:a}),console.log("üìç Own location updated:",n,a),j&&j.setLatLng([n,a]),t.updateLocation(n,a)}catch(r){console.error("‚ùå Failed to update location:",r)}},e=>{console.warn("‚ö†Ô∏è Location tracking error:",e)},{enableHighAccuracy:!0,timeout:5e3})},1e4))}return r(()=>{var n;!function(){console.log("‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è OpenStreetMap...");let n=[55.755819,37.617644],o=12;try{const e=localStorage.getItem("osm_state");if(e){const t=JSON.parse(e);Array.isArray(t.center)&&"number"==typeof t.zoom&&(n=t.center,o=t.zoom)}}catch(r){}if(!document.getElementById("osm-map"))return void console.error("‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã #osm-map –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM");N=e.map("osm-map",{center:n,zoom:o,zoomControl:!1}),e.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"¬© OpenStreetMap contributors",maxZoom:19}).addTo(N);const a=()=>{const e=N.getCenter(),n={center:[e.lat,e.lng],zoom:N.getZoom()};localStorage.setItem("osm_state",JSON.stringify(n))};N.on("moveend",a),N.on("zoomend",a),N.whenReady(()=>{if(!N._panes||!N._panes.markerPane)return console.warn("‚ö†Ô∏è –ü–∞–Ω–µ–ª–∏ –∫–∞—Ä—Ç—ã –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤—ã, –∂–¥–µ–º..."),void setTimeout(()=>{N&&N._panes&&N._panes.markerPane&&(C(),B(),console.log("‚úÖ OpenStreetMap –≥–æ—Ç–æ–≤–∞!"),$("ready"))},100);C(),B(),k.showHelpers&&setTimeout(()=>{U(),t.on("helper:location_update",n=>{console.log("üìç Helper location update:",n);const o=I.find(e=>{var o;return(null==(o=e.options)?void 0:o.helperId)===n.helperId});if(o){const t=e.latLng(n.latitude,n.longitude);o.setLatLng(t),console.log(`‚úÖ Updated position for helper ${n.helperId}`)}}),A=setInterval(()=>{U()},3e4)},1e3),console.log("‚úÖ OpenStreetMap –≥–æ—Ç–æ–≤–∞!"),$("ready")})}(),(null==(n=z.user)?void 0:n.is_available_to_help)&&(console.log("üöó –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ç—Ä–µ–∫–∏–Ω–≥–∞ –ª–æ–∫–∞—Ü–∏–∏ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å"),J()),document.addEventListener("click",e=>{const n=e.target.closest(".share-request-btn");if(n){e.stopPropagation(),e.preventDefault();const o=n.dataset.requestId;o&&(console.log("üì§ Share button clicked:",o),console.log("üîç Checking window.__handleShareRequest:",typeof window.__handleShareRequest),$("share-request",o),"function"==typeof window.__handleShareRequest?(console.log("‚úÖ Calling window.__handleShareRequest"),window.__handleShareRequest(o)):(console.log("‚ö†Ô∏è Function not found, using event fallback"),window.dispatchEvent(new CustomEvent("roadhelp-share-request",{detail:{requestId:o}}))))}})}),i(()=>{A&&(clearInterval(A),A=null),T&&(clearInterval(T),T=null),N&&N.remove()}),l(()=>k.requests,(e,n)=>{const o=(null==e?void 0:e.length)||0,t=(null==n?void 0:n.length)||0;if(console.log(`üëÄ Watch: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ requests - –±—ã–ª–æ ${t}, —Å—Ç–∞–ª–æ ${o}`,{mapReady:!!N,requests:e}),o>0&&(o!==t||void 0===n||0===t)){if(console.log(`üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ: –±—ã–ª–æ ${t}, —Å—Ç–∞–ª–æ ${o}`),console.log("üìã –ó–∞—è–≤–∫–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:",e),!N){console.log("‚ö†Ô∏è –ö–∞—Ä—Ç–∞ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–∞, –∂–¥–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...");const e=setInterval(()=>{N&&N._panes&&N._panes.markerPane&&(clearInterval(e),console.log("‚úÖ –ö–∞—Ä—Ç–∞ –≥–æ—Ç–æ–≤–∞, –¥–æ–±–∞–≤–ª—è—é –º–∞—Ä–∫–µ—Ä—ã"),C())},100);return void setTimeout(()=>clearInterval(e),5e3)}setTimeout(()=>{C()},50)}},{deep:!0,immediate:!0}),l(()=>{var e;return null==(e=z.user)?void 0:e.is_available_to_help},(e,n)=>{console.log("üëÄ Watch: is_available_to_help –∏–∑–º–µ–Ω–∏–ª—Å—è:",n,"->",e),e&&!n?(console.log('üöó –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∫–ª—é—á–∏–ª "–≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å" - –∑–∞–ø—É—Å–∫ —Ç—Ä–µ–∫–∏–Ω–≥–∞ –ª–æ–∫–∞—Ü–∏–∏'),J()):!e&&n&&(console.log('üõë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∫–ª—é—á–∏–ª "–≥–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å" - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç—Ä–µ–∫–∏–Ω–≥–∞'),T&&(clearInterval(T),T=null))}),w({zoomIn:W,zoomOut:D,buildRoute:F,getUserLocation:B,navigateToRequest:async function(e,n){if(navigator.geolocation)try{const o=await new Promise((e,n)=>{navigator.geolocation.getCurrentPosition(e,n,{enableHighAccuracy:!0,timeout:1e4})}),t=[o.coords.latitude,o.coords.longitude],a=[e,n];await F(t,a),function(e,n){const o=document.createElement("div");o.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: white;\n    border-radius: 20px;\n    padding: 24px;\n    box-shadow: 0 20px 60px rgba(0,0,0,0.3);\n    z-index: 9900;\n    min-width: 350px;\n  ",o.innerHTML=`\n    <div style="text-align: center;">\n      <div style="font-size: 40px; margin-bottom: 12px;">üó∫Ô∏è</div>\n      <h3 style="font-size: 22px; font-weight: 900; margin-bottom: 16px;">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä</h3>\n      <div style="display: grid; gap: 10px;">\n        <a \n          href="https://yandex.ru/maps/?rtext=${e[0]},${e[1]}~${n[0]},${n[1]}&rtt=auto"\n          target="_blank"\n          style="padding: 14px; background: linear-gradient(135deg, #ffdb4d, #ffc700); color: #000; border-radius: 12px; font-weight: bold; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px;"\n        >\n          üü° –Ø–Ω–¥–µ–∫—Å.–ù–∞–≤–∏–≥–∞—Ç–æ—Ä\n        </a>\n        <a \n          href="https://www.google.com/maps/dir/?api=1&origin=${e[0]},${e[1]}&destination=${n[0]},${n[1]}&travelmode=driving"\n          target="_blank"\n          style="padding: 14px; background: linear-gradient(135deg, #4285f4, #1a73e8); color: white; border-radius: 12px; font-weight: bold; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 8px;"\n        >\n          üó∫Ô∏è Google Maps\n        </a>\n        <button onclick="this.closest('[style*=fixed]').remove()" style="padding: 10px; background: #f3f4f6; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; color: #6b7280;">\n          –ó–∞–∫—Ä—ã—Ç—å\n        </button>\n      </div>\n    </div>\n  `;const t=document.createElement("div");t.style.cssText="position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9899;",t.onclick=()=>{t.remove(),o.remove()},document.body.appendChild(t),document.body.appendChild(o)}(t,a)}catch(o){alert("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ. –†–∞–∑—Ä–µ—à–∏—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é!")}else alert("‚ùå –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è")},focusOnRequest:E,focusOnMarker:function(e){console.log("üéØ focusOnMarker –≤—ã–∑–≤–∞–Ω –¥–ª—è –∑–∞—è–≤–∫–∏:",e);const n=k.requests.find(n=>n.id===e);n?E(n):console.warn("‚ö†Ô∏è –ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:",e)},focusOnRoute:function(){N&&P&&N._container&&N._container._leaflet_id&&N._panes&&N._panes.mapPane&&N.fitBounds(P.getBounds(),{padding:[50,50],animate:!0,duration:1})},focusOnBothPoints:function(n,o){if(!(N&&N._container&&N._container._leaflet_id&&N._panes&&N._panes.mapPane))return;const t=e.latLngBounds([[n.lat,n.lon],[o.lat,o.lon]]);N.fitBounds(t,{padding:[100,100],animate:!0,duration:1.5})},resetRoute:H,loadAvailableHelpers:U,startOwnLocationTracking:J}),(e,n)=>(d(),s("div",f,[n[5]||(n[5]=c("div",{id:"osm-map",class:"w-full h-full"},null,-1)),c("div",{class:"absolute top-4 right-4 space-y-3 flex flex-col pointer-events-none",style:{"z-index":"9900 !important"}},[c("button",{class:"w-12 h-12 bg-white/90 backdrop-blur-sm rounded-xl shadow-lg hover:bg-white transition-all flex items-center justify-center pointer-events-auto","aria-label":"–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ",title:"–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ",onClick:B},[...n[0]||(n[0]=[c("svg",{class:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),c("button",{class:"w-12 h-12 bg-white/90 backdrop-blur-sm rounded-xl shadow-lg hover:bg-white transition-all flex items-center justify-center pointer-events-auto","aria-label":"–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å",title:"–ü—Ä–∏–±–ª–∏–∑–∏—Ç—å",onClick:W},[...n[1]||(n[1]=[c("svg",{class:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])]),c("button",{class:"w-12 h-12 bg-white/90 backdrop-blur-sm rounded-xl shadow-lg hover:bg-white transition-all flex items-center justify-center pointer-events-auto","aria-label":"–û—Ç–¥–∞–ª–∏—Ç—å",title:"–û—Ç–¥–∞–ª–∏—Ç—å",onClick:D},[...n[2]||(n[2]=[c("svg",{class:"w-6 h-6 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[c("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 12H4"})],-1)])])]),n[6]||(n[6]=c("div",{class:"absolute bottom-4 left-4 px-4 py-2 bg-white/90 backdrop-blur-sm rounded-xl shadow-lg flex items-center space-x-2 pointer-events-none",style:{"z-index":"500"}},[c("div",{class:"w-3 h-3 bg-green-500 rounded-full animate-pulse"}),c("span",{class:"text-sm font-bold text-gray-900"},"OpenStreetMap")],-1)),u(M)?(d(),s("div",m,[c("div",h,[n[3]||(n[3]=c("div",{class:"text-xs text-gray-500 font-semibold"}," –†–ê–°–°–¢–û–Ø–ù–ò–ï ",-1)),c("div",b,g(u(M).distance)+" –∫–º ",1)]),c("div",x,[n[4]||(n[4]=c("div",{class:"text-xs text-gray-500 font-semibold"}," –í –ü–£–¢–ò ",-1)),c("div",v," ~"+g(u(M).duration)+" –º–∏–Ω ",1)]),c("button",{class:"px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-xl font-bold text-gray-700 transition focus:outline-none focus:ring-4 focus:ring-gray-300 pointer-events-auto","aria-label":"–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç",title:"–°–±—Ä–æ—Å–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç",onClick:H}," –°–±—Ä–æ—Å–∏—Ç—å ")])):p("",!0)]))}};export{y as _};
