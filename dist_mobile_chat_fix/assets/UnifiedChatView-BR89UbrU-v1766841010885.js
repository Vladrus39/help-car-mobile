import{r as e,w as t,h as a,m as l,k as r,l as s,v as n,t as i,F as o,i as u,n as d,I as c,J as v,p as g,c as p,s as y,o as h,a as f,H as b,y as x,e as m,g as k,G as w,K as _,x as C,f as j}from"./vendor-mW7CftnD-v1766841010885.js";import{a as I,s as M,_ as S,u as z,l as A}from"./index-BxK8qiyz-v1766841010885.js";import{P as R}from"./PremiumBadge-B2nApjML-v1766841010885.js";import{L as q}from"./LinkPreview-CmE2Ci3Z-v1766841010885.js";import"./utils-B45sLh6N-v1766841010885.js";import"./maps-CCq-KL9W-v1766841010885.js";const $={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-6 transform transition-all"},D={class:"text-center mb-6"},B={class:"text-sm text-gray-600 dark:text-gray-300"},T={class:"font-semibold"},L={class:"flex justify-center gap-2 mb-6"},U=["onClick","onMouseenter"],F={class:"mb-6"},H={class:"mb-6"},V={class:"flex flex-wrap gap-2"},O=["onClick"],E={class:"flex gap-3"},P=["disabled"],W={key:0,class:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},G={__name:"RatingModal",props:{isOpen:{type:Boolean,default:!1},helpRequestId:{type:String,required:!0},helperId:{type:String,required:!0},helperName:{type:String,default:"–ü–æ–º–æ—â–Ω–∏–∫"}},emits:["close","rated"],setup(p,{emit:y}){const h=p,f=y,b=e(0),x=e(0),m=e(""),k=e([]),w=e(!1),_=["üëç –ë—ã—Å—Ç—Ä–æ","üí¨ –í–µ–∂–ª–∏–≤–æ","üîß –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ","üí∞ –î–æ—Å—Ç—É–ø–Ω–æ","‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É—é"];t(()=>h.isOpen,e=>{e&&(b.value=0,x.value=0,m.value="",k.value=[])});const C=async()=>{var e,t,a,l;if(0!==b.value){w.value=!0;try{const a=await I.createRating(h.helpRequestId,{rating:b.value,comment:k.value.length>0?m.value?`${m.value} | ${k.value.join(", ")}`:k.value.join(", "):m.value||null});if(!(null==(e=a.data)?void 0:e.success))throw new Error((null==(t=a.data)?void 0:t.message)||"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ü–µ–Ω–∫–∏");M.playSuccess(),f("rated",{rating:b.value,comment:m.value,tags:k.value}),j()}catch(r){console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:",r),alert((null==(l=null==(a=r.response)?void 0:a.data)?void 0:l.message)||r.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")}finally{w.value=!1}}else alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É")},j=()=>{f("close")};return(e,t)=>p.isOpen?(r(),a("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:g(j,["self"])},[s("div",$,[s("div",D,[t[4]||(t[4]=s("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[s("svg",{class:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})])],-1)),t[5]||(t[5]=s("h2",{class:"text-2xl font-black text-gray-900 dark:text-white mb-2"}," –û—Ü–µ–Ω–∏—Ç–µ –ø–æ–º–æ—â—å ",-1)),s("p",B,[t[2]||(t[2]=n(" –ö–∞–∫ –≤–∞–º –ø–æ–º–æ–≥ ",-1)),s("span",T,i(p.helperName),1),t[3]||(t[3]=n("? ",-1))])]),s("div",L,[(r(),a(o,null,u(5,e=>s("button",{key:e,class:"transform transition-all hover:scale-125 focus:outline-none",onClick:t=>b.value=e,onMouseenter:t=>x.value=e,onMouseleave:t[0]||(t[0]=e=>x.value=0)},[(r(),a("svg",{class:d(["w-12 h-12",e<=(x.value||b.value)?"text-yellow-400":"text-gray-300 dark:text-gray-600"]),fill:"currentColor",viewBox:"0 0 20 20"},[...t[6]||(t[6]=[s("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)])],2))],40,U)),64))]),s("div",F,[t[7]||(t[7]=s("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) ",-1)),c(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),rows:"4",placeholder:"–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏ –æ –ø–æ–º–æ—â–∏...",class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none"},null,512),[[v,m.value]])]),s("div",H,[t[8]||(t[8]=s("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"}," –û—Ç–º–µ—Ç–∫–∏ ",-1)),s("div",V,[(r(),a(o,null,u(_,e=>s("button",{key:e,class:d(["px-3 py-1.5 text-sm rounded-full border transition",k.value.includes(e)?"bg-yellow-100 border-yellow-400 text-yellow-700":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"]),onClick:t=>(e=>{const t=k.value.indexOf(e);-1===t?k.value.push(e):k.value.splice(t,1)})(e)},i(e),11,O)),64))])]),s("div",E,[s("button",{class:"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-xl transition",onClick:j}," –û—Ç–º–µ–Ω–∞ "),s("button",{disabled:0===b.value||w.value,class:"flex-1 px-4 py-3 bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-white font-bold rounded-xl transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",onClick:C},[w.value?(r(),a("svg",W,[...t[9]||(t[9]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):l("",!0),s("span",null,i(w.value?"–û—Ç–ø—Ä–∞–≤–∫–∞...":"–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É"),1)],8,P)])])])):l("",!0)}},N={class:"h-screen flex flex-col overflow-hidden chat-container"},K={class:"bg-white/95 dark:bg-gray-800/95 backdrop-blur-lg border-b dark:border-gray-700 px-4 py-3 flex-shrink-0 shadow-lg relative z-20"},J={class:"flex items-center justify-between"},Q={class:"flex items-center gap-3"},X={class:"relative"},Y={key:0,class:"w-10 h-10 rounded-full overflow-hidden ring-2 ring-transparent group-hover:ring-blue-400 transition"},Z=["src"],ee={key:1,class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold ring-2 ring-transparent group-hover:ring-blue-400 transition"},te={key:2,class:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full animate-pulse"},ae={key:3,class:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-yellow-500 border-2 border-white dark:border-gray-800 rounded-full"},le={class:"flex items-center gap-2"},re={class:"font-semibold text-gray-900 dark:text-white text-sm group-hover:text-blue-600 dark:group-hover:text-blue-400 transition"},se={key:0,class:"text-xs text-blue-500 animate-pulse"},ne={key:1,class:"text-xs text-green-500 flex items-center gap-1"},ie={key:2,class:"text-xs text-gray-500"},oe={class:"flex items-center gap-1"},ue=["disabled"],de={key:1,class:"px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs rounded-full"},ce={key:2,class:"px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs rounded-full"},ve={key:0,class:"absolute right-4 top-16 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border dark:border-gray-700 py-2 z-50 min-w-[180px]"},ge={key:0,class:"bg-gradient-to-r from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 border-b dark:border-gray-700 px-4 py-2 flex-shrink-0 relative z-20"},pe={class:"flex items-center justify-between gap-3"},ye={class:"flex-1 min-w-0"},he={class:"flex items-center gap-2 text-sm"},fe={class:"font-semibold text-orange-700 dark:text-orange-400"},be={key:0,class:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5"},xe={class:"flex items-center gap-2 flex-shrink-0"},me=["disabled"],ke={key:0,class:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"},we={key:1},_e={key:0,class:"text-center py-2"},Ce={key:0,class:"flex items-center justify-center my-4"},je={class:"px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 text-xs rounded-full"},Ie={key:0,class:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold mr-2 flex-shrink-0 self-end"},Me={key:1,class:"w-8 mr-2"},Se={class:"max-w-[80%] sm:max-w-[70%]"},ze={key:0,class:"mb-2"},Ae=["src","alt","onClick"],Re={key:1,class:"mb-2"},qe=["onClick"],$e={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},De={key:1,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},Be={class:"flex-1"},Te={class:"flex items-center gap-2"},Le=["id"],Ue=["src","onEnded","onTimeupdate"],Fe={key:2,class:"text-sm sm:text-base whitespace-pre-wrap"},He=["onClick"],Ve=["onClick"],Oe={key:3,class:"flex gap-1 mt-1"},Ee={class:"text-gray-400"},Pe={key:0,class:"flex justify-start"},We={class:"bg-white/95 dark:bg-gray-800/95 backdrop-blur-lg border-t dark:border-gray-700 p-3 flex-shrink-0 relative z-20"},Ge={key:0,class:"mb-3 relative inline-block"},Ne=["src"],Ke={key:0,class:"absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center"},Je={key:1,class:"mb-3 flex items-center gap-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg"},Qe={class:"text-red-600 dark:text-red-400 font-medium"},Xe={key:2,class:"flex items-end gap-2"},Ye=["disabled"],Ze={class:"flex-1 relative"},et=["onKeydown"],tt={class:"relative"},at={key:0,class:"absolute bottom-12 right-0 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 p-3 z-50 w-72"},lt={class:"grid grid-cols-8 gap-1 max-h-48 overflow-y-auto"},rt=["onClick"],st=["disabled"],nt={key:1,class:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-20"},it={class:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"},ot={class:"p-4 border-b dark:border-gray-700 flex items-center gap-3"},ut={class:"max-h-96 overflow-y-auto p-4"},dt={key:0,class:"text-center text-gray-500"},ct={key:1,class:"text-center text-gray-500"},vt={class:"text-sm text-gray-900 dark:text-white"},gt={class:"text-xs text-gray-500"},pt={key:2,class:"fixed inset-0 bg-black/90 z-50 p-4"},yt={class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2"},ht=["src","onClick"],ft=["src"],bt=S({__name:"UnifiedChatView",props:{chatType:{type:String,default:"auto"}},setup(M){const S=M,$=y(),D=x(),B=z(),T=e([]),L=e(""),U=e(!0),F=e(!1),H=e(!1),V=e(null),O=e(null),E=e(null),P=e(null),W=e(!1),bt=e(!1),xt=e(!1),mt=e(!1),kt=e(!1),wt=e(null),_t=e(!1),Ct=e(!1),jt=e(null),It=e(null),Mt=e(null),St=e(!1),zt=e(null),At=e(!1),Rt=e(!1),qt=e(0),$t=e(null),Dt=e([]);let Bt=null;const Tt=e(null),Lt={},Ut=e(!1),Ft=e(""),Ht=e([]),Vt=e(!1),Ot=e(!1),Et=e([]),Pt=["üòÄ","üòÉ","üòÑ","üòÅ","üòÜ","üòÖ","ü§£","üòÇ","üôÇ","üòâ","üòä","üòá","ü•∞","üòç","ü§©","üòò","üòó","üòö","üòô","ü•≤","ü§ó","ü§î","ü§≠","ü§´","üëç","üëé","üëå","‚úåÔ∏è","ü§û","ü§ô","üëä","‚ù§Ô∏è","üß°","üíõ","üíö","üíô","üíú","üñ§","üî•","‚≠ê","üéâ","üöó","üöï","üöô","üöå","üõ†Ô∏è","üîß","‚õΩ","üì±","üíª","üè†","üìç","‚úÖ","‚ùå"];let Wt=null,Gt=null;const Nt=p(()=>"auto"!==S.chatType?"request"===S.chatType:!!$.params.requestId),Kt=p(()=>{var e;if(!wt.value)return!1;const t=wt.value,a=String(t.user_id)===String(null==(e=B.user)?void 0:e.id),l=["accepted","in_progress"].includes(t.status);return a&&l}),Jt=p(()=>!!wt.value&&("completed"===wt.value.status&&!wt.value.userHasRated)),Qt=p(()=>{if(!wt.value)return"";return{flat_tire:"üõû –ü—Ä–æ–±–∏–ª–æ –∫–æ–ª–µ—Å–æ",battery:"üîã –°–µ–ª –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä",fuel:"‚õΩ –ó–∞–∫–æ–Ω—á–∏–ª–æ—Å—å —Ç–æ–ø–ª–∏–≤–æ",tow:"üöõ –ù—É–∂–Ω–∞ —ç–≤–∞–∫—É–∞—Ü–∏—è",engine:"üîß –ù–µ –∑–∞–≤–æ–¥–∏—Ç—Å—è",keys:"üîë –ó–∞–∫—Ä—ã–ª—Å—è –≤ –º–∞—à–∏–Ω–µ",other:"‚ùì –î—Ä—É–≥–æ–µ"}[wt.value.problem_type]||wt.value.problem_type_name||"üÜò –ó–∞—è–≤–∫–∞"});function Xt(){D.back()}async function Yt(){var e,t;try{const t=await I.client.get(`/chats/${V.value}/direct`);t.success&&(P.value=t.otherUser,T.value=(t.messages||[]).map(e=>{var t;return{...e,is_mine:String(e.sender_id||"")===String((null==(t=B.user)?void 0:t.id)||""),createdAt:e.createdAt||e.created_at}}),await b(),pa(!0),(null==(e=P.value)?void 0:e.id)&&await ta(P.value.id))}catch(a){console.error("Failed to load direct chat:",a),404===(null==(t=a.response)?void 0:t.status)&&D.push("/my-chats")}finally{U.value=!1}}async function Zt(e){var t;try{const a=await I.getChatByRequest(e),l=(null==a?void 0:a.data)||a;if(null==l?void 0:l.id){if(V.value=l.id,l.messages&&Array.isArray(l.messages)&&(T.value=l.messages.map(e=>{var t;return{...e,is_mine:String(e.sender_id||"")===String((null==(t=B.user)?void 0:t.id)||""),createdAt:e.createdAt||e.created_at}})),l.helpRequest&&(wt.value=l.helpRequest),l.participants){const e=l.participants.find(e=>{var t;return e.id!==(null==(t=B.user)?void 0:t.id)});e&&(P.value=e,await ta(e.id))}else if(l.helpRequest){const e=l.helpRequest;e.user_id===(null==(t=B.user)?void 0:t.id)&&e.helper?(P.value=e.helper,await ta(e.helper.id)):e.user&&(P.value=e.user,await ta(e.user.id))}await b(),pa(!0)}}catch(a){console.error("Failed to load chat by request:",a)}}async function ea(){if(V.value)try{U.value=!0;const t=await I.getChatMessages(V.value,{limit:100,offset:0});let a=[];if(Array.isArray(null==t?void 0:t.data)?a=t.data:Array.isArray(null==t?void 0:t.messages)?a=t.messages:Array.isArray(t)&&(a=t),T.value=a.map(e=>{var t;return{...e,is_mine:String(e.sender_id||"")===String((null==(t=B.user)?void 0:t.id)||""),createdAt:e.createdAt||e.created_at}}),!P.value&&(null==t?void 0:t.chat)){const e=t.chat;if(e.participants){const t=e.participants.find(e=>{var t;return e.id!==(null==(t=B.user)?void 0:t.id)});t&&(P.value=t,await ta(t.id))}}await b(),pa(!0);try{await I.markMessagesAsRead(V.value)}catch(e){console.warn("Failed to mark messages as read:",e)}}catch(t){console.error("Failed to load messages:",t)}finally{U.value=!1}}async function ta(e){try{const t=await I.getFriends(),a=((null==t?void 0:t.data)||t||[]).some(t=>{var a;return(null==(a=t.friend)?void 0:a.id)===e});P.value&&(P.value.isFriend=a)}catch(t){console.error("Failed to check friendship:",t)}}async function aa(){var e,t,a,l;if(null==(e=P.value)?void 0:e.id)try{W.value=!0;const e=await I.sendFriendRequest(P.value.id);e.success&&(bt.value=!0,(null==(t=e.message)?void 0:t.includes("—Ç–µ–ø–µ—Ä—å –¥—Ä—É–∑—å—è"))&&(P.value.isFriend=!0,bt.value=!1))}catch(r){alert((null==(l=null==(a=r.response)?void 0:a.data)?void 0:l.message)||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É")}finally{W.value=!1}}function la(e="audio"){var t;const a=null==(t=P.value)?void 0:t.id;a?"function"==typeof window.__initiateCall?window.__initiateCall(a,e):alert("–§—É–Ω–∫—Ü–∏—è –∑–≤–æ–Ω–∫–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"):alert("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫")}async function ra(){var e,t,a;if((null==(e=wt.value)?void 0:e.id)&&confirm("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–º–æ—â–∏?"))try{Ct.value=!0,await I.completeHelpRequest(wt.value.id),wt.value.status="completed",alert("–ó–∞—è–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ü–µ–Ω–∏—Ç–µ –ø–æ–º–æ—â–Ω–∏–∫–∞."),_t.value=!0}catch(l){console.error("Failed to complete request:",l),alert((null==(a=null==(t=l.response)?void 0:t.data)?void 0:a.message)||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞—è–≤–∫—É")}finally{Ct.value=!1}}function sa(){wt.value&&(wt.value.userHasRated=!0),_t.value=!1}function na(){var e;null==(e=jt.value)||e.click()}function ia(e){var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(a.type)?a.size>10485760?alert("–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä: 10 –ú–ë"):(It.value=a,Mt.value=URL.createObjectURL(a)):alert("–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ: JPEG, PNG, WebP, GIF")}function oa(e=!0){e&&Mt.value&&URL.revokeObjectURL(Mt.value),It.value=null,Mt.value=null,jt.value&&(jt.value.value="")}function ua(e){zt.value=e}async function da(){if(!L.value.trim()&&!It.value||!V.value||H.value)return;const e=L.value.trim(),t=It.value,a=Mt.value;L.value="",oa(!1);const l="temp-"+Date.now();T.value.push({id:l,content:e,is_mine:!0,createdAt:(new Date).toISOString(),is_sending:!0,image_url:a}),await b(),pa();try{H.value=!0;let r=null,s=null;if(t){St.value=!0;try{const e=await I.uploadChatImage(t);e.success&&(r=e.image_url,s=e.thumbnail_url)}finally{St.value=!1}}const n=await I.client.post(`/chats/${V.value}/messages`,{content:e||"",image_url:r,thumbnail_url:s});if((null==n?void 0:n.success)&&(null==n?void 0:n.data)){const e=T.value.findIndex(e=>e.id===l);-1!==e&&(T.value[e]={...n.data,is_mine:!0,createdAt:n.data.createdAt||n.data.created_at}),a&&URL.revokeObjectURL(a)}}catch(r){const e=T.value.findIndex(e=>e.id===l);-1!==e&&(T.value[e].is_failed=!0,T.value[e].is_sending=!1),a&&URL.revokeObjectURL(a)}finally{H.value=!1}}function ca(){Wt&&V.value&&Wt.emit("chat:typing",{chatId:V.value})}function va(){const e=localStorage.getItem("token");if(!e)return;const t="https:"===window.location.protocol?`wss://${window.location.host}`:`ws://${window.location.host}`;Wt=A(t.replace(/^ws/,"http"),{auth:{token:e}}),Wt.emit("chat:join",{chatId:V.value}),Wt.on("chat:newMessage",e=>{var t;if(e.chatId===V.value){if(T.value.some(t=>{var a,l;return t.id===e.id||(null==(l=null==(a=t.id)?void 0:a.startsWith)?void 0:l.call(a,"temp-"))&&t.content===e.content})){const t=T.value.findIndex(t=>{var a,l;return(null==(l=null==(a=t.id)?void 0:a.startsWith)?void 0:l.call(a,"temp-"))&&t.content===e.content});return void(-1!==t&&(T.value[t]={...T.value[t],id:e.id,is_sending:!1}))}e.senderId!==(null==(t=B.user)?void 0:t.id)&&(T.value.push({id:e.id,content:e.content,sender_id:e.senderId,is_mine:!1,createdAt:e.createdAt||(new Date).toISOString()}),b(()=>pa()),xt.value=!1)}}),Wt.on("chat:typing",e=>{var t;e.chatId===V.value&&e.userId!==(null==(t=B.user)?void 0:t.id)&&(xt.value=!0,Gt&&clearTimeout(Gt),Gt=setTimeout(()=>{xt.value=!1},3e3))}),Wt.on("chat:read",e=>{e.chatId===V.value&&T.value.forEach(e=>{e.is_mine&&(e.is_read=!0)})})}function ga(){if(!O.value)return;const{scrollTop:e,scrollHeight:t,clientHeight:a}=O.value;kt.value=t-e-a>200}function pa(e=!1){O.value&&setTimeout(()=>{O.value&&(O.value.scrollTop=O.value.scrollHeight,kt.value=!1)},e?100:50)}function ya(e,t){e.reactions||(e.reactions=[]);const a=e.reactions.find(e=>e.emoji===t);a?a.count++:e.reactions.push({emoji:t,count:1})}async function ha(){try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});$t.value=new MediaRecorder(e,{mimeType:"audio/webm"}),Dt.value=[],$t.value.ondataavailable=e=>Dt.value.push(e.data),$t.value.onstop=async()=>{const t=new Blob(Dt.value,{type:"audio/webm"});await async function(e){if(!V.value||0===Dt.value.length)return;try{H.value=!0;const t=await I.uploadVoiceMessage(e,qt.value);if(t.success){const e=await I.client.post(`/chats/${V.value}/messages`,{content:"",voice_url:t.voice_url,voice_duration:t.duration});(null==e?void 0:e.success)&&(null==e?void 0:e.data)&&(T.value.push({...e.data,is_mine:!0,createdAt:e.data.createdAt||e.data.created_at}),await b(),pa())}}catch(t){console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ:",t)}finally{H.value=!1,qt.value=0}}(t),e.getTracks().forEach(e=>e.stop())},$t.value.start(),Rt.value=!0,qt.value=0,Bt=setInterval(()=>qt.value++,1e3)}catch(e){alert("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É")}}function fa(){$t.value&&Rt.value&&($t.value.stop(),Rt.value=!1,clearInterval(Bt))}function ba(){$t.value&&Rt.value&&($t.value.stop(),Rt.value=!1,clearInterval(Bt),Dt.value=[])}function xa(e){const t=Lt[e];t&&(Object.entries(Lt).forEach(([t,a])=>{t===e||a.paused||(a.pause(),a.currentTime=0)}),Tt.value===e?(t.pause(),Tt.value=null):(t.play(),Tt.value=e))}async function ma(){if(!Ft.value||Ft.value.length<2)Ht.value=[];else try{Vt.value=!0;const e=await I.searchMessages(V.value,Ft.value);Ht.value=e.data||[]}catch(e){console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:",e)}finally{Vt.value=!1}}function ka(){Ut.value=!Ut.value,Ut.value||(Ft.value="",Ht.value=[])}function wa(e){return e?e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?"}function _a(e){return e?new Date(e).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}):""}function Ca(e){if(!e)return"–±—ã–ª(–∞) –¥–∞–≤–Ω–æ";const t=Math.floor((new Date-new Date(e))/6e4);return t<5?"–æ–Ω–ª–∞–π–Ω":t<60?`–±—ã–ª(–∞) ${t} –º–∏–Ω –Ω–∞–∑–∞–¥`:t<1440?`–±—ã–ª(–∞) ${Math.floor(t/60)} —á –Ω–∞–∑–∞–¥`:`–±—ã–ª(–∞) ${Math.floor(t/1440)} –¥–Ω –Ω–∞–∑–∞–¥`}function ja(e){if(!e)return"";const t=new Date(e),a=new Date,l=new Date(a);return l.setDate(l.getDate()-1),t.toDateString()===a.toDateString()?"–°–µ–≥–æ–¥–Ω—è":t.toDateString()===l.toDateString()?"–í—á–µ—Ä–∞":t.toLocaleDateString("ru-RU",{day:"numeric",month:"long"})}function Ia(e,t){return!t||t.is_mine||t.sender_id!==e.sender_id}function Ma(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("blob:"))return e;return"https://help-car.online/api/v1".replace("/api/v1","")+e}function Sa(e){e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="150" viewBox="0 0 200 150"><rect fill="%23e5e7eb" width="200" height="150"/><text x="100" y="75" text-anchor="middle" fill="%239ca3af" font-size="14">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</text></svg>',e.target.style.opacity="0.7"}function za(e){console.warn("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ:",e.target.src);const t=e.target.parentElement;t&&(t.innerHTML='<span class="text-xs text-red-500">‚úñ –ê—É–¥–∏–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>')}function Aa(e){if(!e)return[];const t=e.match(/https?:\/\/[^\s<>"{}|\\^`[\]]+/gi)||[];return[...new Set(t.map(e=>e.replace(/[.,;:!?)]+$/,"")))].slice(0,2)}return h(async()=>{var e;if(B.user||await B.checkAuth(),$.params.chatId)V.value=$.params.chatId,await Yt();else{const e=$.params.requestId||$.params.id;e&&await Zt(e)}V.value&&(await ea(),va()),null==(e=E.value)||e.focus()}),f(()=>{Wt&&Wt.disconnect(),Gt&&clearTimeout(Gt),Bt&&clearInterval(Bt)}),t(L,()=>{b(()=>{E.value&&(E.value.style.height="auto",E.value.style.height=Math.min(E.value.scrollHeight,128)+"px")})}),t(()=>$.params,async(e,t)=>{e.requestId===(null==t?void 0:t.requestId)&&e.chatId===(null==t?void 0:t.chatId)||(T.value=[],V.value=null,P.value=null,U.value=!0,Wt&&(Wt.disconnect(),Wt=null),e.chatId?(V.value=e.chatId,await Yt()):e.requestId&&await Zt(e.requestId),V.value&&(await ea(),va()))},{deep:!0}),(e,t)=>{var p;const y=C("router-link");return r(),a("div",N,[t[38]||(t[38]=s("div",{class:"chat-bg-pattern"},null,-1)),s("div",K,[s("div",J,[s("div",Q,[s("button",{class:"p-2 -ml-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition",onClick:Xt},[...t[18]||(t[18]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),P.value?(r(),m(y,{key:0,to:`/user/${P.value.id}`,class:"flex items-center gap-3 group"},{default:k(()=>{return[s("div",X,[P.value.avatar_url?(r(),a("div",Y,[s("img",{src:(e=P.value.avatar_url,Ma(e)),class:"w-full h-full object-cover"},null,8,Z)])):(r(),a("div",ee,i(wa(P.value.full_name)),1)),P.value.is_online?(r(),a("span",te)):P.value.is_available_to_help?(r(),a("span",ae)):l("",!0)]),s("div",null,[s("div",le,[s("p",re,i(P.value.full_name),1),j(R,{status:P.value.premium_status,size:"xs"},null,8,["status"])]),xt.value?(r(),a("p",se,"–ø–µ—á–∞—Ç–∞–µ—Ç...")):P.value.is_online?(r(),a("p",ne,[...t[19]||(t[19]=[s("span",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1),n(" –æ–Ω–ª–∞–π–Ω ",-1)])])):(r(),a("p",ie,i(Ca(P.value.last_seen||P.value.last_login)),1))])];var e}),_:1},8,["to"])):l("",!0)]),s("div",oe,[s("button",{onClick:t[0]||(t[0]=e=>la("audio")),class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition text-gray-600 dark:text-gray-400",title:"–ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫"},[...t[20]||(t[20]=[s("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[s("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})],-1)])]),s("button",{onClick:t[1]||(t[1]=e=>la("video")),class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition text-gray-600 dark:text-gray-400",title:"–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫"},[...t[21]||(t[21]=[s("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[s("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"})],-1)])]),!P.value||P.value.isFriend||bt.value?bt.value?(r(),a("span",de,"‚úì")):(null==(p=P.value)?void 0:p.isFriend)?(r(),a("span",ce,"üë•")):l("",!0):(r(),a("button",{key:0,disabled:W.value,class:"px-3 py-1.5 bg-blue-600 text-white text-xs rounded-full hover:bg-blue-700 transition disabled:opacity-50",onClick:aa},i(W.value?"...":"üë•"),9,ue)),s("button",{class:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition",onClick:t[2]||(t[2]=e=>mt.value=!mt.value)},[...t[22]||(t[22]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})],-1)])])])]),mt.value?(r(),a("div",ve,[s("button",{class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:t[3]||(t[3]=e=>{ka(),mt.value=!1})}," üîç –ü–æ–∏—Å–∫ "),s("button",{class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:t[4]||(t[4]=e=>{!async function(){try{const e=await I.getChatMedia(V.value,"images");Et.value=e.data||[],Ot.value=!0}catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–∏:",e)}}(),mt.value=!1})}," üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è "),s("button",{class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:t[5]||(t[5]=e=>{!async function(){if(navigator.geolocation)try{const e=await new Promise((e,t)=>navigator.geolocation.getCurrentPosition(e,t,{timeout:1e4})),{latitude:t,longitude:a}=e.coords,l=`https://www.google.com/maps?q=${t},${a}`,r=await I.client.post(`/chats/${V.value}/messages`,{content:`üìç –ú–æ—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è: ${l}`,message_type:"location"});(null==r?void 0:r.success)&&(null==r?void 0:r.data)&&(T.value.push({...r.data,is_mine:!0,createdAt:r.data.createdAt||r.data.created_at}),await b(),pa())}catch(e){alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é")}else alert("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è")}(),mt.value=!1})}," üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è "),t[23]||(t[23]=s("div",{class:"border-t dark:border-gray-700 my-1"},null,-1)),P.value?(r(),a("button",{key:0,class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:t[6]||(t[6]=e=>{var t;t=P.value.id,D.push(`/user/${t}`),mt.value=!1})}," üë§ –ü—Ä–æ—Ñ–∏–ª—å ")):l("",!0),s("button",{class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:t[7]||(t[7]=e=>{confirm("–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?")&&(T.value=[]),mt.value=!1})}," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç ")])):l("",!0)]),Nt.value&&wt.value?(r(),a("div",ge,[s("div",pe,[s("div",ye,[s("div",he,[s("span",fe,i(Qt.value),1),wt.value.status?(r(),a("span",{key:0,class:d(["px-2 py-0.5 rounded-full text-xs",{"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400":"accepted"===wt.value.status,"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-400":"in_progress"===wt.value.status,"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-400":"completed"===wt.value.status,"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-400":!["accepted","in_progress","completed"].includes(wt.value.status)}])},i("accepted"===wt.value.status?"–ü—Ä–∏–Ω—è—Ç–∞":"in_progress"===wt.value.status?"–í —Ä–∞–±–æ—Ç–µ":"completed"===wt.value.status?"–ó–∞–≤–µ—Ä—à–µ–Ω–∞":wt.value.status),3)):l("",!0)]),wt.value.address?(r(),a("p",be," üìç "+i(wt.value.address),1)):l("",!0)]),s("div",xe,[Kt.value?(r(),a("button",{key:0,disabled:Ct.value,class:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded-full transition flex items-center gap-1 disabled:opacity-50",onClick:ra},[Ct.value?(r(),a("span",ke)):(r(),a("span",we,"‚úÖ")),t[24]||(t[24]=n(" –ó–∞–≤–µ—Ä—à–∏—Ç—å ",-1))],8,me)):l("",!0),Jt.value?(r(),a("button",{key:1,class:"px-3 py-1.5 bg-yellow-500 hover:bg-yellow-600 text-white text-xs font-medium rounded-full transition flex items-center gap-1",onClick:t[8]||(t[8]=e=>_t.value=!0)}," ‚≠ê –û—Ü–µ–Ω–∏—Ç—å ")):l("",!0)])])])):l("",!0),s("div",{ref_key:"chatContainer",ref:O,class:"flex-1 overflow-y-auto p-4 space-y-3 messages-area relative z-10",onScroll:ga},[F.value?(r(),a("div",_e,[...t[25]||(t[25]=[s("div",{class:"inline-flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 rounded-full shadow text-sm text-gray-500"},[s("div",{class:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),n(" –ó–∞–≥—Ä—É–∑–∫–∞... ")],-1)])])):l("",!0),U.value?(r(),a(o,{key:1},u(8,e=>s("div",{key:"s"+e,class:d(["flex",e%2?"justify-start":"justify-end"])},[s("div",{class:d(["max-w-xs px-4 py-3 rounded-2xl skeleton",e%2?"bg-white dark:bg-gray-800":"bg-blue-500"]),style:{width:"60%"}},null,2)],2)),64)):(r(),a(o,{key:2},[(r(!0),a(o,null,u(T.value,(e,n)=>{var c,v,g,p;return r(),a(o,{key:e.id},[(g=e,p=T.value[n-1],p&&new Date(g.createdAt).toDateString()===new Date(p.createdAt).toDateString()?l("",!0):(r(),a("div",Ce,[s("span",je,i(ja(e.createdAt)),1)]))),s("div",{class:d(["flex",e.is_mine?"justify-end":"justify-start"])},[!e.is_mine&&Ia(e,T.value[n+1])?(r(),a("div",Ie,i(wa(null==(c=P.value)?void 0:c.full_name)),1)):e.is_mine?l("",!0):(r(),a("div",Me)),s("div",Se,[s("div",{class:d(["px-4 py-2.5 rounded-2xl message-bubble break-words relative group",e.is_mine?"message-mine":"message-other"])},[e.image_url?(r(),a("div",ze,[s("img",{src:Ma(e.thumbnail_url||e.image_url),alt:e.content||"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",class:"max-w-full rounded-xl cursor-pointer hover:opacity-90 transition",style:{"max-height":"300px","object-fit":"contain","min-width":"100px","min-height":"100px",background:"#f3f4f6"},loading:"lazy",onClick:t=>ua(e.image_url),onError:Sa},null,40,Ae)])):l("",!0),e.voice_url?(r(),a("div",Re,[s("div",{class:d(["flex items-center gap-3 p-2 rounded-xl",e.is_mine?"bg-white/20":"bg-gray-100 dark:bg-gray-600"])},[s("button",{type:"button",onClick:t=>xa(e.id),class:d(["w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 transition",e.is_mine?"bg-white/30 hover:bg-white/40 text-white":"bg-blue-500 hover:bg-blue-600 text-white"])},[Tt.value!==e.id?(r(),a("svg",$e,[...t[26]||(t[26]=[s("path",{d:"M8 5v14l11-7z"},null,-1)])])):(r(),a("svg",De,[...t[27]||(t[27]=[s("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])]))],10,qe),s("div",Be,[s("div",Te,[s("div",{class:d(["flex-1 h-1 rounded-full",e.is_mine?"bg-white/30":"bg-gray-300 dark:bg-gray-500"])},[s("div",{class:"h-full rounded-full bg-current w-0",id:`voice-progress-${e.id}`},null,8,Le)],2),s("span",{class:d(["text-xs",e.is_mine?"text-white/70":"text-gray-500 dark:text-gray-400"])},i((v=e.voice_duration,v?`${Math.floor(v/60)}:${Math.floor(v%60).toString().padStart(2,"0")}`:"0:00")),3)])]),s("audio",{ref_for:!0,ref:t=>{t&&(Lt[e.id]=t)},src:Ma(e.voice_url),onEnded:t=>function(e){Tt.value=null;const t=T.value.findIndex(t=>t.id===e);if(-1!==t)for(let a=t+1;a<T.value.length;a++){const e=T.value[a];if(e.voice_url){setTimeout(()=>{xa(e.id)},300);break}}}(e.id),onTimeupdate:t=>function(e,t){const a=t.target,l=a.currentTime/a.duration*100,r=document.getElementById(`voice-progress-${e}`);r&&(r.style.width=`${l}%`)}(e.id,t),onError:za,class:"hidden"},null,40,Ue)],2)])):l("",!0),e.content?(r(),a("p",Fe,i(e.content),1)):l("",!0),(r(!0),a(o,null,u(Aa(e.content),e=>(r(),m(q,{key:e,url:e},null,8,["url"]))),128)),s("div",{class:d(["absolute top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",e.is_mine?"-left-16":"-right-16"])},[s("button",{class:"w-7 h-7 bg-white dark:bg-gray-700 rounded-full shadow flex items-center justify-center hover:scale-110 transition text-sm",onClick:t=>ya(e,"üëç")},"üëç",8,He),s("button",{class:"w-7 h-7 bg-white dark:bg-gray-700 rounded-full shadow flex items-center justify-center hover:scale-110 transition text-sm",onClick:t=>ya(e,"‚ù§Ô∏è")},"‚ù§Ô∏è",8,Ve)],2),e.reactions&&e.reactions.length?(r(),a("div",Oe,[(r(!0),a(o,null,u(e.reactions,e=>(r(),a("span",{key:e.emoji,class:"px-2 py-0.5 bg-black/10 dark:bg-white/10 rounded-full text-xs"},i(e.emoji)+" "+i(e.count),1))),128))])):l("",!0)],2),s("div",{class:d(["flex items-center gap-1.5 mt-1 text-xs",e.is_mine?"justify-end":"justify-start"])},[s("span",Ee,i(_a(e.createdAt)),1),e.is_mine?(r(),a("span",{key:0,class:d(e.is_read?"text-blue-500":"text-gray-400")},i(e.is_read?"‚úì‚úì":"‚úì"),3)):l("",!0)],2)])],2)],64)}),128)),xt.value?(r(),a("div",Pe,[...t[28]||(t[28]=[w('<div class="bg-gray-200 dark:bg-gray-700 rounded-2xl rounded-bl-md px-4 py-3" data-v-b52f5e3d><div class="flex gap-1" data-v-b52f5e3d><span class="w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce" style="animation-delay:0ms;" data-v-b52f5e3d></span><span class="w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce" style="animation-delay:150ms;" data-v-b52f5e3d></span><span class="w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce" style="animation-delay:300ms;" data-v-b52f5e3d></span></div></div>',1)])])):l("",!0)],64)),kt.value?(r(),a("button",{key:3,class:"fixed bottom-24 right-6 w-10 h-10 bg-white dark:bg-gray-800 shadow-lg rounded-full flex items-center justify-center text-blue-500 hover:bg-gray-50 dark:hover:bg-gray-700 transition z-10",onClick:pa},[...t[29]||(t[29]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 14l-7 7m0 0l-7-7m7 7V3"})],-1)])])):l("",!0)],544),s("div",We,[It.value?(r(),a("div",Ge,[s("img",{src:Mt.value,class:"h-20 rounded-lg object-cover"},null,8,Ne),s("button",{type:"button",class:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-sm hover:bg-red-600 transition",onClick:oa},"‚úï"),St.value?(r(),a("div",Ke,[...t[30]||(t[30]=[s("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)])])):l("",!0)])):l("",!0),Rt.value?(r(),a("div",Je,[t[31]||(t[31]=s("div",{class:"w-3 h-3 bg-red-500 rounded-full animate-pulse"},null,-1)),s("span",Qe,"–ó–∞–ø–∏—Å—å "+i((h=qt.value,`${Math.floor(h/60)}:${(h%60).toString().padStart(2,"0")}`)),1),t[32]||(t[32]=s("div",{class:"flex-1"},null,-1)),s("button",{onClick:ba,class:"p-2 text-gray-500 hover:text-red-600"},"‚úï"),s("button",{onClick:fa,class:"px-4 py-1.5 bg-red-600 text-white rounded-full text-sm font-medium hover:bg-red-700"},"–û—Ç–ø—Ä–∞–≤–∏—Ç—å")])):(r(),a("div",Xe,[s("button",{class:"p-2 text-gray-400 hover:text-blue-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition flex-shrink-0",disabled:St.value,onClick:na},[...t[33]||(t[33]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,Ye),s("input",{ref_key:"imageInputRef",ref:jt,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",class:"hidden",onChange:ia},null,544),s("div",Ze,[c(s("textarea",{ref_key:"inputRef",ref:E,"onUpdate:modelValue":t[9]||(t[9]=e=>L.value=e),placeholder:"–°–æ–æ–±—â–µ–Ω–∏–µ...",rows:"1",class:"w-full px-4 py-2.5 bg-gray-100/80 dark:bg-gray-700/80 border border-gray-200 dark:border-gray-600 rounded-2xl text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none max-h-32 text-sm sm:text-base transition-all",style:{"overflow-y":"auto"},onKeydown:_(g(da,["exact","prevent"]),["enter"]),onInput:ca},null,40,et),[[v,L.value]])]),s("div",tt,[s("button",{type:"button",class:"p-2 text-gray-400 hover:text-yellow-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition flex-shrink-0",onClick:t[10]||(t[10]=e=>At.value=!At.value)},[...t[34]||(t[34]=[s("span",{class:"text-xl"},"üòä",-1)])]),At.value?(r(),a("div",at,[s("div",lt,[(r(),a(o,null,u(Pt,e=>s("button",{key:e,type:"button",class:"w-8 h-8 flex items-center justify-center text-xl hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition",onClick:t=>function(e){var t;L.value+=e,At.value=!1,null==(t=E.value)||t.focus()}(e)},i(e),9,rt)),64))])])):l("",!0)]),L.value.trim()||It.value?(r(),a("button",{key:1,disabled:!L.value.trim()&&!It.value||H.value,class:d(["p-2.5 rounded-full transition flex-shrink-0",L.value.trim()||It.value?"bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-600/30":"bg-gray-200 dark:bg-gray-700 text-gray-400"]),onClick:da},[...t[36]||(t[36]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],10,st)):(r(),a("button",{key:0,class:"p-2.5 text-gray-400 hover:text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition flex-shrink-0",onClick:ha},[...t[35]||(t[35]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})],-1)])]))]))]),Ut.value?(r(),a("div",nt,[s("div",it,[s("div",ot,[c(s("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>Ft.value=e),type:"text",placeholder:"–ü–æ–∏—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏–π...",class:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white",onInput:ma},null,544),[[v,Ft.value]]),s("button",{onClick:ka,class:"p-2 text-gray-500"},"‚úï")]),s("div",ut,[Vt.value?(r(),a("div",dt,"–ü–æ–∏—Å–∫...")):0===Ht.value.length&&Ft.value?(r(),a("div",ct,"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")):l("",!0),(r(!0),a(o,null,u(Ht.value,e=>(r(),a("div",{key:e.id,class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer",onClick:t[12]||(t[12]=e=>Ut.value=!1)},[s("p",vt,i(e.content),1),s("p",gt,i(_a(e.created_at)),1)]))),128))])])])):l("",!0),Ot.value?(r(),a("div",pt,[s("button",{onClick:t[13]||(t[13]=e=>Ot.value=!1),class:"absolute top-4 right-4 text-white text-2xl"},"‚úï"),t[37]||(t[37]=s("h3",{class:"text-white text-xl mb-4"},"–ú–µ–¥–∏–∞ –≤ —á–∞—Ç–µ",-1)),s("div",yt,[(r(!0),a(o,null,u(Et.value,e=>(r(),a("img",{key:e.id,src:Ma(e.thumbnail_url||e.image_url),class:"aspect-square object-cover rounded cursor-pointer hover:opacity-80",onClick:t=>ua(e.image_url)},null,8,ht))),128))])])):l("",!0),zt.value?(r(),a("div",{key:3,class:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:t[16]||(t[16]=e=>zt.value=null)},[s("button",{class:"absolute top-4 right-4 w-10 h-10 bg-white/10 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition",onClick:t[14]||(t[14]=e=>zt.value=null)},"‚úï"),s("img",{src:Ma(zt.value),class:"max-w-full max-h-full object-contain",onClick:t[15]||(t[15]=g(()=>{},["stop"]))},null,8,ft)])):l("",!0),wt.value&&P.value?(r(),m(G,{key:4,"is-open":_t.value,"help-request-id":String(wt.value.id),"helper-id":String(P.value.id),"helper-name":P.value.full_name,onClose:t[17]||(t[17]=e=>_t.value=!1),onRated:sa},null,8,["is-open","help-request-id","helper-id","helper-name"])):l("",!0)]);var h}}},[["__scopeId","data-v-b52f5e3d"]]);export{bt as default};
