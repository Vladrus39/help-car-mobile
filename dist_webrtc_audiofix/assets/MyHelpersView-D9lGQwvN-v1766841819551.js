import{r as e,c as t,o as s,h as a,f as l,l as r,m as n,t as o,F as i,i as u,g as d,x as c,p as g,I as v,J as b,k as x,u as p,n as m,v as f}from"./vendor-mW7CftnD-v1766841819551.js";import{u as y,a as h}from"./index-Y1ONQ0D2-v1766841819551.js";import{_ as k}from"./NavigationHeader-CU85bLe9-v1766841819551.js";import{u as w}from"./useRequestHelpers-BcrxoIB--v1766841819551.js";import"./utils-MqoAbdB_-v1766841819551.js";import"./maps-CCq-KL9W-v1766841819551.js";const R={class:"min-h-screen bg-gray-50"},F={class:"max-w-4xl mx-auto py-8 px-4"},q={key:0,class:"mb-6 p-4 bg-red-50 border-2 border-red-200 rounded-xl"},C={class:"text-red-700 font-bold"},_={class:"space-y-6"},j={class:"flex items-start justify-between mb-5"},H={class:"text-2xl font-black text-gray-900"},S={class:"text-base text-gray-600 mt-1 font-medium"},I={class:"text-lg text-gray-800 mb-5 leading-relaxed"},M={key:0,class:"mb-4 p-4 bg-blue-50 rounded-lg"},z={class:"flex items-center justify-between"},E={class:"text-sm text-gray-600"},N=["disabled","onClick"],U={key:1,class:"px-3 py-2 bg-yellow-100 text-yellow-700 text-sm rounded-lg font-semibold"},V={key:2,class:"px-3 py-2 bg-green-100 text-green-700 text-sm rounded-lg font-semibold"},A={class:"flex items-center justify-between"},B={class:"text-green-600 font-black text-2xl"},D={class:"flex gap-2"},J=["onClick"],L={key:1,class:"px-4 py-2 bg-green-100 text-green-700 rounded-lg font-bold"},P={key:0,class:"text-center py-12"},T={class:"bg-white rounded-2xl shadow-2xl max-w-md w-full p-8"},$={class:"text-gray-600 mb-6"},G={class:"flex justify-center gap-2 mb-6"},K=["onClick"],O={class:"flex gap-3"},Q=["disabled"],W={__name:"MyHelpersView",setup(W){const{getProblemTypeName:X,getStatusName:Y,getStatusClass:Z,formatDate:ee}=w(),te=y(),se=e([]),ae=e(!1),le=e(null),re=e(0),ne=e(""),oe=e(!1),ie=t(()=>se.value.filter(e=>{var t;return e.helper_id===(null==(t=te.user)?void 0:t.id)&&("accepted"===e.status||"in_progress"===e.status||"completed"===e.status)}));s(async()=>{await de()});const ue=e(null);async function de(){try{ue.value=null;let s=[];try{const e=await h.getFriends(),t=(null==e?void 0:e.data)||e||[];s=t.map(e=>{var t;return null==(t=e.friend)?void 0:t.id})}catch(e){console.error("Error loading friends:",e)}const a=await h.getHelpRequests(),l=((null==a?void 0:a.data)||a||[]).map(e=>{var t;return{...e,created_at:e.createdAt||e.created_at,userIsFriend:!!(null==(t=e.user)?void 0:t.id)&&s.includes(e.user.id),userFriendRequestSent:!1,sendingFriendRequest:!1}});se.value=l;for(const e of ie.value)if("completed"===e.status&&e.user_id)try{const t=await h.getRatingStatus(e.id);e.userHasRated=t.currentUserHasRated,e.mutualRatingsComplete=t.mutualRatingsComplete}catch(t){console.error("Error loading rating status:",t)}}catch(t){console.error("Error loading requests:",t),ue.value="–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É."}}async function ce(){if(0!==re.value)try{oe.value=!0,await h.createRating(le.value.id,{rating:re.value,comment:ne.value||null}),alert("–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ü–µ–Ω–∫—É!"),ae.value=!1,await de()}catch(e){console.error("Error submitting rating:",e),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ü–µ–Ω–∫–∏")}finally{oe.value=!1}else alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É")}return(e,t)=>{var s,y;const w=c("router-link");return x(),a("div",R,[l(k),r("div",F,[t[7]||(t[7]=r("h1",{class:"text-4xl font-black mb-10 text-gray-900"}," –ú–æ–∏ –ø–æ–º–æ—â–∏ ",-1)),ue.value?(x(),a("div",q,[r("p",C,o(ue.value),1)])):n("",!0),r("div",_,[(x(!0),a(i,null,u(ie.value,e=>(x(),a("div",{key:e.id,class:"bg-white rounded-2xl shadow-xl p-8 hover:shadow-2xl transition-all"},[r("div",j,[r("div",null,[r("h3",H,o(p(X)(e.problem_type)),1),r("p",S,o(p(ee)(e.created_at)),1)]),r("span",{class:m([p(Z)(e.status),"px-4 py-2 rounded-xl text-base font-black"])},o(p(Y)(e.status)),3)]),r("p",I,o(e.description),1),e.user?(x(),a("div",M,[r("div",z,[r("div",null,[t[3]||(t[3]=r("p",{class:"text-sm text-gray-600 font-semibold mb-1"}," –ó–∞—è–≤–∏—Ç–µ–ª—å: ",-1)),l(w,{to:`/user/${e.user.id}`,class:"text-lg font-bold text-gray-900 hover:text-blue-600 transition block"},{default:d(()=>[f(o(e.user.full_name),1)]),_:2},1032,["to"]),r("p",E," –†–µ–π—Ç–∏–Ω–≥: ‚≠ê "+o(e.user.rating||"0.00"),1)]),e.userIsFriend||e.userFriendRequestSent?e.userFriendRequestSent?(x(),a("span",U," ‚úì –ó–∞—è–≤–∫–∞ ")):e.userIsFriend?(x(),a("span",V," ‚úì –î—Ä—É–≥ ")):n("",!0):(x(),a("button",{key:0,disabled:e.sendingFriendRequest,class:"px-3 py-2 bg-blue-600 text-white text-sm rounded-lg hover:bg-blue-700 transition disabled:opacity-50 flex-shrink-0",onClick:t=>async function(e){var t,s,a,l;if(null==(t=e.user)?void 0:t.id)try{e.sendingFriendRequest=!0;const t=await h.sendFriendRequest(e.user.id);t.success&&(e.userFriendRequestSent=!0,(null==(s=t.message)?void 0:s.includes("—Ç–µ–ø–µ—Ä—å –¥—Ä—É–∑—å—è"))&&(e.userIsFriend=!0,e.userFriendRequestSent=!1))}catch(r){console.error("Failed to send friend request:",r),alert((null==(l=null==(a=r.response)?void 0:a.data)?void 0:l.message)||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É")}finally{e.sendingFriendRequest=!1}}(e)},o(e.sendingFriendRequest?"...":"üë• –í –¥—Ä—É–∑—å—è"),9,N))])])):n("",!0),r("div",A,[r("span",B,"üí∞ "+o(e.amount)+" ‚ÇΩ",1),r("div",D,["completed"!==e.status||e.userHasRated?n("",!0):(x(),a("button",{key:0,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",onClick:t=>function(e){le.value=e,re.value=0,ne.value="",ae.value=!0}(e)}," ‚≠ê –û—Ü–µ–Ω–∏—Ç—å –∑–∞—è–≤–∏—Ç–µ–ª—è ",8,J)),e.mutualRatingsComplete?(x(),a("span",L," ‚úÖ –û—Ü–µ–Ω–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã ")):n("",!0)])])]))),128)),0===ie.value.length?(x(),a("div",P,[t[5]||(t[5]=r("svg",{class:"w-20 h-20 mx-auto mb-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})],-1)),t[6]||(t[6]=r("p",{class:"text-gray-500 mb-4"}," –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–Ω—è—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø–æ–º–æ—â—å ",-1)),l(w,{to:"/map",class:"inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition"},{default:d(()=>[...t[4]||(t[4]=[f(" –ù–∞–π—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –∫–∞—Ä—Ç–µ ",-1)])]),_:1})])):n("",!0)])]),ae.value?(x(),a("div",{key:0,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",onClick:t[2]||(t[2]=g(e=>ae.value=!1,["self"]))},[r("div",T,[t[8]||(t[8]=r("h3",{class:"text-2xl font-black text-gray-900 mb-4"}," –û—Ü–µ–Ω–∏—Ç–µ –∑–∞—è–≤–∏—Ç–µ–ª—è ",-1)),r("p",$,o(null==(y=null==(s=le.value)?void 0:s.user)?void 0:y.full_name),1),r("div",G,[(x(),a(i,null,u(5,e=>r("button",{key:e,class:"text-4xl transition-transform hover:scale-110",onClick:t=>re.value=e},o(e<=re.value?"‚≠ê":"‚òÜ"),9,K)),64))]),v(r("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>ne.value=e),placeholder:"–û—Å—Ç–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)",class:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mb-6 resize-none",rows:"3"},null,512),[[b,ne.value]]),r("div",O,[r("button",{class:"flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-bold hover:bg-gray-50 transition",onClick:t[1]||(t[1]=e=>ae.value=!1)}," –û—Ç–º–µ–Ω–∞ "),r("button",{disabled:0===re.value||oe.value,class:"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed",onClick:ce},o(oe.value?"–û—Ç–ø—Ä–∞–≤–∫–∞...":"–û—Ç–ø—Ä–∞–≤–∏—Ç—å"),9,Q)])])])):n("",!0)])}}};export{W as default};
