import{r as e,o as t,a,h as l,m as o,l as s,t as n,f as r,g as i,v as c,x as d,u,q as m,p as g,n as v,k as p,c as f,w as x,e as b,F as h,i as y,y as w,G as k}from"./vendor-mW7CftnD-v1766842044731.js";import{_,a as q,u as R,w as j}from"./index-B47n4XC8-v1766842044731.js";import{_ as C}from"./NavigationHeader-CLVJS0Hp-v1766842044731.js";import{u as M}from"./useRequestHelpers-BMWunBiJ-v1766842044731.js";import{_ as I}from"./OpenStreetMapWidget-Cyf0y0My-v1766842044731.js";import"./utils-D_mSMGs1-v1766842044731.js";import"./maps-CCq-KL9W-v1766842044731.js";const H={class:"bg-gradient-to-r from-red-500 to-orange-500 text-white p-3 sm:p-4 rounded-t-xl sm:rounded-t-2xl"},S={class:"flex items-center justify-between"},N={class:"flex items-center space-x-2 sm:space-x-3"},$={class:"w-10 h-10 sm:w-12 sm:h-12 bg-white/20 rounded-full flex items-center justify-center flex-shrink-0"},A={class:"text-xl sm:text-2xl"},O={class:"min-w-0"},P={class:"p-3 sm:p-4"},F={class:"flex items-center justify-between mb-2 sm:mb-3"},L={class:"text-base sm:text-lg font-semibold text-gray-800"},W={class:"text-xl sm:text-2xl font-bold text-green-600"},E={class:"text-sm sm:text-base text-gray-600 mb-3 sm:mb-4 line-clamp-3"},K={class:"flex items-center text-xs sm:text-sm text-gray-500 mb-1 sm:mb-2"},V={class:"truncate"},z={class:"flex items-center text-xs text-gray-400 mb-2 sm:mb-4"},B={key:0,class:"flex items-center text-xs sm:text-sm text-blue-600 mb-2 sm:mb-4"},T={class:"flex items-center text-xs sm:text-sm text-gray-500 mb-2 sm:mb-4"},D={class:"bg-red-50 border border-red-200 rounded-lg p-2 sm:p-3 mb-3 sm:mb-4"},G={class:"flex items-center justify-between"},J={class:"text-base sm:text-lg font-bold text-red-600"},U={class:"w-full bg-red-200 rounded-full h-1.5 sm:h-2 mt-1 sm:mt-2"},Q=_({__name:"RequestNotification",props:{notification:{type:Object,required:!0},show:{type:Boolean,default:!1}},emits:["accept","decline","close"],setup(f,{emit:x}){const{formatDate:b}=M(),h=f,y=x,w=e(30);let k=null;function _(e){return{battery:"–°–µ–≤—à–∞—è –±–∞—Ç–∞—Ä–µ—è",fuel:"–ó–∞–∫–æ–Ω—á–∏–ª–æ—Å—å —Ç–æ–ø–ª–∏–≤–æ",tire:"–ü—Ä–æ–∫–æ–ª –∫–æ–ª–µ—Å–∞",towing:"–ù—É–∂–Ω–∞ –±—É–∫—Å–∏—Ä–æ–≤–∫–∞",other:"–î—Ä—É–≥–æ–µ"}[e]||"–î—Ä—É–≥–æ–µ"}async function R(){try{await q.acceptHelpRequest(h.notification.helpRequestId),y("accept",h.notification),y("close")}catch(e){console.error("Error accepting request:",e),alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞—è–≤–∫–∏")}}function j(){y("decline",h.notification),y("close")}function C(){}return t(()=>{h.show&&(w.value=30,k=setInterval(()=>{w.value--,w.value<=0&&j()},1e3))}),a(()=>{k&&clearInterval(k)}),(e,t)=>{const a=d("router-link");return f.show?(p(),l("div",{key:0,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm p-2 sm:p-4",onClick:C},[s("div",{class:v(["bg-white rounded-xl sm:rounded-2xl shadow-2xl max-w-md w-full mx-2 sm:mx-4 transform transition-all duration-300 max-h-[90vh] overflow-y-auto",f.show?"scale-100 opacity-100":"scale-95 opacity-0"]),onClick:t[0]||(t[0]=g(()=>{},["stop"]))},[s("div",H,[s("div",S,[s("div",N,[s("div",$,[s("span",A,n((x=f.notification.problemType,{battery:"üîã",fuel:"‚õΩ",tire:"üõû",towing:"üöó",other:"üîß"}[x]||"üîß")),1)]),s("div",O,[t[1]||(t[1]=s("h3",{class:"text-base sm:text-lg font-bold"}," –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞! ",-1)),r(a,{to:`/user/${f.notification.user.id}`,class:"text-xs sm:text-sm opacity-90 hover:opacity-100 hover:underline truncate block"},{default:i(()=>[c(n(f.notification.user.full_name),1)]),_:1},8,["to"])])]),s("button",{class:"w-7 h-7 sm:w-8 sm:h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition flex-shrink-0",onClick:j}," ‚úï ")])]),s("div",P,[s("div",F,[s("span",L,n(_(f.notification.problemType)),1),s("span",W,n(f.notification.amount)+"‚ÇΩ ",1)]),s("p",E,n(f.notification.description),1),s("div",K,[t[2]||(t[2]=s("span",{class:"mr-1 sm:mr-2"},"üìç",-1)),s("span",V,n(f.notification.address),1)]),s("div",z,[t[3]||(t[3]=s("span",{class:"mr-1 sm:mr-2"},"üïí",-1)),s("span",null,n(u(b)(f.notification.created_at)),1)]),f.notification.distance?(p(),l("div",B,[t[4]||(t[4]=s("span",{class:"mr-1 sm:mr-2"},"üöó",-1)),s("span",null,n(f.notification.distance)+" –∫–º –æ—Ç –≤–∞—Å",1)])):o("",!0),s("div",T,[t[5]||(t[5]=s("span",{class:"mr-1 sm:mr-2"},"‚≠ê",-1)),s("span",null,"–†–µ–π—Ç–∏–Ω–≥: "+n(f.notification.user.rating)+"/5",1)]),s("div",D,[s("div",G,[t[6]||(t[6]=s("span",{class:"text-xs sm:text-sm text-red-600 font-medium"},"–í—Ä–µ–º—è:",-1)),s("span",J,n(w.value)+"—Å",1)]),s("div",U,[s("div",{class:"bg-red-500 h-2 rounded-full transition-all duration-1000",style:m({width:w.value/30*100+"%"})},null,4)])]),s("div",{class:"flex space-x-2 sm:space-x-3"},[s("button",{class:"flex-1 bg-gray-100 text-gray-700 py-2.5 sm:py-3 px-3 sm:px-4 rounded-lg sm:rounded-xl text-sm sm:text-base font-semibold hover:bg-gray-200 transition",onClick:j}," –û—Ç–∫–ª–æ–Ω–∏—Ç—å "),s("button",{class:"flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-2.5 sm:py-3 px-3 sm:px-4 rounded-lg sm:rounded-xl text-sm sm:text-base font-semibold hover:from-green-600 hover:to-green-700 transition shadow-lg",onClick:R}," –ü—Ä–∏–Ω—è—Ç—å ")])])],2)])):o("",!0);var x}}},[["__scopeId","data-v-c49c8c19"]]),X=e([]),Y=e(null);const Z={class:"h-screen flex flex-col relative overflow-hidden"},ee={class:"flex-1 relative bg-gray-100 dark:bg-slate-900"},te={key:0,class:"absolute top-4 left-4 right-4 bg-white/95 dark:bg-slate-800/95 backdrop-blur-xl rounded-2xl shadow-2xl p-4 z-[1100] border-2 border-white/50 dark:border-slate-600/50"},ae={class:"text-center"},le={class:"flex space-x-2"},oe={key:2,class:"absolute top-2 left-2 sm:top-6 sm:left-6 w-[calc(100%-1rem)] sm:w-80 h-[30vh] sm:h-[60vh] bg-white/95 dark:bg-slate-800/95 backdrop-blur-xl rounded-2xl sm:rounded-3xl shadow-2xl overflow-hidden flex flex-col z-[1100] border-2 border-white/50 dark:border-slate-600/50 mobile-requests-panel pointer-events-auto"},se={class:"flex items-center justify-between p-4 bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 text-white relative overflow-hidden"},ne={class:"flex-1"},re={class:"flex items-center space-x-2"},ie={class:"text-blue-100 font-bold text-sm"},ce={class:"flex-1 overflow-y-auto p-4 space-y-3"},de={key:0,class:"space-y-3"},ue=["onClick"],me={class:"flex items-start space-x-3"},ge={class:"text-2xl"},ve={class:"flex-1 min-w-0"},pe={class:"flex items-start justify-between mb-1"},fe={class:"text-base font-black text-gray-900 dark:text-white truncate"},xe={class:"px-2 py-1 bg-gradient-to-r from-green-400 to-green-600 rounded-lg shadow-sm ml-2 flex-shrink-0"},be={class:"text-white font-bold text-sm"},he={class:"text-sm text-gray-700 dark:text-gray-200 line-clamp-2 mb-2"},ye={class:"flex items-center justify-between text-xs text-gray-500"},we={key:2,class:"text-center py-12"},ke={class:"absolute bottom-24 left-4 space-y-3 z-[1200] pointer-events-auto"},_e={key:1,class:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/50 backdrop-blur-sm"},qe={class:"bg-white dark:bg-slate-800 rounded-2xl p-6 m-4 max-w-sm w-full shadow-2xl"},Re={key:0,class:"text-center py-4"},je={key:1,class:"text-center py-4 text-gray-500"},Ce={key:2,class:"space-y-2 max-h-60 overflow-y-auto"},Me=["onClick"],Ie={class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold"},He={class:"font-medium text-gray-900 dark:text-white"},Se={__name:"MapView",setup(m){const{getProblemTypeName:g,formatDate:_}=M();w();const H=R(),S=e(null),N=e(!0),{activeNotification:$,addNotification:A,removeNotification:O}={activeNotification:Y,notifications:X,addNotification:function(e){var t;(null==(t=Y.value)?void 0:t.id)!==e.id&&(Y.value?X.value.push(e):Y.value=e)},removeNotification:function(){Y.value=null,X.value.length>0&&(Y.value=X.value.shift())},clearNotifications:function(){X.value=[],Y.value=null},hasActiveNotification:function(){return null!==Y.value}},{latitude:P,longitude:F,calculateDistance:L}=function(){const l=e(null),o=e(null),s=e(null),n=e(null),r=e(!0);let i=null;function c(){return new Promise((e,t)=>{if(!navigator.geolocation){const e=new Error("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤–∞—à–∏–º –±—Ä–∞—É–∑–µ—Ä–æ–º");return n.value=e.message,void t(e)}navigator.geolocation.getCurrentPosition(t=>{l.value=t.coords.latitude,o.value=t.coords.longitude,s.value=t.coords.accuracy,r.value=!1,n.value=null,console.log("‚úÖ –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞:",{lat:t.coords.latitude,lon:t.coords.longitude,accuracy:t.coords.accuracy+" –º–µ—Ç—Ä–æ–≤",timestamp:new Date(t.timestamp).toLocaleString("ru-RU")}),e(t)},e=>{n.value={1:"–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â—ë–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.",2:"–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GPS –∏–ª–∏ Wi-Fi.",3:"–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."}[e.code]||e.message,r.value=!1,console.error("‚ùå –û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:",{"–∫–æ–¥":e.code,"—Å–æ–æ–±—â–µ–Ω–∏–µ":n.value}),t(e)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0})})}function d(){null!==i&&(navigator.geolocation.clearWatch(i),i=null)}function u(e,t,a,l){const o=m(a-e),s=m(l-t),n=Math.sin(o/2)*Math.sin(o/2)+Math.cos(m(e))*Math.cos(m(a))*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*6371}function m(e){return e*(Math.PI/180)}return t(()=>{c()}),a(()=>{d()}),{latitude:l,longitude:o,accuracy:s,error:n,isLoading:r,getCurrentPosition:c,startWatching:function(){navigator.geolocation?i=navigator.geolocation.watchPosition(e=>{l.value=e.coords.latitude,o.value=e.coords.longitude,s.value=e.coords.accuracy,r.value=!1,n.value=null,console.log("üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ:",{lat:e.coords.latitude,lon:e.coords.longitude,accuracy:e.coords.accuracy+" –º"})},e=>{n.value={1:"–î–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–µ—â—ë–Ω",2:"–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ",3:"–¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞"}[e.code]||e.message,r.value=!1,console.error("‚ùå –û—à–∏–±–∫–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:",n.value)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3}):n.value="–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è"},stopWatching:d,calculateDistance:u,isWithinRadius:function(e,t,a=5){return!(!l.value||!o.value)&&u(l.value,o.value,e,t)<=a}}}(),W=e([]),E=e(!1),K=e(null),V=f(()=>S.value?W.value.filter(e=>{var t;const a=null==(t=e.status)?void 0:t.toLowerCase(),l="active"===a||"accepted"===a||"in_progress"===a||"pending_acceptance"===a,o=S.value.id===e.user_id;return l&&!o}):W.value.filter(e=>{var t;const a=null==(t=e.status)?void 0:t.toLowerCase();return"active"===a||"accepted"===a||"in_progress"===a||"pending_acceptance"===a}));async function z(){var e;try{E.value=!0,console.log("üì• –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫ —Å API...");const t=await q.getHelpRequests({status:"active"});console.log("üì¶ –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç API:",t);const a=(null==(e=t.data)?void 0:e.data)||t.data||[];console.log(`üìã –ü–æ–ª—É—á–µ–Ω–æ –∑–∞—è–≤–æ–∫ —Å API: ${a.length}`),console.log("üìã –ü–µ—Ä–≤–∞—è –∑–∞—è–≤–∫–∞ (–ø—Ä–∏–º–µ—Ä):",a[0]),W.value=a.filter(e=>{var t;const a=null==(t=e.status)?void 0:t.toLowerCase(),l="active"===a||"accepted"===a||"in_progress"===a||"pending_acceptance"===a;return e.latitude||e.lat?l:(console.warn("‚ö†Ô∏è –ó–∞—è–≤–∫–∞ –±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –ø—Ä–æ–ø—É—â–µ–Ω–∞:",e.id,e),!1)}),console.log(`‚úÖ –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏: ${W.value.length}`),W.value.forEach(e=>{e.latitude&&"string"==typeof e.latitude&&(e.latitude=parseFloat(e.latitude)),e.longitude&&"string"==typeof e.longitude&&(e.longitude=parseFloat(e.longitude)),e.lat||void 0===e.latitude||(e.lat=e.latitude),e.lon||void 0===e.longitude||(e.lon=e.longitude),!e.type&&e.problem_type&&(e.type=e.problem_type),!e.images&&e.Images&&(e.images=e.Images),Array.isArray(e.images)||(e.images=[]),e.images&&e.images.length>0&&console.log(`üñºÔ∏è –ó–∞—è–≤–∫–∞ ${e.id} –∏–º–µ–µ—Ç ${e.images.length} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:`,e.images),console.log(`üìç –ó–∞—è–≤–∫–∞ ${e.id}:`,{latitude:e.latitude,longitude:e.longitude,lat:e.lat,lon:e.lon,status:e.status,problem_type:e.problem_type})}),console.log(`üó∫Ô∏è –í—Å–µ–≥–æ –∑–∞—è–≤–æ–∫ –ø–µ—Ä–µ–¥–∞–Ω–æ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã: ${W.value.length}`),P.value&&F.value&&(W.value.forEach(e=>{const t=L(P.value,F.value,e.latitude||e.lat,e.longitude||e.lon);e.distance=`${t.toFixed(1)} –∫–º –æ—Ç –≤–∞—Å`,e.distanceKm=t}),W.value.sort((e,t)=>(e.distanceKm||999)-(t.distanceKm||999))),console.log(`üó∫Ô∏è –ó–∞—è–≤–∫–∏ –≥–æ—Ç–æ–≤—ã –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ: ${W.value.length}`)}catch(t){console.error("‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞—è–≤–æ–∫:",t),S.value&&console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞—è–≤–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.")}finally{E.value=!1}}function B(e){return{battery:"üîã",fuel:"‚õΩ",tire:"üõû",towing:"üöó",sober_driver:"üöï",road_conflict:"üö®"}[e]||"‚ùì"}async function T(e){try{let t=P.value,a=F.value;if(!t||!a)return void alert("–í–∫–ª—é—á–∏—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –¥–ª—è –æ—Ç–∫–ª–∏–∫–∞");const l=L(t,a,e.latitude,e.longitude),o=Math.ceil(l/40*60);await q.createResponse(e.id,{message:"–Ø —Ä—è–¥–æ–º, –º–æ–≥—É –ø–æ–º–æ—á—å!",latitude:t,longitude:a,eta_minutes:o}),O(),alert("‚úÖ –í–∞—à –æ—Ç–∫–ª–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –∞–≤—Ç–æ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞.")}catch(t){console.error("Error accepting notification:",t),alert("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–∫–ª–∏–∫–∞")}}function D(e){O(),console.log("Request rejected:",e.id)}function G(e){O(),console.log("Notification timeout:",e.id)}function J(e){console.log("–ó–∞—è–≤–∫–∞ –∫–ª–∏–∫–Ω—É—Ç–∞:",e),console.log("–ß–∞—Ç –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –∑–∞—è–≤–∫–∏:",e)}t(async()=>{const e=localStorage.getItem("token");if(e){if(q.setToken(e),H.user)S.value=H.user;else{const e=localStorage.getItem("user");if(e)try{const t=JSON.parse(e);S.value=t,H.user=t}catch(t){console.error("Error parsing user data:",t)}}await z(),function(){const e=localStorage.getItem("token");e&&!j.isConnected.value&&j.connect(e);j.on("helpRequest:created",e=>{var t;const a=e.helpRequest,l=null==(t=a.status)?void 0:t.toLowerCase();if("active"===l||"accepted"===l||"in_progress"===l||"pending_acceptance"===l){if(W.value.unshift(a),P.value&&F.value){const e=L(P.value,F.value,a.latitude,a.longitude);a.distance=`${e.toFixed(1)} –∫–º –æ—Ç –≤–∞—Å`,a.distanceKm=e,e<=5&&A(a),W.value.sort((e,t)=>(e.distanceKm||999)-(t.distanceKm||999))}console.log("–ù–æ–≤—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –ø–æ–ª—É—á–µ–Ω —á–µ—Ä–µ–∑ WebSocket:",a)}else console.log("–ü—Ä–æ–ø—É—â–µ–Ω–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞—è–≤–∫–∞:",a.id,l)}),j.on("helpRequest:accepted",e=>{const t=W.value.findIndex(t=>t.id===e.helpRequestId);-1!==t&&(W.value[t].status="accepted",W.value[t].helper_id=e.helperId,console.log("–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞:",e.helpRequestId))}),j.on("helpRequest:completed",e=>{const t=W.value.findIndex(t=>t.id===e.helpRequestId);-1!==t&&(W.value.splice(t,1),console.log("–ó–∞—è–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –∏ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞:",e.helpRequestId))}),j.on("helpRequest:cancelled",e=>{const t=W.value.findIndex(t=>t.id===e.helpRequestId);-1!==t&&(W.value.splice(t,1),console.log("–ó–∞—è–≤–∫–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ –∏ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞:",e.helpRequestId))})}()}else console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç—É –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞"),await z()}),x(()=>H.user,e=>{e&&(S.value=e)},{immediate:!0});const U=e(!1),Se=e(null),Ne=e(!1),$e=e([]);return console.log("üì¶ MapView module loaded - registering share handler"),window.__mapViewShareHandler=e=>{console.log("üì® __mapViewShareHandler called:",e),async function(e){console.log("üì§ handleShareRequest called:",e),Se.value=e,U.value=!0;try{Ne.value=!0;const e=await q.getFriends(),t=(null==e?void 0:e.data)||e||[];$e.value=t.map(e=>e.friend).filter(Boolean),console.log("‚úÖ Loaded friends:",$e.value.length)}catch(t){console.error("‚ùå Error loading friends:",t),$e.value=[]}finally{Ne.value=!1}}(e)},console.log("‚úÖ window.__mapViewShareHandler registered"),window.__shareRequestHandlers&&(window.__shareRequestHandlers.push(window.__mapViewShareHandler),console.log("‚úÖ Handler added to array")),(e,t)=>{const a=d("router-link");return p(),l("div",Z,[t[16]||(t[16]=s("div",{class:"absolute inset-0 bg-gradient-to-br from-blue-900/5 via-transparent to-purple-900/5 pointer-events-none"},null,-1)),r(C),s("div",ee,[r(I,{ref_key:"mapWidgetRef",ref:K,requests:W.value,"is-authenticated":!!S.value,"show-helpers":!0,onRequestClicked:J},null,8,["requests","is-authenticated"]),S.value?o("",!0):(p(),l("div",te,[s("div",ae,[t[5]||(t[5]=s("h3",{class:"text-lg font-bold text-gray-900 dark:text-white mb-2"}," üó∫ –ö–∞—Ä—Ç–∞ Help Car ",-1)),t[6]||(t[6]=s("p",{class:"text-sm text-gray-600 dark:text-gray-300 mb-3"},[c(" –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ –ø–æ–º–æ—â–∏ –Ω–∞ –∫–∞—Ä—Ç–µ."),s("br"),s("strong",null,"–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É")],-1)),s("div",le,[r(a,{to:"/login",class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg font-bold text-sm hover:bg-blue-700 transition"},{default:i(()=>[...t[3]||(t[3]=[c(" –í–æ–π—Ç–∏ ",-1)])]),_:1}),r(a,{to:"/register",class:"flex-1 px-4 py-2 bg-green-600 text-white rounded-lg font-bold text-sm hover:bg-green-700 transition"},{default:i(()=>[...t[4]||(t[4]=[c(" –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ",-1)])]),_:1})])])])),S.value?(p(),b(a,{key:1,to:"/create-request",class:"fixed bottom-4 right-4 sm:bottom-10 sm:right-10 group z-[1200] pointer-events-auto"},{default:i(()=>[...t[7]||(t[7]=[s("div",{class:"relative"},[s("div",{class:"absolute inset-0 bg-red-500 rounded-2xl sm:rounded-3xl blur-2xl opacity-75 animate-pulse"}),s("div",{class:"relative px-4 py-3 sm:px-10 sm:py-6 bg-gradient-to-r from-red-500 via-red-600 to-red-700 text-white rounded-2xl sm:rounded-3xl shadow-2xl hover:from-red-600 hover:to-red-800 transition-all transform group-hover:scale-110 flex items-center space-x-2 sm:space-x-4"},[s("svg",{class:"w-6 h-6 sm:w-10 sm:h-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M12 4v16m8-8H4"})]),s("div",{class:"hidden sm:block"},[s("div",{class:"text-xl sm:text-3xl font-black tracking-wide"}," –ù–£–ñ–ù–ê –ü–û–ú–û–©–¨! "),s("div",{class:"text-xs sm:text-sm font-semibold opacity-90"}," –°–æ–∑–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å ")]),s("div",{class:"sm:hidden text-sm font-bold"}," SOS ")])],-1)])]),_:1})):o("",!0),S.value&&N.value?(p(),l("div",oe,[s("div",se,[s("div",ne,[t[9]||(t[9]=s("h2",{class:"text-xl font-black mb-1"},"üéØ –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã",-1)),s("div",re,[t[8]||(t[8]=s("div",{class:"w-3 h-3 bg-green-400 rounded-full animate-pulse"},null,-1)),s("p",ie,n(V.value.length)+" —Ä—è–¥–æ–º —Å –≤–∞–º–∏",1)])]),s("button",{onClick:t[0]||(t[0]=e=>N.value=!1),class:"px-3 py-3 text-white hover:bg-white/20 rounded-xl transition",title:"–°–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å"},[...t[10]||(t[10]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),s("div",ce,[E.value?(p(),l("div",de,[(p(),l(h,null,y(3,e=>s("div",{key:e,class:"p-4 border-2 border-gray-200 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 animate-pulse"},[...t[11]||(t[11]=[k('<div class="flex items-start space-x-3"><div class="w-12 h-12 bg-gray-200 dark:bg-slate-600 rounded-xl"></div><div class="flex-1"><div class="h-5 bg-gray-200 dark:bg-slate-600 rounded w-3/4 mb-2"></div><div class="h-4 bg-gray-200 rounded w-full mb-2"></div><div class="h-4 bg-gray-200 rounded w-1/2"></div></div></div>',1)])])),64))])):(p(!0),l(h,{key:1},y(V.value,e=>{return p(),l("div",{key:e.id,class:"group p-4 border-2 border-gray-200 dark:border-slate-600 rounded-xl hover:border-blue-500 hover:shadow-xl transition-all cursor-pointer bg-gradient-to-br from-white to-blue-50/30 dark:from-slate-700 dark:to-slate-800",onClick:t=>function(e){console.log("üéØ –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –∑–∞—è–≤–∫–µ:",{id:e.id,request:e,latitude:e.latitude,lat:e.lat,longitude:e.longitude,lon:e.lon});let t=e.latitude??e.lat,a=e.longitude??e.lon;if("string"==typeof t&&(t=parseFloat(t)),"string"==typeof a&&(a=parseFloat(a)),console.log(`üìç –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: lat=${t}, lon=${a}`),!t||!a||isNaN(t)||isNaN(a))return console.error("‚ùå –ù–µ—Ç –≤–∞–ª–∏–¥–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –¥–ª—è –∑–∞—è–≤–∫–∏:",{id:e.id,latitude:e.latitude,lat:e.lat,longitude:e.longitude,lon:e.lon,parsed:{lat:t,lon:a}}),void J(e.id);if(K.value&&K.value.focusOnRequest)try{const l={...e,latitude:t,longitude:a,lat:t,lon:a};console.log("üì§ –ü–µ—Ä–µ–¥–∞—é –∑–∞—è–≤–∫—É –≤ focusOnRequest:",l),K.value.focusOnRequest(l),console.log("‚úÖ –ö–∞—Ä—Ç–∞ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∞ –∫ –∑–∞—è–≤–∫–µ —á–µ—Ä–µ–∑ OpenStreetMap")}catch(l){console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏—è –∫–∞—Ä—Ç—ã OpenStreetMap:",l)}else console.warn("‚ö†Ô∏è –ö–∞—Ä—Ç–∞ OpenStreetMap –Ω–µ –≥–æ—Ç–æ–≤–∞ –∏–ª–∏ –º–µ—Ç–æ–¥ focusOnRequest –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");window.innerWidth<640&&setTimeout(()=>{J(e.id)},1e3)}(e)},[s("div",me,[s("div",{class:v(["w-12 h-12 rounded-xl flex items-center justify-center shadow-md",(t=e.problem_type,{battery:"bg-gradient-to-br from-orange-400 to-red-600",fuel:"bg-gradient-to-br from-green-400 to-green-600",tire:"bg-gradient-to-br from-purple-400 to-purple-600",towing:"bg-gradient-to-br from-blue-400 to-blue-600",sober_driver:"bg-gradient-to-br from-yellow-400 to-orange-500",road_conflict:"bg-gradient-to-br from-red-500 to-red-700"}[t]||"bg-gradient-to-br from-gray-400 to-gray-600")])},[s("span",ge,n(B(e.problem_type)),1)],2),s("div",ve,[s("div",pe,[s("h3",fe,n(u(g)(e.problem_type)),1),s("div",xe,[s("span",be,n(e.amount)+" ‚ÇΩ",1)])]),s("p",he,n(e.description),1),s("div",ye,[s("span",null,"üìç "+n(e.distance||"–†—è–¥–æ–º"),1),s("span",null,"üïí "+n(u(_)(e.created_at)),1)])])])],8,ue);var t}),128)),E.value||0!==V.value.length?o("",!0):(p(),l("div",we,[...t[12]||(t[12]=[s("div",{class:"w-20 h-20 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-slate-700 dark:to-slate-600 rounded-full flex items-center justify-center mx-auto mb-4"},[s("svg",{class:"w-10 h-10 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})])],-1),s("p",{class:"text-gray-500 text-base font-semibold"},"–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–±–ª–∏–∑–æ—Å—Ç–∏",-1)])]))])])):o("",!0),s("div",ke,[S.value&&!N.value?(p(),l("button",{key:0,class:"bg-blue-600 hover:bg-blue-700 rounded-2xl shadow-2xl px-4 py-3 flex items-center gap-3 transition-all hover:scale-105",title:"–ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å",onClick:t[1]||(t[1]=e=>N.value=!0)},[...t[13]||(t[13]=[s("svg",{class:"w-7 h-7 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"})],-1),s("span",{class:"text-white font-bold hidden sm:block"},"üìã –ó–∞–ø—Ä–æ—Å—ã",-1)])])):o("",!0)])]),u($)?(p(),b(Q,{key:0,request:u($),onAccept:T,onReject:D,onTimeout:G},null,8,["request"])):o("",!0),U.value?(p(),l("div",_e,[s("div",qe,[t[15]||(t[15]=s("h3",{class:"text-lg font-bold mb-4 text-gray-900 dark:text-white"},"üë• –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å –¥—Ä—É–≥–æ–º",-1)),Ne.value?(p(),l("div",Re,[...t[14]||(t[14]=[s("div",{class:"animate-spin w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full mx-auto"},null,-1),s("p",{class:"mt-2 text-gray-500"},"–ó–∞–≥—Ä—É–∑–∫–∞...",-1)])])):0===$e.value.length?(p(),l("div",je," –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π üò¢ ")):(p(),l("div",Ce,[(p(!0),l(h,null,y($e.value,e=>{var t;return p(),l("button",{key:e.id,onClick:t=>async function(e){if(Se.value)try{await q.client.post(`/help-requests/${Se.value}/share`,{friendIds:[e.id],message:"–°–º–æ—Ç—Ä–∏ —ç—Ç—É –∑–∞—è–≤–∫—É!"}),U.value=!1,alert(`‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ ${e.full_name}!`)}catch(t){console.error("‚ùå Error sharing:",t),alert("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ")}}(e),class:"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gray-100 dark:hover:bg-slate-700 transition"},[s("div",Ie,n((null==(t=e.full_name)?void 0:t[0])||"?"),1),s("span",He,n(e.full_name),1)],8,Me)}),128))])),s("button",{onClick:t[2]||(t[2]=e=>U.value=!1),class:"mt-4 w-full py-2 bg-gray-200 dark:bg-slate-700 rounded-lg text-gray-700 dark:text-gray-300 font-medium"}," –û—Ç–º–µ–Ω–∞ ")])])):o("",!0)])}}};export{Se as default};
