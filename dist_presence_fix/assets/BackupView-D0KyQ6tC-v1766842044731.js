import{r as e,o as t,h as a,l as r,y as o,t as s,m as i,F as n,i as l,k as c}from"./vendor-mW7CftnD-v1766842044731.js";import{b as d}from"./index-B47n4XC8-v1766842044731.js";import"./utils-D_mSMGs1-v1766842044731.js";import"./maps-CCq-KL9W-v1766842044731.js";const m={class:"min-h-screen bg-gray-100"},p={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},u={class:"bg-white rounded-lg shadow p-6 mb-6"},h={class:"flex items-center justify-between mb-4"},g=["disabled"],x={class:"bg-white rounded-lg shadow overflow-hidden"},w={class:"min-w-full divide-y divide-gray-200"},v={class:"bg-white divide-y divide-gray-200"},y={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},f={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},b={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},k={class:"px-6 py-4 whitespace-nowrap text-sm"},j=["onClick"],T=["onClick"],C={key:0,class:"text-center py-12 text-gray-500"},S={__name:"BackupView",setup(S){const I=o(),R=e(!1),$=e([]),B=()=>localStorage.getItem("adminToken"),E=()=>I.push("/"),P=()=>I.push("/admin/dashboard"),U=async()=>{try{const e=B();if(!e)return alert("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞."),void I.push("/admin/login");const t=await fetch("/api/v1/admin/backup/list",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok){if(401===t.status)return localStorage.removeItem("adminToken"),localStorage.removeItem("admin"),void I.push("/admin/login");const e=await t.json().catch(()=>({}));throw new Error(e.error||e.message||`HTTP ${t.status}`)}const a=await t.json();if(!a.success)throw new Error(a.error||a.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—ç–∫–∞–ø–æ–≤");$.value=a.backups||[]}catch(e){d.error("Load backups error:",e),alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±—ç–∫–∞–ø–æ–≤: "+(e.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}},L=async()=>{R.value=!0;try{const e=B();if(!e)return alert("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞."),void I.push("/admin/login");const t=await fetch("/api/v1/admin/backup/create",{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok){if(401===t.status)return localStorage.removeItem("adminToken"),localStorage.removeItem("admin"),void I.push("/admin/login");const e=await t.json().catch(()=>({}));throw new Error(e.error||e.message||`HTTP ${t.status}`)}const a=await t.json();if(!a.success)throw new Error(a.error||a.message||"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞");alert("‚úÖ –ë—ç–∫–∞–ø —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!"),await U()}catch(e){d.error("Create backup error:",e),alert("‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±—ç–∫–∞–ø–∞: "+(e.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}finally{R.value=!1}};return t(()=>{U()}),(e,t)=>(c(),a("div",m,[r("nav",{class:"bg-white shadow-lg"},[r("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},[r("div",{class:"flex justify-between h-16"},[r("div",{class:"flex items-center space-x-4"},[r("button",{class:"text-gray-600 hover:text-gray-800 font-medium",onClick:E}," üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é "),r("button",{class:"text-blue-600 hover:text-blue-800 font-medium",onClick:P}," ‚Üê –î–∞—à–±–æ—Ä–¥ "),t[0]||(t[0]=r("h1",{class:"text-xl font-bold text-gray-900"}," üíæ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë—ç–∫–∞–ø–∞–º–∏ ",-1))])])])]),r("div",p,[r("div",u,[r("div",h,[t[1]||(t[1]=r("h2",{class:"text-xl font-bold"}," üíæ –ë—ç–∫–∞–ø—ã –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö ",-1)),r("button",{disabled:R.value,class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",onClick:L},s(R.value?"‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ...":"üì¶ –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø"),9,g)]),r("button",{class:"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",onClick:U}," üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ ")]),r("div",x,[r("table",w,[t[2]||(t[2]=r("thead",{class:"bg-gray-50"},[r("tr",null,[r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," –ò–º—è —Ñ–∞–π–ª–∞ "),r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," –†–∞–∑–º–µ—Ä "),r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," –°–æ–∑–¥–∞–Ω "),r("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," –î–µ–π—Å—Ç–≤–∏—è ")])],-1)),r("tbody",v,[(c(!0),a(n,null,l($.value,e=>(c(),a("tr",{key:e.name||e.file},[r("td",y,s(e.name||e.file||"-"),1),r("td",f,s(e.sizeMB||e.size||"-")+" MB ",1),r("td",b,s(e.created?new Date(e.created).toLocaleString("ru-RU"):e.timestamp?new Date(e.timestamp).toLocaleString("ru-RU"):"-"),1),r("td",k,[r("button",{class:"text-green-600 hover:text-green-800 mr-4",onClick:t=>(async e=>{if(confirm("–í–ù–ò–ú–ê–ù–ò–ï! –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±—ç–∫–∞–ø–∞ –ø–µ—Ä–µ–∑–∞–ø–∏—à–µ—Ç —Ç–µ–∫—É—â—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?"))try{const t=B();if(!t)return alert("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞."),void I.push("/admin/login");const a=await fetch("/api/v1/admin/backup/restore",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({backupFile:e})});if(!a.ok){if(401===a.status)return localStorage.removeItem("adminToken"),localStorage.removeItem("admin"),void I.push("/admin/login");const e=await a.json().catch(()=>({}));throw new Error(e.error||e.message||`HTTP ${a.status}`)}const r=await a.json();if(!r.success)throw new Error(r.error||r.message||"–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è");alert("‚úÖ –ë—ç–∫–∞–ø —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"),await U()}catch(t){d.error("Restore backup error:",t),alert("‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –±—ç–∫–∞–ø–∞: "+(t.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}})(e.path||e.file)}," üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ",8,j),r("button",{class:"text-blue-600 hover:text-blue-800",onClick:t=>(async e=>{try{const a=B();if(!a)return alert("–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"),void I.push("/admin/login");const r=e.split("/").pop()||e.split("\\").pop()||"backup.sql";let o="";try{if(!e||"string"!=typeof e)return console.error("Invalid backupPath:",e),void alert("–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏");o=encodeURIComponent(e)}catch(t){return console.error("URI encoding error:",t,"backupPath:",e),void alert("–û—à–∏–±–∫–∞ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É")}const s=`/api/v1/admin/backup/download?file=${o}`,i=await fetch(s,{headers:{Authorization:`Bearer ${a}`}});if(!i.ok){if(401===i.status)return localStorage.removeItem("adminToken"),localStorage.removeItem("admin"),void I.push("/admin/login");const e=await i.json().catch(()=>({}));throw new Error(e.error||e.message||`HTTP ${i.status}`)}const n=await i.blob(),l=window.URL.createObjectURL(n),c=document.createElement("a");c.href=l,c.download=r,c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l),d.info("Backup downloaded",{file:e}),alert("‚úÖ –ë—ç–∫–∞–ø —É—Å–ø–µ—à–Ω–æ —Å–∫–∞—á–∞–Ω")}catch(t){d.error("Download backup error:",t),alert("–û—à–∏–±–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –±—ç–∫–∞–ø–∞: "+(t.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}})(e.path||e.file||e.name)}," ‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å ",8,T)])]))),128))])]),0===$.value.length?(c(),a("div",C," –ù–µ—Ç –±—ç–∫–∞–ø–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –±—ç–∫–∞–ø. ")):i("",!0)])])]))}};export{S as default};
