import{r as e,w as t,h as a,m as l,k as r,l as s,v as n,t as i,F as o,i as u,n as d,I as c,J as v,p as g,c as p,s as y,o as f,a as h,H as b,y as x,e as m,g as k,G as w,K as _,x as C,f as j}from"./vendor-mW7CftnD-v1766842044731.js";import{a as I,s as S,_ as M,u as z,w as A,l as R}from"./index-B47n4XC8-v1766842044731.js";import{P as q}from"./PremiumBadge-D73oRhRn-v1766842044731.js";import{L as $}from"./LinkPreview-CwdBsWOq-v1766842044731.js";import"./utils-D_mSMGs1-v1766842044731.js";import"./maps-CCq-KL9W-v1766842044731.js";const D={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full p-6 transform transition-all"},B={class:"text-center mb-6"},T={class:"text-sm text-gray-600 dark:text-gray-300"},L={class:"font-semibold"},U={class:"flex justify-center gap-2 mb-6"},F=["onClick","onMouseenter"],H={class:"mb-6"},O={class:"mb-6"},V={class:"flex flex-wrap gap-2"},E=["onClick"],P={class:"flex gap-3"},W=["disabled"],G={key:0,class:"w-5 h-5 animate-spin",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},N={__name:"RatingModal",props:{isOpen:{type:Boolean,default:!1},helpRequestId:{type:String,required:!0},helperId:{type:String,required:!0},helperName:{type:String,default:"–ü–æ–º–æ—â–Ω–∏–∫"}},emits:["close","rated"],setup(p,{emit:y}){const f=p,h=y,b=e(0),x=e(0),m=e(""),k=e([]),w=e(!1),_=["üëç –ë—ã—Å—Ç—Ä–æ","üí¨ –í–µ–∂–ª–∏–≤–æ","üîß –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ","üí∞ –î–æ—Å—Ç—É–ø–Ω–æ","‚≠ê –†–µ–∫–æ–º–µ–Ω–¥—É—é"];t(()=>f.isOpen,e=>{e&&(b.value=0,x.value=0,m.value="",k.value=[])});const C=async()=>{var e,t,a,l;if(0!==b.value){w.value=!0;try{const a=await I.createRating(f.helpRequestId,{rating:b.value,comment:k.value.length>0?m.value?`${m.value} | ${k.value.join(", ")}`:k.value.join(", "):m.value||null});if(!(null==(e=a.data)?void 0:e.success))throw new Error((null==(t=a.data)?void 0:t.message)||"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ü–µ–Ω–∫–∏");S.playSuccess(),h("rated",{rating:b.value,comment:m.value,tags:k.value}),j()}catch(r){console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞:",r),alert((null==(l=null==(a=r.response)?void 0:a.data)?void 0:l.message)||r.message||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")}finally{w.value=!1}}else alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ü–µ–Ω–∫—É")},j=()=>{h("close")};return(e,t)=>p.isOpen?(r(),a("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",onClick:g(j,["self"])},[s("div",D,[s("div",B,[t[4]||(t[4]=s("div",{class:"w-16 h-16 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center"},[s("svg",{class:"w-8 h-8 text-white",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})])],-1)),t[5]||(t[5]=s("h2",{class:"text-2xl font-black text-gray-900 dark:text-white mb-2"}," –û—Ü–µ–Ω–∏—Ç–µ –ø–æ–º–æ—â—å ",-1)),s("p",T,[t[2]||(t[2]=n(" –ö–∞–∫ –≤–∞–º –ø–æ–º–æ–≥ ",-1)),s("span",L,i(p.helperName),1),t[3]||(t[3]=n("? ",-1))])]),s("div",U,[(r(),a(o,null,u(5,e=>s("button",{key:e,class:"transform transition-all hover:scale-125 focus:outline-none",onClick:t=>b.value=e,onMouseenter:t=>x.value=e,onMouseleave:t[0]||(t[0]=e=>x.value=0)},[(r(),a("svg",{class:d(["w-12 h-12",e<=(x.value||b.value)?"text-yellow-400":"text-gray-300 dark:text-gray-600"]),fill:"currentColor",viewBox:"0 0 20 20"},[...t[6]||(t[6]=[s("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"},null,-1)])],2))],40,F)),64))]),s("div",H,[t[7]||(t[7]=s("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2"}," –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) ",-1)),c(s("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),rows:"4",placeholder:"–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è–º–∏ –æ –ø–æ–º–æ—â–∏...",class:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-xl focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white resize-none"},null,512),[[v,m.value]])]),s("div",O,[t[8]||(t[8]=s("label",{class:"block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3"}," –û—Ç–º–µ—Ç–∫–∏ ",-1)),s("div",V,[(r(),a(o,null,u(_,e=>s("button",{key:e,class:d(["px-3 py-1.5 text-sm rounded-full border transition",k.value.includes(e)?"bg-yellow-100 border-yellow-400 text-yellow-700":"bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"]),onClick:t=>(e=>{const t=k.value.indexOf(e);-1===t?k.value.push(e):k.value.splice(t,1)})(e)},i(e),11,E)),64))])]),s("div",P,[s("button",{class:"flex-1 px-4 py-3 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-300 font-semibold rounded-xl transition",onClick:j}," –û—Ç–º–µ–Ω–∞ "),s("button",{disabled:0===b.value||w.value,class:"flex-1 px-4 py-3 bg-gradient-to-r from-yellow-400 to-orange-500 hover:from-yellow-500 hover:to-orange-600 text-white font-bold rounded-xl transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",onClick:C},[w.value?(r(),a("svg",G,[...t[9]||(t[9]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):l("",!0),s("span",null,i(w.value?"–û—Ç–ø—Ä–∞–≤–∫–∞...":"–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É"),1)],8,W)])])])):l("",!0)}},K={class:"h-screen flex flex-col overflow-hidden chat-container"},J={class:"bg-white/95 dark:bg-gray-800/95 backdrop-blur-lg border-b dark:border-gray-700 px-4 py-3 flex-shrink-0 shadow-lg relative z-20"},Q={class:"flex items-center justify-between"},X={class:"flex items-center gap-3"},Y={class:"relative"},Z={key:0,class:"w-10 h-10 rounded-full overflow-hidden ring-2 ring-transparent group-hover:ring-blue-400 transition"},ee=["src"],te={key:1,class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white font-bold ring-2 ring-transparent group-hover:ring-blue-400 transition"},ae={key:2,class:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 border-2 border-white dark:border-gray-800 rounded-full animate-pulse"},le={key:3,class:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-yellow-500 border-2 border-white dark:border-gray-800 rounded-full"},re={class:"flex items-center gap-2"},se={class:"font-semibold text-gray-900 dark:text-white text-sm group-hover:text-blue-600 dark:group-hover:text-blue-400 transition"},ne={key:0,class:"text-xs text-blue-500 animate-pulse"},ie={key:1,class:"text-xs text-green-500 flex items-center gap-1"},oe={key:2,class:"text-xs text-gray-500"},ue={class:"flex items-center gap-1"},de=["disabled"],ce={key:1,class:"px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs rounded-full"},ve={key:2,class:"px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs rounded-full"},ge={key:0,class:"absolute right-4 top-16 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border dark:border-gray-700 py-2 z-50 min-w-[180px]"},pe={key:0,class:"bg-gradient-to-r from-orange-50 to-yellow-50 dark:from-orange-900/20 dark:to-yellow-900/20 border-b dark:border-gray-700 px-4 py-2 flex-shrink-0 relative z-20"},ye={class:"flex items-center justify-between gap-3"},fe={class:"flex-1 min-w-0"},he={class:"flex items-center gap-2 text-sm"},be={class:"font-semibold text-orange-700 dark:text-orange-400"},xe={key:0,class:"text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5"},me={class:"flex items-center gap-2 flex-shrink-0"},ke=["disabled"],we={key:0,class:"w-3 h-3 border-2 border-white border-t-transparent rounded-full animate-spin"},_e={key:1},Ce={key:0,class:"text-center py-2"},je={key:0,class:"flex items-center justify-center my-4"},Ie={class:"px-3 py-1 bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400 text-xs rounded-full"},Se={key:0,class:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-white text-xs font-bold mr-2 flex-shrink-0 self-end"},Me={key:1,class:"w-8 mr-2"},ze={class:"max-w-[80%] sm:max-w-[70%]"},Ae={key:0,class:"mb-2"},Re=["src","alt","onClick"],qe={key:1,class:"mb-2"},$e=["onClick"],De={key:0,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},Be={key:1,class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},Te={class:"flex-1"},Le={class:"flex items-center gap-2"},Ue=["id"],Fe=["src","onEnded","onTimeupdate"],He={key:2,class:"text-sm sm:text-base whitespace-pre-wrap"},Oe=["onClick"],Ve=["onClick"],Ee={key:3,class:"flex gap-1 mt-1"},Pe={class:"text-gray-400"},We={key:0,class:"flex justify-start"},Ge={class:"bg-white/95 dark:bg-gray-800/95 backdrop-blur-lg border-t dark:border-gray-700 p-3 flex-shrink-0 relative z-20"},Ne={key:0,class:"mb-3 relative inline-block"},Ke=["src"],Je={key:0,class:"absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center"},Qe={key:1,class:"mb-3 flex items-center gap-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg"},Xe={class:"text-red-600 dark:text-red-400 font-medium"},Ye={key:2,class:"flex items-end gap-2"},Ze=["disabled"],et={class:"flex-1 relative"},tt=["onKeydown"],at={class:"relative"},lt={key:0,class:"absolute bottom-12 right-0 bg-white dark:bg-gray-800 rounded-xl shadow-xl border dark:border-gray-700 p-3 z-50 w-72"},rt={class:"grid grid-cols-8 gap-1 max-h-48 overflow-y-auto"},st=["onClick"],nt=["disabled"],it={key:1,class:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-20"},ot={class:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md mx-4 overflow-hidden"},ut={class:"p-4 border-b dark:border-gray-700 flex items-center gap-3"},dt={class:"max-h-96 overflow-y-auto p-4"},ct={key:0,class:"text-center text-gray-500"},vt={key:1,class:"text-center text-gray-500"},gt={class:"text-sm text-gray-900 dark:text-white"},pt={class:"text-xs text-gray-500"},yt={key:2,class:"fixed inset-0 bg-black/90 z-50 p-4"},ft={class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2"},ht=["src","onClick"],bt=["src"],xt=M({__name:"UnifiedChatView",props:{chatType:{type:String,default:"auto"}},setup(S){const M=S,D=y(),B=x(),T=z(),L=e([]),U=e(""),F=e(!0),H=e(!1),O=e(!1),V=e(null),E=e(null),P=e(null),W=e(null),G=e(!1),xt=e(!1),mt=e(!1),kt=e(!1),wt=e(!1),_t=e(null),Ct=e(!1),jt=e(!1),It=e(null),St=e(null),Mt=e(null),zt=e(!1),At=e(null),Rt=e(!1),qt=e(!1),$t=e(0),Dt=e(null),Bt=e([]);let Tt=null;const Lt=e(null),Ut={},Ft=e(!1),Ht=e(""),Ot=e([]),Vt=e(!1),Et=e(!1),Pt=e([]),Wt=["üòÄ","üòÉ","üòÑ","üòÅ","üòÜ","üòÖ","ü§£","üòÇ","üôÇ","üòâ","üòä","üòá","ü•∞","üòç","ü§©","üòò","üòó","üòö","üòô","ü•≤","ü§ó","ü§î","ü§≠","ü§´","üëç","üëé","üëå","‚úåÔ∏è","ü§û","ü§ô","üëä","‚ù§Ô∏è","üß°","üíõ","üíö","üíô","üíú","üñ§","üî•","‚≠ê","üéâ","üöó","üöï","üöô","üöå","üõ†Ô∏è","üîß","‚õΩ","üì±","üíª","üè†","üìç","‚úÖ","‚ùå"];let Gt=null,Nt=null;const Kt=e=>{var t,a;const l=null==(t=null==e?void 0:e.friend)?void 0:t.id;l&&(null==(a=W.value)?void 0:a.id)&&String(l)===String(W.value.id)&&(W.value.is_online=!0,W.value.last_seen=(new Date).toISOString())},Jt=e=>{var t,a;const l=(null==e?void 0:e.friendId)||(null==(t=null==e?void 0:e.friend)?void 0:t.id);l&&(null==(a=W.value)?void 0:a.id)&&String(l)===String(W.value.id)&&(W.value.is_online=!1,W.value.last_seen=(new Date).toISOString())},Qt=p(()=>"auto"!==M.chatType?"request"===M.chatType:!!D.params.requestId),Xt=p(()=>{var e;if(!_t.value)return!1;const t=_t.value,a=String(t.user_id)===String(null==(e=T.user)?void 0:e.id),l=["accepted","in_progress"].includes(t.status);return a&&l}),Yt=p(()=>!!_t.value&&("completed"===_t.value.status&&!_t.value.userHasRated)),Zt=p(()=>{if(!_t.value)return"";return{flat_tire:"üõû –ü—Ä–æ–±–∏–ª–æ –∫–æ–ª–µ—Å–æ",battery:"üîã –°–µ–ª –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä",fuel:"‚õΩ –ó–∞–∫–æ–Ω—á–∏–ª–æ—Å—å —Ç–æ–ø–ª–∏–≤–æ",tow:"üöõ –ù—É–∂–Ω–∞ —ç–≤–∞–∫—É–∞—Ü–∏—è",engine:"üîß –ù–µ –∑–∞–≤–æ–¥–∏—Ç—Å—è",keys:"üîë –ó–∞–∫—Ä—ã–ª—Å—è –≤ –º–∞—à–∏–Ω–µ",other:"‚ùì –î—Ä—É–≥–æ–µ"}[_t.value.problem_type]||_t.value.problem_type_name||"üÜò –ó–∞—è–≤–∫–∞"});function ea(){B.back()}async function ta(){var e,t;try{const t=await I.client.get(`/chats/${V.value}/direct`);t.success&&(W.value=t.otherUser,L.value=(t.messages||[]).map(e=>{var t;return{...e,is_mine:String(e.sender_id||"")===String((null==(t=T.user)?void 0:t.id)||""),createdAt:e.createdAt||e.created_at}}),await b(),ha(!0),(null==(e=W.value)?void 0:e.id)&&await ra(W.value.id))}catch(a){console.error("Failed to load direct chat:",a),404===(null==(t=a.response)?void 0:t.status)&&B.push("/my-chats")}finally{F.value=!1}}async function aa(e){var t;try{const a=await I.getChatByRequest(e),l=(null==a?void 0:a.data)||a;if(null==l?void 0:l.id){if(V.value=l.id,l.messages&&Array.isArray(l.messages)&&(L.value=l.messages.map(e=>{var t;return{...e,is_mine:String(e.sender_id||"")===String((null==(t=T.user)?void 0:t.id)||""),createdAt:e.createdAt||e.created_at}})),l.helpRequest&&(_t.value=l.helpRequest),l.participants){const e=l.participants.find(e=>{var t;return e.id!==(null==(t=T.user)?void 0:t.id)});e&&(W.value=e,await ra(e.id))}else if(l.helpRequest){const e=l.helpRequest;e.user_id===(null==(t=T.user)?void 0:t.id)&&e.helper?(W.value=e.helper,await ra(e.helper.id)):e.user&&(W.value=e.user,await ra(e.user.id))}await b(),ha(!0)}}catch(a){console.error("Failed to load chat by request:",a)}}async function la(){if(V.value)try{F.value=!0;const t=await I.getChatMessages(V.value,{limit:100,offset:0});let a=[];if(Array.isArray(null==t?void 0:t.data)?a=t.data:Array.isArray(null==t?void 0:t.messages)?a=t.messages:Array.isArray(t)&&(a=t),L.value=a.map(e=>{var t;return{...e,is_mine:String(e.sender_id||"")===String((null==(t=T.user)?void 0:t.id)||""),createdAt:e.createdAt||e.created_at}}),!W.value&&(null==t?void 0:t.chat)){const e=t.chat;if(e.participants){const t=e.participants.find(e=>{var t;return e.id!==(null==(t=T.user)?void 0:t.id)});t&&(W.value=t,await ra(t.id))}}await b(),ha(!0);try{await I.markMessagesAsRead(V.value)}catch(e){console.warn("Failed to mark messages as read:",e)}}catch(t){console.error("Failed to load messages:",t)}finally{F.value=!1}}async function ra(e){try{const t=await I.getFriends(),a=((null==t?void 0:t.data)||t||[]).some(t=>{var a;return(null==(a=t.friend)?void 0:a.id)===e});W.value&&(W.value.isFriend=a)}catch(t){console.error("Failed to check friendship:",t)}}async function sa(){var e,t,a,l;if(null==(e=W.value)?void 0:e.id)try{G.value=!0;const e=await I.sendFriendRequest(W.value.id);e.success&&(xt.value=!0,(null==(t=e.message)?void 0:t.includes("—Ç–µ–ø–µ—Ä—å –¥—Ä—É–∑—å—è"))&&(W.value.isFriend=!0,xt.value=!1))}catch(r){alert((null==(l=null==(a=r.response)?void 0:a.data)?void 0:l.message)||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É")}finally{G.value=!1}}function na(e="audio"){var t;const a=null==(t=W.value)?void 0:t.id;a?"function"==typeof window.__initiateCall?window.__initiateCall(a,e):alert("–§—É–Ω–∫—Ü–∏—è –∑–≤–æ–Ω–∫–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"):alert("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫")}async function ia(){var e,t,a;if((null==(e=_t.value)?void 0:e.id)&&confirm("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–º–æ—â–∏?"))try{jt.value=!0,await I.completeHelpRequest(_t.value.id),_t.value.status="completed",alert("–ó–∞—è–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ü–µ–Ω–∏—Ç–µ –ø–æ–º–æ—â–Ω–∏–∫–∞."),Ct.value=!0}catch(l){console.error("Failed to complete request:",l),alert((null==(a=null==(t=l.response)?void 0:t.data)?void 0:a.message)||"–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞—è–≤–∫—É")}finally{jt.value=!1}}function oa(){_t.value&&(_t.value.userHasRated=!0),Ct.value=!1}function ua(){var e;null==(e=It.value)||e.click()}function da(e){var t;const a=null==(t=e.target.files)?void 0:t[0];if(!a)return;["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(a.type)?a.size>10485760?alert("–ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä: 10 –ú–ë"):(St.value=a,Mt.value=URL.createObjectURL(a)):alert("–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ: JPEG, PNG, WebP, GIF")}function ca(e=!0){e&&Mt.value&&URL.revokeObjectURL(Mt.value),St.value=null,Mt.value=null,It.value&&(It.value.value="")}function va(e){At.value=e}async function ga(){if(!U.value.trim()&&!St.value||!V.value||O.value)return;const e=U.value.trim(),t=St.value,a=Mt.value;U.value="",ca(!1);const l="temp-"+Date.now();L.value.push({id:l,content:e,is_mine:!0,createdAt:(new Date).toISOString(),is_sending:!0,image_url:a}),await b(),ha();try{O.value=!0;let r=null,s=null;if(t){zt.value=!0;try{const e=await I.uploadChatImage(t);e.success&&(r=e.image_url,s=e.thumbnail_url)}finally{zt.value=!1}}const n=await I.client.post(`/chats/${V.value}/messages`,{content:e||"",image_url:r,thumbnail_url:s});if((null==n?void 0:n.success)&&(null==n?void 0:n.data)){const e=L.value.findIndex(e=>e.id===l);-1!==e&&(L.value[e]={...n.data,is_mine:!0,createdAt:n.data.createdAt||n.data.created_at}),a&&URL.revokeObjectURL(a)}}catch(r){const e=L.value.findIndex(e=>e.id===l);-1!==e&&(L.value[e].is_failed=!0,L.value[e].is_sending=!1),a&&URL.revokeObjectURL(a)}finally{O.value=!1}}function pa(){Gt&&V.value&&Gt.emit("chat:typing",{chatId:V.value})}function ya(){const e=localStorage.getItem("token");if(!e)return;const t="https:"===window.location.protocol?`wss://${window.location.host}`:`ws://${window.location.host}`;Gt=R(t.replace(/^ws/,"http"),{auth:{token:e}}),Gt.emit("chat:join",{chatId:V.value}),Gt.on("chat:newMessage",e=>{var t;if(e.chatId===V.value){if(L.value.some(t=>{var a,l;return t.id===e.id||(null==(l=null==(a=t.id)?void 0:a.startsWith)?void 0:l.call(a,"temp-"))&&t.content===e.content})){const t=L.value.findIndex(t=>{var a,l;return(null==(l=null==(a=t.id)?void 0:a.startsWith)?void 0:l.call(a,"temp-"))&&t.content===e.content});return void(-1!==t&&(L.value[t]={...L.value[t],id:e.id,is_sending:!1}))}e.senderId!==(null==(t=T.user)?void 0:t.id)&&(L.value.push({id:e.id,content:e.content,sender_id:e.senderId,is_mine:!1,createdAt:e.createdAt||(new Date).toISOString()}),b(()=>ha()),mt.value=!1)}}),Gt.on("chat:typing",e=>{var t;e.chatId===V.value&&e.userId!==(null==(t=T.user)?void 0:t.id)&&(mt.value=!0,Nt&&clearTimeout(Nt),Nt=setTimeout(()=>{mt.value=!1},3e3))}),Gt.on("chat:read",e=>{e.chatId===V.value&&L.value.forEach(e=>{e.is_mine&&(e.is_read=!0)})})}function fa(){if(!E.value)return;const{scrollTop:e,scrollHeight:t,clientHeight:a}=E.value;wt.value=t-e-a>200}function ha(e=!1){E.value&&setTimeout(()=>{E.value&&(E.value.scrollTop=E.value.scrollHeight,wt.value=!1)},e?100:50)}function ba(e,t){e.reactions||(e.reactions=[]);const a=e.reactions.find(e=>e.emoji===t);a?a.count++:e.reactions.push({emoji:t,count:1})}async function xa(){try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});Dt.value=new MediaRecorder(e,{mimeType:"audio/webm"}),Bt.value=[],Dt.value.ondataavailable=e=>Bt.value.push(e.data),Dt.value.onstop=async()=>{const t=new Blob(Bt.value,{type:"audio/webm"});await async function(e){if(!V.value||0===Bt.value.length)return;try{O.value=!0;const t=await I.uploadVoiceMessage(e,$t.value);if(t.success){const e=await I.client.post(`/chats/${V.value}/messages`,{content:"",voice_url:t.voice_url,voice_duration:t.duration});(null==e?void 0:e.success)&&(null==e?void 0:e.data)&&(L.value.push({...e.data,is_mine:!0,createdAt:e.data.createdAt||e.data.created_at}),await b(),ha())}}catch(t){console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ:",t)}finally{O.value=!1,$t.value=0}}(t),e.getTracks().forEach(e=>e.stop())},Dt.value.start(),qt.value=!0,$t.value=0,Tt=setInterval(()=>$t.value++,1e3)}catch(e){alert("–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É")}}function ma(){Dt.value&&qt.value&&(Dt.value.stop(),qt.value=!1,clearInterval(Tt))}function ka(){Dt.value&&qt.value&&(Dt.value.stop(),qt.value=!1,clearInterval(Tt),Bt.value=[])}function wa(e){const t=Ut[e];t&&(Object.entries(Ut).forEach(([t,a])=>{t===e||a.paused||(a.pause(),a.currentTime=0)}),Lt.value===e?(t.pause(),Lt.value=null):(t.play(),Lt.value=e))}async function _a(){if(!Ht.value||Ht.value.length<2)Ot.value=[];else try{Vt.value=!0;const e=await I.searchMessages(V.value,Ht.value);Ot.value=e.data||[]}catch(e){console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞:",e)}finally{Vt.value=!1}}function Ca(){Ft.value=!Ft.value,Ft.value||(Ht.value="",Ot.value=[])}function ja(e){return e?e.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?"}function Ia(e){return e?new Date(e).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}):""}function Sa(e){if(!e)return"–±—ã–ª(–∞) –¥–∞–≤–Ω–æ";const t=Math.floor((new Date-new Date(e))/6e4);return t<5?"–æ–Ω–ª–∞–π–Ω":t<60?`–±—ã–ª(–∞) ${t} –º–∏–Ω –Ω–∞–∑–∞–¥`:t<1440?`–±—ã–ª(–∞) ${Math.floor(t/60)} —á –Ω–∞–∑–∞–¥`:`–±—ã–ª(–∞) ${Math.floor(t/1440)} –¥–Ω –Ω–∞–∑–∞–¥`}function Ma(e){if(!e)return"";const t=new Date(e),a=new Date,l=new Date(a);return l.setDate(l.getDate()-1),t.toDateString()===a.toDateString()?"–°–µ–≥–æ–¥–Ω—è":t.toDateString()===l.toDateString()?"–í—á–µ—Ä–∞":t.toLocaleDateString("ru-RU",{day:"numeric",month:"long"})}function za(e,t){return!t||t.is_mine||t.sender_id!==e.sender_id}function Aa(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("blob:"))return e;return"https://help-car.online/api/v1".replace("/api/v1","")+e}function Ra(e){e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="150" viewBox="0 0 200 150"><rect fill="%23e5e7eb" width="200" height="150"/><text x="100" y="75" text-anchor="middle" fill="%239ca3af" font-size="14">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</text></svg>',e.target.style.opacity="0.7"}function qa(e){console.warn("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞—É–¥–∏–æ:",e.target.src);const t=e.target.parentElement;t&&(t.innerHTML='<span class="text-xs text-red-500">‚úñ –ê—É–¥–∏–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</span>')}function $a(e){if(!e)return[];const t=e.match(/https?:\/\/[^\s<>"{}|\\^`[\]]+/gi)||[];return[...new Set(t.map(e=>e.replace(/[.,;:!?)]+$/,"")))].slice(0,2)}return f(async()=>{var e;if(T.user||await T.checkAuth(),D.params.chatId)V.value=D.params.chatId,await ta();else{const e=D.params.requestId||D.params.id;e&&await aa(e)}V.value&&(await la(),ya()),A.on("friend_online",Kt),A.on("friend_offline",Jt),null==(e=P.value)||e.focus()}),h(()=>{Gt&&Gt.disconnect(),A.off("friend_online"),A.off("friend_offline"),Nt&&clearTimeout(Nt),Tt&&clearInterval(Tt)}),t(U,()=>{b(()=>{P.value&&(P.value.style.height="auto",P.value.style.height=Math.min(P.value.scrollHeight,128)+"px")})}),t(()=>D.params,async(e,t)=>{e.requestId===(null==t?void 0:t.requestId)&&e.chatId===(null==t?void 0:t.chatId)||(L.value=[],V.value=null,W.value=null,F.value=!0,Gt&&(Gt.disconnect(),Gt=null),e.chatId?(V.value=e.chatId,await ta()):e.requestId&&await aa(e.requestId),V.value&&(await la(),ya()))},{deep:!0}),(e,t)=>{var p;const y=C("router-link");return r(),a("div",K,[t[38]||(t[38]=s("div",{class:"chat-bg-pattern"},null,-1)),s("div",J,[s("div",Q,[s("div",X,[s("button",{class:"p-2 -ml-2 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition",onClick:ea},[...t[18]||(t[18]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),W.value?(r(),m(y,{key:0,to:`/user/${W.value.id}`,class:"flex items-center gap-3 group"},{default:k(()=>{return[s("div",Y,[W.value.avatar_url?(r(),a("div",Z,[s("img",{src:(e=W.value.avatar_url,Aa(e)),class:"w-full h-full object-cover"},null,8,ee)])):(r(),a("div",te,i(ja(W.value.full_name)),1)),W.value.is_online?(r(),a("span",ae)):W.value.is_available_to_help?(r(),a("span",le)):l("",!0)]),s("div",null,[s("div",re,[s("p",se,i(W.value.full_name),1),j(q,{status:W.value.premium_status,size:"xs"},null,8,["status"])]),mt.value?(r(),a("p",ne,"–ø–µ—á–∞—Ç–∞–µ—Ç...")):W.value.is_online?(r(),a("p",ie,[...t[19]||(t[19]=[s("span",{class:"w-1.5 h-1.5 bg-green-500 rounded-full"},null,-1),n(" –æ–Ω–ª–∞–π–Ω ",-1)])])):(r(),a("p",oe,i(Sa(W.value.last_seen||W.value.last_login)),1))])];var e}),_:1},8,["to"])):l("",!0)]),s("div",ue,[s("button",{onClick:t[0]||(t[0]=e=>na("audio")),class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition text-gray-600 dark:text-gray-400",title:"–ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫"},[...t[20]||(t[20]=[s("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[s("path",{d:"M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"})],-1)])]),s("button",{onClick:t[1]||(t[1]=e=>na("video")),class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition text-gray-600 dark:text-gray-400",title:"–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫"},[...t[21]||(t[21]=[s("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[s("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"})],-1)])]),!W.value||W.value.isFriend||xt.value?xt.value?(r(),a("span",ce,"‚úì")):(null==(p=W.value)?void 0:p.isFriend)?(r(),a("span",ve,"üë•")):l("",!0):(r(),a("button",{key:0,disabled:G.value,class:"px-3 py-1.5 bg-blue-600 text-white text-xs rounded-full hover:bg-blue-700 transition disabled:opacity-50",onClick:sa},i(G.value?"...":"üë•"),9,de)),s("button",{class:"p-2 text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition",onClick:t[2]||(t[2]=e=>kt.value=!kt.value)},[...t[22]||(t[22]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})],-1)])])])]),kt.value?(r(),a("div",ge,[s("button",{class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:t[3]||(t[3]=e=>{Ca(),kt.value=!1})}," üîç –ü–æ–∏—Å–∫ "),s("button",{class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:t[4]||(t[4]=e=>{!async function(){try{const e=await I.getChatMedia(V.value,"images");Pt.value=e.data||[],Et.value=!0}catch(e){console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≥–∞–ª–µ—Ä–µ–∏:",e)}}(),kt.value=!1})}," üñºÔ∏è –ì–∞–ª–µ—Ä–µ—è "),s("button",{class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:t[5]||(t[5]=e=>{!async function(){if(navigator.geolocation)try{const e=await new Promise((e,t)=>navigator.geolocation.getCurrentPosition(e,t,{timeout:1e4})),{latitude:t,longitude:a}=e.coords,l=`https://www.google.com/maps?q=${t},${a}`,r=await I.client.post(`/chats/${V.value}/messages`,{content:`üìç –ú–æ—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è: ${l}`,message_type:"location"});(null==r?void 0:r.success)&&(null==r?void 0:r.data)&&(L.value.push({...r.data,is_mine:!0,createdAt:r.data.createdAt||r.data.created_at}),await b(),ha())}catch(e){alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é")}else alert("–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è")}(),kt.value=!1})}," üìç –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è "),t[23]||(t[23]=s("div",{class:"border-t dark:border-gray-700 my-1"},null,-1)),W.value?(r(),a("button",{key:0,class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:t[6]||(t[6]=e=>{var t;t=W.value.id,B.push(`/user/${t}`),kt.value=!1})}," üë§ –ü—Ä–æ—Ñ–∏–ª—å ")):l("",!0),s("button",{class:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",onClick:t[7]||(t[7]=e=>{confirm("–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?")&&(L.value=[]),kt.value=!1})}," üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç ")])):l("",!0)]),Qt.value&&_t.value?(r(),a("div",pe,[s("div",ye,[s("div",fe,[s("div",he,[s("span",be,i(Zt.value),1),_t.value.status?(r(),a("span",{key:0,class:d(["px-2 py-0.5 rounded-full text-xs",{"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400":"accepted"===_t.value.status,"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-400":"in_progress"===_t.value.status,"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-400":"completed"===_t.value.status,"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-400":!["accepted","in_progress","completed"].includes(_t.value.status)}])},i("accepted"===_t.value.status?"–ü—Ä–∏–Ω—è—Ç–∞":"in_progress"===_t.value.status?"–í —Ä–∞–±–æ—Ç–µ":"completed"===_t.value.status?"–ó–∞–≤–µ—Ä—à–µ–Ω–∞":_t.value.status),3)):l("",!0)]),_t.value.address?(r(),a("p",xe," üìç "+i(_t.value.address),1)):l("",!0)]),s("div",me,[Xt.value?(r(),a("button",{key:0,disabled:jt.value,class:"px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded-full transition flex items-center gap-1 disabled:opacity-50",onClick:ia},[jt.value?(r(),a("span",we)):(r(),a("span",_e,"‚úÖ")),t[24]||(t[24]=n(" –ó–∞–≤–µ—Ä—à–∏—Ç—å ",-1))],8,ke)):l("",!0),Yt.value?(r(),a("button",{key:1,class:"px-3 py-1.5 bg-yellow-500 hover:bg-yellow-600 text-white text-xs font-medium rounded-full transition flex items-center gap-1",onClick:t[8]||(t[8]=e=>Ct.value=!0)}," ‚≠ê –û—Ü–µ–Ω–∏—Ç—å ")):l("",!0)])])])):l("",!0),s("div",{ref_key:"chatContainer",ref:E,class:"flex-1 overflow-y-auto p-4 space-y-3 messages-area relative z-10",onScroll:fa},[H.value?(r(),a("div",Ce,[...t[25]||(t[25]=[s("div",{class:"inline-flex items-center gap-2 px-4 py-2 bg-white dark:bg-gray-800 rounded-full shadow text-sm text-gray-500"},[s("div",{class:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),n(" –ó–∞–≥—Ä—É–∑–∫–∞... ")],-1)])])):l("",!0),F.value?(r(),a(o,{key:1},u(8,e=>s("div",{key:"s"+e,class:d(["flex",e%2?"justify-start":"justify-end"])},[s("div",{class:d(["max-w-xs px-4 py-3 rounded-2xl skeleton",e%2?"bg-white dark:bg-gray-800":"bg-blue-500"]),style:{width:"60%"}},null,2)],2)),64)):(r(),a(o,{key:2},[(r(!0),a(o,null,u(L.value,(e,n)=>{var c,v,g,p;return r(),a(o,{key:e.id},[(g=e,p=L.value[n-1],p&&new Date(g.createdAt).toDateString()===new Date(p.createdAt).toDateString()?l("",!0):(r(),a("div",je,[s("span",Ie,i(Ma(e.createdAt)),1)]))),s("div",{class:d(["flex",e.is_mine?"justify-end":"justify-start"])},[!e.is_mine&&za(e,L.value[n+1])?(r(),a("div",Se,i(ja(null==(c=W.value)?void 0:c.full_name)),1)):e.is_mine?l("",!0):(r(),a("div",Me)),s("div",ze,[s("div",{class:d(["px-4 py-2.5 rounded-2xl message-bubble break-words relative group",e.is_mine?"message-mine":"message-other"])},[e.image_url?(r(),a("div",Ae,[s("img",{src:Aa(e.thumbnail_url||e.image_url),alt:e.content||"–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ",class:"max-w-full rounded-xl cursor-pointer hover:opacity-90 transition",style:{"max-height":"300px","object-fit":"contain","min-width":"100px","min-height":"100px",background:"#f3f4f6"},loading:"lazy",onClick:t=>va(e.image_url),onError:Ra},null,40,Re)])):l("",!0),e.voice_url?(r(),a("div",qe,[s("div",{class:d(["flex items-center gap-3 p-2 rounded-xl",e.is_mine?"bg-white/20":"bg-gray-100 dark:bg-gray-600"])},[s("button",{type:"button",onClick:t=>wa(e.id),class:d(["w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 transition",e.is_mine?"bg-white/30 hover:bg-white/40 text-white":"bg-blue-500 hover:bg-blue-600 text-white"])},[Lt.value!==e.id?(r(),a("svg",De,[...t[26]||(t[26]=[s("path",{d:"M8 5v14l11-7z"},null,-1)])])):(r(),a("svg",Be,[...t[27]||(t[27]=[s("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"},null,-1)])]))],10,$e),s("div",Te,[s("div",Le,[s("div",{class:d(["flex-1 h-1 rounded-full",e.is_mine?"bg-white/30":"bg-gray-300 dark:bg-gray-500"])},[s("div",{class:"h-full rounded-full bg-current w-0",id:`voice-progress-${e.id}`},null,8,Ue)],2),s("span",{class:d(["text-xs",e.is_mine?"text-white/70":"text-gray-500 dark:text-gray-400"])},i((v=e.voice_duration,v?`${Math.floor(v/60)}:${Math.floor(v%60).toString().padStart(2,"0")}`:"0:00")),3)])]),s("audio",{ref_for:!0,ref:t=>{t&&(Ut[e.id]=t)},src:Aa(e.voice_url),onEnded:t=>function(e){Lt.value=null;const t=L.value.findIndex(t=>t.id===e);if(-1!==t)for(let a=t+1;a<L.value.length;a++){const e=L.value[a];if(e.voice_url){setTimeout(()=>{wa(e.id)},300);break}}}(e.id),onTimeupdate:t=>function(e,t){const a=t.target,l=a.currentTime/a.duration*100,r=document.getElementById(`voice-progress-${e}`);r&&(r.style.width=`${l}%`)}(e.id,t),onError:qa,class:"hidden"},null,40,Fe)],2)])):l("",!0),e.content?(r(),a("p",He,i(e.content),1)):l("",!0),(r(!0),a(o,null,u($a(e.content),e=>(r(),m($,{key:e,url:e},null,8,["url"]))),128)),s("div",{class:d(["absolute top-1/2 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1",e.is_mine?"-left-16":"-right-16"])},[s("button",{class:"w-7 h-7 bg-white dark:bg-gray-700 rounded-full shadow flex items-center justify-center hover:scale-110 transition text-sm",onClick:t=>ba(e,"üëç")},"üëç",8,Oe),s("button",{class:"w-7 h-7 bg-white dark:bg-gray-700 rounded-full shadow flex items-center justify-center hover:scale-110 transition text-sm",onClick:t=>ba(e,"‚ù§Ô∏è")},"‚ù§Ô∏è",8,Ve)],2),e.reactions&&e.reactions.length?(r(),a("div",Ee,[(r(!0),a(o,null,u(e.reactions,e=>(r(),a("span",{key:e.emoji,class:"px-2 py-0.5 bg-black/10 dark:bg-white/10 rounded-full text-xs"},i(e.emoji)+" "+i(e.count),1))),128))])):l("",!0)],2),s("div",{class:d(["flex items-center gap-1.5 mt-1 text-xs",e.is_mine?"justify-end":"justify-start"])},[s("span",Pe,i(Ia(e.createdAt)),1),e.is_mine?(r(),a("span",{key:0,class:d(e.is_read?"text-blue-500":"text-gray-400")},i(e.is_read?"‚úì‚úì":"‚úì"),3)):l("",!0)],2)])],2)],64)}),128)),mt.value?(r(),a("div",We,[...t[28]||(t[28]=[w('<div class="bg-gray-200 dark:bg-gray-700 rounded-2xl rounded-bl-md px-4 py-3" data-v-ec345c25><div class="flex gap-1" data-v-ec345c25><span class="w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce" style="animation-delay:0ms;" data-v-ec345c25></span><span class="w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce" style="animation-delay:150ms;" data-v-ec345c25></span><span class="w-2 h-2 bg-gray-500 dark:bg-gray-400 rounded-full animate-bounce" style="animation-delay:300ms;" data-v-ec345c25></span></div></div>',1)])])):l("",!0)],64)),wt.value?(r(),a("button",{key:3,class:"fixed bottom-24 right-6 w-10 h-10 bg-white dark:bg-gray-800 shadow-lg rounded-full flex items-center justify-center text-blue-500 hover:bg-gray-50 dark:hover:bg-gray-700 transition z-10",onClick:ha},[...t[29]||(t[29]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 14l-7 7m0 0l-7-7m7 7V3"})],-1)])])):l("",!0)],544),s("div",Ge,[St.value?(r(),a("div",Ne,[s("img",{src:Mt.value,class:"h-20 rounded-lg object-cover"},null,8,Ke),s("button",{type:"button",class:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-sm hover:bg-red-600 transition",onClick:ca},"‚úï"),zt.value?(r(),a("div",Je,[...t[30]||(t[30]=[s("div",{class:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"},null,-1)])])):l("",!0)])):l("",!0),qt.value?(r(),a("div",Qe,[t[31]||(t[31]=s("div",{class:"w-3 h-3 bg-red-500 rounded-full animate-pulse"},null,-1)),s("span",Xe,"–ó–∞–ø–∏—Å—å "+i((f=$t.value,`${Math.floor(f/60)}:${(f%60).toString().padStart(2,"0")}`)),1),t[32]||(t[32]=s("div",{class:"flex-1"},null,-1)),s("button",{onClick:ka,class:"p-2 text-gray-500 hover:text-red-600"},"‚úï"),s("button",{onClick:ma,class:"px-4 py-1.5 bg-red-600 text-white rounded-full text-sm font-medium hover:bg-red-700"},"–û—Ç–ø—Ä–∞–≤–∏—Ç—å")])):(r(),a("div",Ye,[s("button",{class:"p-2 text-gray-400 hover:text-blue-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition flex-shrink-0",disabled:zt.value,onClick:ua},[...t[33]||(t[33]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])],8,Ze),s("input",{ref_key:"imageInputRef",ref:It,type:"file",accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif",class:"hidden",onChange:da},null,544),s("div",et,[c(s("textarea",{ref_key:"inputRef",ref:P,"onUpdate:modelValue":t[9]||(t[9]=e=>U.value=e),placeholder:"–°–æ–æ–±—â–µ–Ω–∏–µ...",rows:"1",class:"w-full px-4 py-2.5 bg-gray-100/80 dark:bg-gray-700/80 border border-gray-200 dark:border-gray-600 rounded-2xl text-gray-900 dark:text-white placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none max-h-32 text-sm sm:text-base transition-all",style:{"overflow-y":"auto"},onKeydown:_(g(ga,["exact","prevent"]),["enter"]),onInput:pa},null,40,tt),[[v,U.value]])]),s("div",at,[s("button",{type:"button",class:"p-2 text-gray-400 hover:text-yellow-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition flex-shrink-0",onClick:t[10]||(t[10]=e=>Rt.value=!Rt.value)},[...t[34]||(t[34]=[s("span",{class:"text-xl"},"üòä",-1)])]),Rt.value?(r(),a("div",lt,[s("div",rt,[(r(),a(o,null,u(Wt,e=>s("button",{key:e,type:"button",class:"w-8 h-8 flex items-center justify-center text-xl hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition",onClick:t=>function(e){var t;U.value+=e,Rt.value=!1,null==(t=P.value)||t.focus()}(e)},i(e),9,st)),64))])])):l("",!0)]),U.value.trim()||St.value?(r(),a("button",{key:1,disabled:!U.value.trim()&&!St.value||O.value,class:d(["p-2.5 rounded-full transition flex-shrink-0",U.value.trim()||St.value?"bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-600/30":"bg-gray-200 dark:bg-gray-700 text-gray-400"]),onClick:ga},[...t[36]||(t[36]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})],-1)])],10,nt)):(r(),a("button",{key:0,class:"p-2.5 text-gray-400 hover:text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition flex-shrink-0",onClick:xa},[...t[35]||(t[35]=[s("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})],-1)])]))]))]),Ft.value?(r(),a("div",it,[s("div",ot,[s("div",ut,[c(s("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>Ht.value=e),type:"text",placeholder:"–ü–æ–∏—Å–∫ —Å–æ–æ–±—â–µ–Ω–∏–π...",class:"flex-1 px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg text-gray-900 dark:text-white",onInput:_a},null,544),[[v,Ht.value]]),s("button",{onClick:Ca,class:"p-2 text-gray-500"},"‚úï")]),s("div",dt,[Vt.value?(r(),a("div",ct,"–ü–æ–∏—Å–∫...")):0===Ot.value.length&&Ht.value?(r(),a("div",vt,"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")):l("",!0),(r(!0),a(o,null,u(Ot.value,e=>(r(),a("div",{key:e.id,class:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded cursor-pointer",onClick:t[12]||(t[12]=e=>Ft.value=!1)},[s("p",gt,i(e.content),1),s("p",pt,i(Ia(e.created_at)),1)]))),128))])])])):l("",!0),Et.value?(r(),a("div",yt,[s("button",{onClick:t[13]||(t[13]=e=>Et.value=!1),class:"absolute top-4 right-4 text-white text-2xl"},"‚úï"),t[37]||(t[37]=s("h3",{class:"text-white text-xl mb-4"},"–ú–µ–¥–∏–∞ –≤ —á–∞—Ç–µ",-1)),s("div",ft,[(r(!0),a(o,null,u(Pt.value,e=>(r(),a("img",{key:e.id,src:Aa(e.thumbnail_url||e.image_url),class:"aspect-square object-cover rounded cursor-pointer hover:opacity-80",onClick:t=>va(e.image_url)},null,8,ht))),128))])])):l("",!0),At.value?(r(),a("div",{key:3,class:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:t[16]||(t[16]=e=>At.value=null)},[s("button",{class:"absolute top-4 right-4 w-10 h-10 bg-white/10 rounded-full flex items-center justify-center text-white hover:bg-white/20 transition",onClick:t[14]||(t[14]=e=>At.value=null)},"‚úï"),s("img",{src:Aa(At.value),class:"max-w-full max-h-full object-contain",onClick:t[15]||(t[15]=g(()=>{},["stop"]))},null,8,bt)])):l("",!0),_t.value&&W.value?(r(),m(N,{key:4,"is-open":Ct.value,"help-request-id":String(_t.value.id),"helper-id":String(W.value.id),"helper-name":W.value.full_name,onClose:t[17]||(t[17]=e=>Ct.value=!1),onRated:oa},null,8,["is-open","help-request-id","helper-id","helper-name"])):l("",!0)]);var f}}},[["__scopeId","data-v-ec345c25"]]);export{xt as default};
