import{r as e,o as t,h as a,l as s,m as o,t as r,I as l,L as n,G as d,F as i,i as c,p as u,y as p,k as x,n as g}from"./vendor-mW7CftnD-v1766842044731.js";const v={class:"min-h-screen bg-gray-100"},m={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},y={key:0,class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6"},b={class:"bg-red-50 p-4 rounded-lg"},h={class:"text-2xl font-bold text-red-900"},f={class:"bg-yellow-50 p-4 rounded-lg"},w={class:"text-2xl font-bold text-yellow-900"},k={class:"bg-blue-50 p-4 rounded-lg"},C={class:"text-2xl font-bold text-blue-900"},S={class:"bg-green-50 p-4 rounded-lg"},j={class:"text-2xl font-bold text-green-900"},T={class:"bg-white rounded-lg shadow p-4 mb-6"},I={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},$={class:"bg-white rounded-lg shadow overflow-hidden"},E={class:"min-w-full divide-y divide-gray-200"},L={class:"bg-white divide-y divide-gray-200"},P={class:"px-6 py-4 whitespace-nowrap"},U={class:"px-6 py-4"},z={class:"text-sm font-medium text-gray-900"},A={key:0,class:"text-xs text-gray-500"},B={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},V={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},_={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},O={class:"px-6 py-4 whitespace-nowrap text-sm"},R=["onClick"],D={key:1,class:"text-gray-400"},F=["onClick"],H={class:"text-xs bg-gray-100 p-4 rounded overflow-x-auto"},J={__name:"ErrorLogView",setup(J){const N=p(),G=e([]),W=e(null),q=e(null),K=e({level:"",source:"",resolved:""}),M=()=>localStorage.getItem("adminToken"),Q=async()=>{try{const e=M();if(!e)return alert("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞."),void N.push("/admin/login");const t=new URLSearchParams;K.value.level&&t.append("level",K.value.level),K.value.source&&t.append("source",K.value.source),K.value.resolved&&t.append("resolved",K.value.resolved);const a=await fetch(`/api/v1/admin/errors?${t.toString()}`,{headers:{Authorization:`Bearer ${e}`}});if(!a.ok){if(401===a.status)return localStorage.removeItem("adminToken"),localStorage.removeItem("admin"),void N.push("/admin/login");const e=await a.json().catch(()=>({}));throw new Error(e.error||e.message||`HTTP ${a.status}`)}const s=await a.json();if(!s.success)throw new Error(s.error||s.message||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—à–∏–±–æ–∫");G.value=s.errors||[]}catch(e){console.error("Load errors error:",e),alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—à–∏–±–æ–∫: "+(e.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}},X=async()=>{try{const e=M();if(!e)return;const t=await fetch("/api/v1/admin/errors/stats",{headers:{Authorization:`Bearer ${e}`}});if(!t.ok)return void t.status;const a=await t.json();a.success&&(W.value=a.stats)}catch(e){console.error("Load stats error:",e)}},Y=()=>{N.push("/")},Z=()=>{N.push("/admin/dashboard")};return t(()=>{Q(),X()}),(e,t)=>(x(),a("div",v,[s("nav",{class:"bg-white shadow-lg"},[s("div",{class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},[s("div",{class:"flex justify-between h-16"},[t[6]||(t[6]=s("div",{class:"flex items-center"},[s("h1",{class:"text-xl font-bold text-gray-900"}," üìä –õ–æ–≥–∏ –û—à–∏–±–æ–∫ ")],-1)),s("div",{class:"flex items-center space-x-4"},[s("button",{class:"bg-gray-600 text-white px-4 py-2 rounded text-sm hover:bg-gray-700",onClick:Y}," üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é "),s("button",{class:"bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700",onClick:Z}," ‚Üê –î–∞—à–±–æ—Ä–¥ ")])])])]),s("div",m,[W.value?(x(),a("div",y,[s("div",b,[t[7]||(t[7]=s("h3",{class:"text-sm font-medium text-red-800"}," –í—Å–µ–≥–æ –æ—à–∏–±–æ–∫ ",-1)),s("p",h,r(W.value.total||0),1)]),s("div",f,[t[8]||(t[8]=s("h3",{class:"text-sm font-medium text-yellow-800"}," –ù–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ",-1)),s("p",w,r(W.value.unresolved||0),1)]),s("div",k,[t[9]||(t[9]=s("h3",{class:"text-sm font-medium text-blue-800"}," –ó–∞ 24 —á–∞—Å–∞ ",-1)),s("p",C,r(W.value.recent||0),1)]),s("div",S,[t[10]||(t[10]=s("h3",{class:"text-sm font-medium text-green-800"}," –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ",-1)),s("p",j,r((W.value.total||0)-(W.value.unresolved||0)),1)])])):o("",!0),s("div",T,[s("div",I,[l(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>K.value.level=e),class:"px-3 py-2 border border-gray-300 rounded-md"},[...t[11]||(t[11]=[d('<option value=""> –í—Å–µ —É—Ä–æ–≤–Ω–∏ </option><option value="error"> Error </option><option value="warning"> Warning </option><option value="info"> Info </option><option value="debug"> Debug </option>',5)])],512),[[n,K.value.level]]),l(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>K.value.source=e),class:"px-3 py-2 border border-gray-300 rounded-md"},[...t[12]||(t[12]=[s("option",{value:""}," –í—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ ",-1),s("option",{value:"frontend"}," Frontend ",-1),s("option",{value:"backend"}," Backend ",-1),s("option",{value:"api"}," API ",-1)])],512),[[n,K.value.source]]),l(s("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>K.value.resolved=e),class:"px-3 py-2 border border-gray-300 rounded-md"},[...t[13]||(t[13]=[s("option",{value:""}," –í—Å–µ ",-1),s("option",{value:"false"}," –ù–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ",-1),s("option",{value:"true"}," –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ",-1)])],512),[[n,K.value.resolved]]),s("button",{class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",onClick:Q}," üîÑ –û–±–Ω–æ–≤–∏—Ç—å ")])]),s("div",$,[s("table",E,[t[14]||(t[14]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," –£—Ä–æ–≤–µ–Ω—å "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," –°–æ–æ–±—â–µ–Ω–∏–µ "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," –ò—Å—Ç–æ—á–Ω–∏–∫ "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–π "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," –ü–æ—Å–ª–µ–¥–Ω–µ–µ "),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"}," –î–µ–π—Å—Ç–≤–∏—è ")])],-1)),s("tbody",L,[(x(!0),a(i,null,c(G.value,e=>(x(),a("tr",{key:e.id,class:g(e.resolved?"bg-gray-50":"")},[s("td",P,[s("span",{class:g(["px-2 py-1 text-xs font-medium rounded","error"===e.level?"bg-red-100 text-red-800":"","warning"===e.level?"bg-yellow-100 text-yellow-800":"","info"===e.level?"bg-blue-100 text-blue-800":"","debug"===e.level?"bg-gray-100 text-gray-800":""])},r(e.level),3)]),s("td",U,[s("div",z,r(e.message.substring(0,100)),1),e.category?(x(),a("div",A,r(e.category),1)):o("",!0)]),s("td",B,r(e.source||"-"),1),s("td",V,r(e.occurrence_count),1),s("td",_,r(new Date(e.last_occurred).toLocaleString("ru-RU")),1),s("td",O,[e.resolved?(x(),a("span",D,"–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ")):(x(),a("button",{key:0,class:"text-green-600 hover:text-green-800",onClick:t=>(async t=>{if(confirm("–û—Ç–º–µ—Ç–∏—Ç—å –æ—à–∏–±–∫—É –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—É—é?"))try{const e=M();if(!e)return alert("–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞."),void N.push("/admin/login");const a=await fetch(`/api/v1/admin/errors/${t}/resolve`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({note:"–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"})});if(!a.ok){if(401===a.status)return localStorage.removeItem("adminToken"),localStorage.removeItem("admin"),void N.push("/admin/login");const e=await a.json().catch(()=>({}));throw new Error(e.error||e.message||`HTTP ${a.status}`)}const s=await a.json();if(!s.success)throw new Error(s.error||s.message||"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ");await Q(),await X(),alert("‚úÖ –û—à–∏–±–∫–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è")}catch(e){console.error("Resolve error error:",e),alert("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ—Ç–∫–µ –æ—à–∏–±–∫–∏: "+(e.message||"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞"))}})(e.id)}," ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å ",8,R)),s("button",{class:"text-blue-600 hover:text-blue-800 ml-2",onClick:t=>(e=>{q.value=e})(e)}," üëÅÔ∏è –î–µ—Ç–∞–ª–∏ ",8,F)])],2))),128))])])]),q.value?(x(),a("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:t[5]||(t[5]=e=>q.value=null)},[s("div",{class:"bg-white rounded-lg p-6 max-w-4xl max-h-96 overflow-y-auto",onClick:t[4]||(t[4]=u(()=>{},["stop"]))},[t[15]||(t[15]=s("h3",{class:"text-lg font-bold mb-4"}," –î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ ",-1)),s("pre",H,r(JSON.stringify(q.value,null,2)),1),s("button",{class:"mt-4 bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700",onClick:t[3]||(t[3]=e=>q.value=null)}," –ó–∞–∫—Ä—ã—Ç—å ")])])):o("",!0)])]))}};export{J as default};
