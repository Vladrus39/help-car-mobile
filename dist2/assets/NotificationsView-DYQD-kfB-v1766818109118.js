import{r as e,o as a,h as t,f as r,l,m as d,t as s,F as i,i as n,y as o,k as g,G as c,n as b,p as u,v as p}from"./vendor-mW7CftnD-v1766818109118.js";import{u as v,a as y}from"./index-CLGVF4nc-v1766818109118.js";import{_ as h}from"./NavigationHeader-CuEqObYT-v1766818109118.js";import"./utils-MhcqYcpC-v1766818109118.js";import"./maps-CCq-KL9W-v1766818109118.js";const k={class:"min-h-screen bg-gray-100 dark:bg-gray-900"},x={class:"max-w-3xl mx-auto px-4 py-6"},m={class:"flex items-center justify-between mb-6"},_={class:"text-gray-500 dark:text-gray-400 mt-1"},f={key:0,class:"space-y-4"},w={key:1,class:"bg-white dark:bg-gray-800 rounded-2xl p-12 text-center"},q={key:2,class:"space-y-3"},j=["onClick"],C={class:"flex items-start gap-4"},N=["src"],$={key:1,class:"text-2xl"},M={class:"flex-1 min-w-0"},F={class:"flex items-start justify-between gap-2"},D={class:"font-semibold text-gray-900 dark:text-white"},V={class:"text-xs text-gray-400 dark:text-gray-500 whitespace-nowrap"},A={key:0,class:"text-gray-600 dark:text-gray-300 mt-1 line-clamp-2"},B={class:"flex items-center gap-2 mt-2"},I={key:0,class:"w-2 h-2 bg-blue-500 rounded-full"},L=["onClick"],R=["onClick"],W={key:0,class:"text-center py-4"},z=["disabled"],E={__name:"NotificationsView",setup(E){const H=o(),G=v(),S=e(!0),T=e(!1),U=e([]),J=e(0),K=e(!1),O=e(0),P=e=>({new_message:{icon:"üí¨",bg:"bg-blue-100 dark:bg-blue-900/50",badge:"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300"},friend_request:{icon:"üëã",bg:"bg-purple-100 dark:bg-purple-900/50",badge:"bg-purple-100 text-purple-700 dark:bg-purple-900/50 dark:text-purple-300"},friend_accepted:{icon:"ü§ù",bg:"bg-green-100 dark:bg-green-900/50",badge:"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300"},help_request_new:{icon:"üÜò",bg:"bg-red-100 dark:bg-red-900/50",badge:"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300"},help_request_response:{icon:"‚úã",bg:"bg-yellow-100 dark:bg-yellow-900/50",badge:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-300"},help_request_accepted:{icon:"‚úÖ",bg:"bg-green-100 dark:bg-green-900/50",badge:"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300"},help_request_completed:{icon:"üéâ",bg:"bg-green-100 dark:bg-green-900/50",badge:"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300"},rating_received:{icon:"‚≠ê",bg:"bg-yellow-100 dark:bg-yellow-900/50",badge:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-300"},system:{icon:"üîî",bg:"bg-gray-100 dark:bg-gray-700",badge:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"},friend_online:{icon:"üü¢",bg:"bg-green-100 dark:bg-green-900/50",badge:"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300"},payment:{icon:"üí∞",bg:"bg-emerald-100 dark:bg-emerald-900/50",badge:"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/50 dark:text-emerald-300"},call_incoming:{icon:"üìû",bg:"bg-green-100 dark:bg-green-900/50",badge:"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-300"},call_missed:{icon:"üìµ",bg:"bg-red-100 dark:bg-red-900/50",badge:"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-300"},call_video:{icon:"üìπ",bg:"bg-blue-100 dark:bg-blue-900/50",badge:"bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300"}}[e]||{icon:"üîî",bg:"bg-gray-100 dark:bg-gray-700",badge:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"}),Q=e=>{var a,t;return"call_missed"===e.type||"call_video"===e.type&&(null==(a=e.data)?void 0:a.missed)||"call_incoming"===e.type&&(null==(t=e.data)?void 0:t.missed)},X=e=>{if(!e)return"";const a=new Date(e);if(isNaN(a.getTime()))return"";const t=new Date-a,r=Math.floor(t/6e4),l=Math.floor(t/36e5),d=Math.floor(t/864e5);return r<1?"—Ç–æ–ª—å–∫–æ —á—Ç–æ":r<60?`${r} –º–∏–Ω. –Ω–∞–∑–∞–¥`:l<24?`${l} —á. –Ω–∞–∑–∞–¥`:d<7?`${d} –¥–Ω. –Ω–∞–∑–∞–¥`:a.toLocaleDateString("ru-RU",{day:"numeric",month:"short",year:d>365?"numeric":void 0})},Y=e=>e.created_at||e.createdAt||null,Z=async()=>{T.value=!0;try{const e=(await y.getNotifications({limit:20,offset:O.value})).data||[];U.value.push(...e),K.value=e.length>=20,O.value+=e.length}catch(e){console.error("Failed to load more:",e)}finally{T.value=!1}},ee=async()=>{try{await y.markAllNotificationsRead(),U.value.forEach(e=>e.is_read=!0),J.value=0}catch(e){console.error("Failed to mark all as read:",e)}};function ae(e){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("blob:"))return e;return"https://help-car.online/api/v1".replace("/api/v1","")+e}function te(e){e.target.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%236366f1" width="100" height="100"/><text x="50" y="60" text-anchor="middle" fill="white" font-size="40">?</text></svg>'}return a(()=>{(async()=>{var e;if(G.isLoggedIn){S.value=!0;try{const a=await y.getNotifications({limit:20,offset:0});U.value=a.data||[],J.value=a.unread_count||0,K.value=((null==(e=a.data)?void 0:e.length)||0)>=20,O.value=U.value.length}catch(a){console.error("Failed to load notifications:",a)}finally{S.value=!1}}else H.push("/login")})()}),(e,a)=>(g(),t("div",k,[r(h),l("div",x,[l("div",m,[l("div",null,[a[0]||(a[0]=l("h1",{class:"text-2xl sm:text-3xl font-black text-gray-900 dark:text-white"}," üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ",-1)),l("p",_,s(J.value>0?`${J.value} –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö`:"–í—Å–µ –ø—Ä–æ—á–∏—Ç–∞–Ω—ã"),1)]),J.value>0?(g(),t("button",{key:0,onClick:ee,class:"px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition text-sm"}," –ü—Ä–æ—á–∏—Ç–∞—Ç—å –≤—Å–µ ")):d("",!0)]),S.value?(g(),t("div",f,[(g(),t(i,null,n(5,e=>l("div",{key:e,class:"bg-white dark:bg-gray-800 rounded-xl p-4 animate-pulse"},[...a[1]||(a[1]=[c('<div class="flex gap-4"><div class="w-12 h-12 bg-gray-200 dark:bg-gray-700 rounded-full"></div><div class="flex-1 space-y-2"><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"></div><div class="h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2"></div></div></div>',1)])])),64))])):0===U.value.length?(g(),t("div",w,[...a[2]||(a[2]=[l("div",{class:"text-6xl mb-4"},"üì≠",-1),l("h3",{class:"text-xl font-bold text-gray-900 dark:text-white mb-2"},"–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π",-1),l("p",{class:"text-gray-500 dark:text-gray-400"},"–í—Å–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å",-1)])])):(g(),t("div",q,[(g(!0),t(i,null,n(U.value,e=>{var r,i;return g(),t("div",{key:e.id,onClick:a=>(async e=>{if(!e.is_read)try{await y.markNotificationRead(e.id),e.is_read=!0,J.value=Math.max(0,J.value-1)}catch(t){console.error("Failed to mark notification as read:",t)}const a=e.data||{};switch(e.type){case"new_message":a.chat_id?H.push(`/chat/${a.chat_id}`):a.direct_user_id&&H.push(`/direct-chat/${a.direct_user_id}`);break;case"friend_request":case"friend_accepted":H.push("/friends");break;case"help_request_new":case"help_request_response":case"help_request_accepted":case"help_request_completed":a.request_id?H.push(`/responses/${a.request_id}`):H.push("/my-requests");break;case"rating_received":H.push("/profile");break;case"call_incoming":case"call_missed":case"call_video":a.chat_id?H.push(`/chat/${a.chat_id}`):a.caller_id&&H.push(`/direct-chat/${a.caller_id}`)}})(e),class:b(["bg-white dark:bg-gray-800 rounded-xl p-4 cursor-pointer hover:shadow-lg transition-all border border-transparent hover:border-blue-200 dark:hover:border-blue-800",{"bg-blue-50 dark:bg-blue-900/20 border-blue-100 dark:border-blue-900":!e.is_read}])},[l("div",C,[l("div",{class:b(["flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center",P(e.type).bg])},[(null==(r=e.sender)?void 0:r.avatar_url)?(g(),t("img",{key:0,src:ae(e.sender.avatar_url),class:"w-12 h-12 rounded-full object-cover",onError:te},null,40,N)):(g(),t("span",$,s(P(e.type).icon),1))],2),l("div",M,[l("div",F,[l("p",D,s(e.title),1),l("span",V,s(X(Y(e))),1)]),e.body?(g(),t("p",A,s(e.body),1)):d("",!0),l("div",B,[l("span",{class:b(["text-xs px-2 py-1 rounded-full",P(e.type).badge])},s((i=e.type,{new_message:"–°–æ–æ–±—â–µ–Ω–∏–µ",friend_request:"–ó–∞—è–≤–∫–∞ –≤ –¥—Ä—É–∑—å—è",friend_accepted:"–î—Ä—É–≥ –¥–æ–±–∞–≤–ª–µ–Ω",help_request_new:"–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞",help_request_response:"–û—Ç–∫–ª–∏–∫",help_request_accepted:"–û—Ç–∫–ª–∏–∫ –ø—Ä–∏–Ω—è—Ç",help_request_completed:"–ó–∞–≤–µ—Ä—à–µ–Ω–æ",rating_received:"–û—Ü–µ–Ω–∫–∞",system:"–°–∏—Å—Ç–µ–º–∞",friend_online:"–î—Ä—É–≥ –æ–Ω–ª–∞–π–Ω",payment:"–û–ø–ª–∞—Ç–∞",call_incoming:"–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫",call_missed:"–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π",call_video:"–í–∏–¥–µ–æ–∑–≤–æ–Ω–æ–∫"}[i]||"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ")),3),e.is_read?d("",!0):(g(),t("span",I)),Q(e)?(g(),t("button",{key:1,onClick:u(a=>(async e=>{var a;const t=e.data||{},r=t.caller_id||t.user_id||(null==(a=e.sender)?void 0:a.id);if(!r)return void console.error("No caller ID found in notification");const l="call_video"===e.type||"video"===t.call_type;H.push({path:`/direct-chat/${r}`,query:{action:"call",video:l?"1":"0"}})})(e),["stop"]),class:"ml-auto flex items-center gap-1 px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-sm font-semibold rounded-lg transition"},[...a[3]||(a[3]=[l("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1),p(" –ü–µ—Ä–µ–∑–≤–æ–Ω–∏—Ç—å ",-1)])],8,L)):d("",!0)])]),l("button",{onClick:u(a=>(async e=>{try{await y.deleteNotification(e);const a=U.value.findIndex(a=>a.id===e);-1!==a&&(U.value[a].is_read||(J.value=Math.max(0,J.value-1)),U.value.splice(a,1))}catch(a){console.error("Failed to delete notification:",a)}})(e.id),["stop"]),class:"flex-shrink-0 p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition",title:"–£–¥–∞–ª–∏—Ç—å"},[...a[4]||(a[4]=[l("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,R)])],10,j)}),128)),K.value?(g(),t("div",W,[l("button",{onClick:Z,disabled:T.value,class:"px-6 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition disabled:opacity-50"},s(T.value?"–ó–∞–≥—Ä—É–∑–∫–∞...":"–ó–∞–≥—Ä—É–∑–∏—Ç—å –µ—â—ë"),9,z)])):d("",!0)]))])]))}};export{E as default};
